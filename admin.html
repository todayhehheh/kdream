<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>관리자 페이지</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        body { padding: 20px; font-family: sans-serif; }
        .login-box { max-width: 300px; margin: 50px auto; text-align: center; }
        input { padding: 10px; width: 100%; box-sizing: border-box; margin-bottom: 10px; }
        button { padding: 10px 20px; background: #333; color: #fff; border: none; cursor: pointer; }
        
        /* 리포트 스타일 */
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #000; padding: 5px; text-align: center; }
        th { background: #eee; }
        .hidden { display: none; }
        
        @media print {
            .no-print { display: none; }
        }
    </style>
</head>
<body>

<div id="login" class="login-box">
    <h2>관리자 접속</h2>
    <input type="password" id="pw" placeholder="비밀번호">
    <button onclick="login()">확인</button>
</div>

<div id="list" class="hidden no-print">
    <h2>참여자 목록</h2>
    <ul id="userList"></ul>
</div>

<div id="report" class="hidden">
    <h1 style="text-align:center;">초기상담 기록지</h1>
    <div id="reportContent"></div>
    <button class="no-print" onclick="window.print()">인쇄</button>
    <button class="no-print" onclick="location.reload()">닫기</button>
</div>

<script>
    const firebaseConfig = { /* 본인 키 입력 */ };
    try { firebase.initializeApp(firebaseConfig); var db = firebase.firestore(); } catch(e){}

    function login() {
        if(document.getElementById('pw').value === "1388") {
            document.getElementById('login').classList.add('hidden');
            document.getElementById('list').classList.remove('hidden');
            loadData();
        } else alert("비밀번호 오류");
    }

    function loadData() {
        if(!db) return;
        db.collection("intake_complete").orderBy("ts", "desc").get().then(snap => {
            const ul = document.getElementById('userList');
            ul.innerHTML = "";
            snap.forEach(doc => {
                const d = doc.data();
                ul.innerHTML += `<li>${d.info?.name || '무명'} (${d.date}) <button onclick='view(${JSON.stringify(d)})'>보기</button></li>`;
            });
        });
    }

    function view(data) {
        document.getElementById('list').classList.add('hidden');
        document.getElementById('report').classList.remove('hidden');
        // 여기에 데이터를 HTML로 뿌려주는 코드 작성 (index.html의 viewRpt 함수 참조)
        document.getElementById('reportContent').innerText = JSON.stringify(data, null, 2); // 임시 텍스트 출력
    }
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>노원구 꿈드림 희망서비스 조사표</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script src="scales.js"></script>
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --primary: #FF7F50; --bg: #FFF9F5; --white: #fff; --text: #333; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 60px 20px 100px 20px; }
        
        .header { position: fixed; top: 0; left: 0; width: 100%; height: 50px; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: center; font-weight: 800; color: var(--primary); z-index: 999; }
        .progress-bar { position: fixed; top: 50px; left: 0; height: 5px; background: var(--primary); width: 0%; z-index: 999; transition: width 0.3s; }

        .container { max-width: 700px; margin: 0 auto; }
        .page { display: none; animation: fadeIn 0.3s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); margin-bottom: 20px; }
        h2 { border-bottom: 2px solid var(--primary); padding-bottom: 10px; margin-top: 0; color: #444; }
        h3 { background: #eee; padding: 10px; border-radius: 8px; font-size: 1.1rem; margin: 20px 0 10px 0; }

        .form-group { margin-bottom: 25px; }
        label { display: block; font-weight: 700; margin-bottom: 8px; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-size: 1rem; }
        input.etc-input { margin-top: 5px; display: none; background: #fffbe6; border-color: #ffe58f; }
        input.etc-input.show { display: block; }

        /* 버튼 그룹 */
        .btn-group { display: flex; flex-wrap: wrap; gap: 8px; }
        .btn-opt { flex: 1; min-width: 100px; padding: 12px; border: 1px solid #ddd; border-radius: 10px; text-align: center; cursor: pointer; background: #fff; transition: 0.2s; }
        .btn-opt.selected { background: #FFF0EB; border-color: var(--primary); color: var(--primary); font-weight: 800; }

        /* 가족 테이블 */
        .fam-row { display: grid; grid-template-columns: 0.7fr 1fr 0.5fr 1.2fr 0.6fr; gap: 5px; margin-bottom: 5px; }
        .fam-row input, .fam-row select { padding: 8px; text-align: center; font-size: 0.9rem; }

        /* 하단바 */
        .bottom-bar { position: fixed; bottom: 0; left: 0; width: 100%; padding: 15px; background: white; border-top: 1px solid #eee; display: flex; gap: 10px; box-sizing: border-box; }
        .btn { flex: 1; padding: 15px; border-radius: 10px; border: none; font-size: 1.1rem; font-weight: 800; cursor: pointer; }
        .btn-prev { background: #eee; color: #555; flex: 0.4; }
        .btn-next { background: var(--primary); color: white; flex: 1; }
    </style>
</head>
<body>

<div class="header">노원구 꿈드림</div>
<div class="progress-bar" id="progressBar"></div>

<div class="container">
    <div id="page-1" class="page active">
        <div class="card">
            <h2>1. 기본 인적사항</h2>
            <div class="form-group"><label>성명</label><input type="text" id="userName"></div>
            <div class="form-group"><label>성별</label>
                <div class="btn-group">
                    <div class="btn-opt" onclick="sel(this,'gender','남')">남자</div>
                    <div class="btn-opt" onclick="sel(this,'gender','여')">여자</div>
                </div>
            </div>
            <div class="form-group"><label>주민번호 (13자리)</label>
                <div style="display:flex; gap:10px;">
                    <input type="tel" id="rrn1" maxlength="6" placeholder="앞자리"> - <input type="tel" id="rrn2" maxlength="7" placeholder="뒷자리">
                </div>
            </div>
            <div class="form-group"><label>주소</label>
                <div style="display:flex; gap:10px; margin-bottom:5px;">
                    <input type="text" id="postcode" placeholder="우편번호" readonly style="flex:0.4;">
                    <button type="button" style="padding:10px; flex:0.3; border-radius:10px; border:1px solid #ddd; background:#fff;" onclick="execPostcode()">검색</button>
                </div>
                <input type="text" id="address" placeholder="기본 주소" readonly style="margin-bottom:5px;">
                <input type="text" id="detailAddr" placeholder="상세 주소">
            </div>
            <div class="form-group"><label>본인 연락처</label><input type="tel" id="telSelf" placeholder="010-0000-0000"></div>
            <div class="form-group"><label>보호자 연락처</label><input type="tel" id="telParent" placeholder="010-0000-0000"></div>
            <div class="form-group"><label>현재 상태</label>
                <div class="btn-group" style="flex-direction:column;">
                    <div class="btn-opt" onclick="sel(this,'status','학교밖청소년')">학교 밖 청소년</div>
                    <div class="btn-opt" onclick="sel(this,'status','고졸검정고시합격')">고졸 검정고시 합격 청소년</div>
                    <div class="btn-opt" onclick="sel(this,'status','학업중단숙려제')">학업중단 숙려제 (상담 중)</div>
                </div>
            </div>
        </div>
    </div>

    <div id="page-2" class="page">
        <div class="card">
            <h2>2. 학업 중단 및 배경</h2>
            <div class="form-group"><label>언제까지 학교에 다녔나요?</label>
                <div class="btn-group">
                    <div class="btn-opt" onclick="sel(this,'schLvl','초'); showGrade(6);">초등학교</div>
                    <div class="btn-opt" onclick="sel(this,'schLvl','중'); showGrade(3);">중학교</div>
                    <div class="btn-opt" onclick="sel(this,'schLvl','고'); showGrade(3);">고등학교</div>
                    <div class="btn-opt" onclick="sel(this,'schLvl','미진학'); showGrade(0);">미진학</div>
                </div>
            </div>
            <div class="form-group" id="grade-box" style="display:none;">
                <label>학년</label>
                <div class="btn-group" id="grade-opts" style="margin-bottom:10px;"></div>
                <label>학기</label>
                <div class="btn-group">
                    <div class="btn-opt" onclick="sel(this,'sem','1학기')">1학기</div>
                    <div class="btn-opt" onclick="sel(this,'sem','2학기')">2학기</div>
                </div>
            </div>
            <div class="form-group"><label>학교를 그만둔 날짜</label>
                <div style="display:flex; gap:5px;">
                    <input type="tel" id="dropY" placeholder="년(4자리)">
                    <input type="tel" id="dropM" placeholder="월">
                    <input type="tel" id="dropD" placeholder="일">
                </div>
            </div>
            <div class="form-group"><label>그만둔 이유 (1순위)</label><select id="r1" onchange="chkEtc('r1','etc1')"></select><input type="text" id="etc1" class="etc-input" placeholder="기타 내용 입력"></div>
            <div class="form-group"><label>그만둔 이유 (2순위)</label><select id="r2" onchange="chkEtc('r2','etc2')"></select><input type="text" id="etc2" class="etc-input" placeholder="기타 내용 입력"></div>
            <div class="form-group"><label>그만둔 이유 (3순위)</label><select id="r3" onchange="chkEtc('r3','etc3')"></select><input type="text" id="etc3" class="etc-input" placeholder="기타 내용 입력"></div>
            
            <div class="form-group"><label>부모님 의견</label>
                <div class="btn-group">
                    <div class="btn-opt" onclick="sel(this,'agree','일치(찬성)')">찬성</div>
                    <div class="btn-opt" onclick="sel(this,'agree','일치(반대)')">반대</div>
                    <div class="btn-opt" onclick="sel(this,'agree','불일치')">불일치</div>
                    <div class="btn-opt" onclick="sel(this,'agree','무관심')">무관심</div>
                    <div class="btn-opt" onclick="sel(this,'agree','기타')">기타</div>
                </div>
                <input type="text" id="agreeEtc" class="etc-input" placeholder="기타 의견">
            </div>
        </div>
    </div>

    <div id="page-3" class="page">
        <div class="card">
            <h2>3. 방문 경로</h2>
            <div id="path-opts" class="btn-group" style="flex-direction:column;"></div>
            <div id="org-box" style="display:none; margin-top:20px; border-top:1px dashed #ddd; padding-top:20px;">
                <label>기관 상세 선택</label>
                <div id="org-opts" class="btn-group"></div>
            </div>
            <input type="text" id="pathEtc" class="etc-input" placeholder="기타 경로 입력">
        </div>
    </div>

    <div id="page-4" class="page">
        <div class="card">
            <h2>4. 가족 및 경제 상황</h2>
            <div class="form-group"><label>가족 구성원</label>
                <div class="fam-row" style="font-weight:bold; color:#666;">
                    <span>관계</span><span>이름</span><span>나이</span><span>연락처</span><span>동거</span>
                </div>
                <div id="fam-rows"></div>
            </div>
            
            <div class="form-group"><label>가정 형태</label><div id="fam-type-opts" class="btn-group"></div><input type="text" id="famEtc" class="etc-input"></div>
            <div class="form-group"><label>경제 상태</label><div id="econ-opts" class="btn-group"></div></div>
            
            <div class="form-group"><label>용돈 만족도</label>
                <div class="btn-group">
                    <div class="btn-opt" onclick="sel(this,'money','충분')">충분</div>
                    <div class="btn-opt" onclick="sel(this,'money','보통')">보통</div>
                    <div class="btn-opt" onclick="sel(this,'money','부족')">부족</div>
                </div>
                <div id="lack-box" style="display:none; margin-top:10px;">
                    <label style="font-size:0.9rem;">부족 시 충당 방법</label>
                    <div class="btn-group">
                        <div class="btn-opt" onclick="sel(this,'howMoney','알바')">알바</div>
                        <div class="btn-opt" onclick="sel(this,'howMoney','지원금')">지원금</div>
                        <div class="btn-opt" onclick="sel(this,'howMoney','아껴씀')">아껴씀</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="page-5" class="page">
        <div class="card">
            <h2>5. 어려움 및 욕구</h2>
            <label>중단 후 목표</label>
            <div id="goal-opts" class="btn-group" style="margin-bottom:30px;"></div>
            <input type="text" id="goalEtc" class="etc-input">

            <label>희망 서비스 (전체 선택 가능)</label>
            <div id="service-opts"></div>
        </div>
    </div>

    <div id="page-6" class="page">
        <div class="card">
            <h2>6. 자립역량 척도</h2>
            <div id="jarip-area"></div>
        </div>
        <div class="card">
            <h2>7. 심리정서 척도</h2>
            <div id="simni-area"></div>
        </div>
    </div>

    <div id="page-end" class="page text-center" style="text-align:center; padding-top:50px;">
        <h1>수고하셨습니다!</h1>
        <p>작성이 완료되었습니다.<br>태블릿을 상담사에게 전달해 주세요.</p>
        <button class="btn btn-prev" style="margin-top:30px;" onclick="location.reload()">처음으로</button>
    </div>
</div>

<div class="bottom-bar">
    <button class="btn btn-prev" onclick="move(-1)">이전</button>
    <button class="btn btn-next" onclick="move(1)" id="btn-next">다음</button>
</div>

<script>
    // Firebase Config (본인 키 필수)
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "kdream-db462.firebaseapp.com",
        projectId: "kdream-db462",
        storageBucket: "kdream-db462.firebasestorage.app",
        messagingSenderId: "1020262030810",
        appId: "1:1020262030810:web:3482636bc020bb4310b4e3"
    };
    try { firebase.initializeApp(firebaseConfig); var db = firebase.firestore(); } catch(e){}

    let page = 1;
    const maxPage = 6;
    let data = {};

    window.onload = () => {
        // 중단사유
        ['r1','r2','r3'].forEach(id => {
            const el = document.getElementById(id);
            el.add(new Option("선택", ""));
            REASON_OPTIONS.forEach(r => el.add(new Option(r, r)));
        });
        
        // 방문경로
        const pBox = document.getElementById('path-opts');
        VISIT_PATHS.forEach(p => {
            let click = p.includes("기관") ? `document.getElementById('org-box').style.display='block'` : `document.getElementById('org-box').style.display='none'`;
            if(p === "기타") click = `document.getElementById('pathEtc').classList.add('show')`;
            pBox.innerHTML += `<div class="btn-opt" onclick="sel(this,'visit','${p}'); ${click}">${p}</div>`;
        });
        document.getElementById('org-opts').innerHTML = ORG_DETAILS.map(o => `<div class="btn-opt" onclick="sel(this,'orgDetail','${o}')">${o}</div>`).join('');

        // 가족
        const fRows = document.getElementById('fam-rows');
        for(let i=1; i<=5; i++) {
            fRows.innerHTML += `<div class="fam-row"><input type="text" placeholder="관계"><input type="text" placeholder="이름"><input type="tel" placeholder="나이"><input type="tel" placeholder="연락처"><select><option>O</option><option>X</option></select></div>`;
        }
        
        // 가정형태/경제
        document.getElementById('fam-type-opts').innerHTML = FAMILY_TYPES.map(t => `<div class="btn-opt" onclick="sel(this,'famType','${t}'); if('${t}'=='기타') document.getElementById('famEtc').classList.add('show')">${t}</div>`).join('');
        document.getElementById('econ-opts').innerHTML = ECON_STATUS.map(e => `<div class="btn-opt" onclick="sel(this,'econ','${e}')">${e}</div>`).join('');

        // 목표
        document.getElementById('goal-opts').innerHTML = GOAL_OPTIONS.map(g => `<div class="btn-opt" onclick="sel(this,'goal','${g}'); if('${g}'=='기타') document.getElementById('goalEtc').classList.add('show')">${g}</div>`).join('');

        // 서비스
        const sBox = document.getElementById('service-opts');
        for(let g in SERVICE_GROUPS) {
            let html = `<h3>${g}</h3><div class="btn-group">`;
            SERVICE_GROUPS[g].forEach(s => {
                html += `<div class="btn-opt" onclick="this.classList.toggle('selected')">${s}</div>`;
            });
            sBox.innerHTML += html + `</div>`;
        }
        
        // 척도 로드 (기본 YOUTH)
        loadScale('YOUTH');
    };

    function loadScale(type) {
        ['jarip','simni'].forEach(part => {
            const div = document.getElementById(part+'-area');
            div.innerHTML = "";
            SCALE_DATA[type][part].forEach((q, i) => {
                div.innerHTML += `
                    <div style="margin-bottom:15px; background:#f9f9f9; padding:15px; border-radius:10px;">
                        <div style="font-weight:bold; margin-bottom:10px;">${i+1}. ${q.t}</div>
                        <div class="btn-group">
                            <div class="btn-opt" onclick="sel(this,'${part}_${q.n}',1)">전혀아님</div>
                            <div class="btn-opt" onclick="sel(this,'${part}_${q.n}',2)">아니다</div>
                            <div class="btn-opt" onclick="sel(this,'${part}_${q.n}',3)">보통</div>
                            <div class="btn-opt" onclick="sel(this,'${part}_${q.n}',4)">그렇다</div>
                            <div class="btn-opt" onclick="sel(this,'${part}_${q.n}',5)">매우그렇다</div>
                        </div>
                    </div>`;
            });
        });
    }

    function sel(el, key, val) {
        data[key] = val;
        // 형제들 선택해제
        const sibs = el.parentElement.children;
        for(let s of sibs) s.classList.remove('selected');
        el.classList.add('selected');
        
        // 추가 로직 (용돈 부족)
        if(key === 'money' && val === '부족') document.getElementById('lack-box').style.display='block';
    }

    function chkEtc(id, etcId) {
        const val = document.getElementById(id).value;
        if(val.includes('기타')) document.getElementById(etcId).classList.add('show');
        else document.getElementById(etcId).classList.remove('show');
    }

    function showGrade(n) {
        const box = document.getElementById('grade-box');
        const opts = document.getElementById('grade-opts');
        if(n===0) { box.style.display='none'; return; }
        box.style.display='block';
        opts.innerHTML = "";
        for(let i=1; i<=n; i++) opts.innerHTML += `<div class="btn-opt" onclick="sel(this,'grade','${i}학년')">${i}학년</div>`;
    }

    function move(dir) {
        document.getElementById(`page-${page}`).classList.remove('active');
        page += dir;
        if(page < 1) page = 1;
        if(page > maxPage) { submit(); return; }
        document.getElementById(`page-${page}`).classList.add('active');
        document.getElementById('progressBar').style.width = (page/maxPage*100) + "%";
        document.getElementById('btn-next').innerText = (page === maxPage) ? "제출하기" : "다음";
        window.scrollTo(0,0);
    }

    function execPostcode() {
        new daum.Postcode({
            oncomplete: function(data) {
                document.getElementById('address').value = data.roadAddress;
                document.getElementById('detailAddr').focus();
            }
        }).open();
    }

    function submit() {
        if(confirm("제출하시겠습니까?")) {
            // 저장 로직 (생략 - 이전 코드 참조)
            document.querySelector('.container').style.display='none'; // 전체 숨김
            document.querySelector('.bottom-bar').style.display='none';
            document.getElementById('page-end').classList.add('active');
            if(db) { /* Firestore Add */ }
        } else {
            move(-1); // 취소 시 이전 페이지로
        }
    }
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë…¸ì›êµ¬ ê¿ˆë“œë¦¼ í¬ë§ì„œë¹„ìŠ¤ ì¡°ì‚¬í‘œ</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --primary: #FF7F50; --primary-dark: #E06030; --bg: #FFF9F5; --card: #FFFFFF; --text: #333; --border: #E5E5E5; }
        
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; padding-bottom: 80px; -webkit-tap-highlight-color: transparent; }
        
        /* ë„¤ë¹„ê²Œì´ì…˜ ë°” */
        .nav-bar { position: fixed; top: 0; width: 100%; height: 60px; background: white; z-index: 1000; display: flex; align-items: center; justify-content: space-between; padding: 0 20px; box-sizing: border-box; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .nav-title { font-weight: 800; font-size: 1.1rem; color: var(--primary); }
        .nav-btn { font-size: 0.9rem; padding: 8px 12px; border-radius: 6px; border: 1px solid #ddd; background: #fff; cursor: pointer; }
        
        .container { max-width: 800px; margin: 80px auto 0 auto; padding: 20px; }
        
        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card { background: var(--card); border-radius: 20px; padding: 30px; margin-bottom: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.03); border: 1px solid #F0F0F0; animation: slideUp 0.4s ease; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        h2 { font-size: 1.4rem; color: #222; margin-top: 0; border-bottom: 2px solid var(--primary); padding-bottom: 15px; margin-bottom: 25px; }
        h3 { font-size: 1.15rem; margin-top: 30px; margin-bottom: 10px; color: #444; background: #F8F8F8; padding: 10px; border-radius: 8px; }

        /* ì…ë ¥ í¼ */
        label { display: block; font-weight: 700; margin-bottom: 8px; color: #555; font-size: 1rem; }
        .sub-desc { font-size: 0.85rem; color: #888; font-weight: normal; margin-left: 5px; }
        
        input[type="text"], input[type="tel"], input[type="date"], input[type="number"], select {
            width: 100%; padding: 14px; border: 1px solid #ddd; border-radius: 12px; font-size: 1rem; box-sizing: border-box; background: #fff; transition: 0.2s;
        }
        input:focus, select:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(255, 127, 80, 0.1); }

        /* ë²„íŠ¼ ê·¸ë£¹ (ë¼ë””ì˜¤/ì²´í¬ë°•ìŠ¤ ëŒ€ì²´) */
        .btn-select-group { display: flex; flex-wrap: wrap; gap: 8px; }
        .btn-select-group label {
            flex: 1; min-width: 100px; text-align: center; padding: 14px 10px; border: 1px solid #ddd; border-radius: 12px; 
            cursor: pointer; font-weight: 500; background: #fff; margin: 0; transition: 0.2s; display: flex; align-items: center; justify-content: center;
        }
        .btn-select-group input { display: none; }
        .btn-select-group label:has(input:checked) { background: #FFF0EB; border-color: var(--primary); color: var(--primary); font-weight: 800; box-shadow: 0 2px 5px rgba(255,127,80,0.2); }
        
        /* ì¢ì€ ë²„íŠ¼ ê·¸ë¦¬ë“œ (í•™ë…„ ë“±) */
        .grid-options { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 8px; }

        /* ê°€ì¡±ê´€ê³„ í…Œì´ë¸”í˜• */
        .family-input-row { display: grid; grid-template-columns: 0.8fr 1fr 0.6fr 1fr 0.5fr; gap: 5px; margin-bottom: 8px; align-items: center; }
        .family-input-row input, .family-input-row select { padding: 10px; font-size: 0.9rem; }
        .family-header { display: grid; grid-template-columns: 0.8fr 1fr 0.6fr 1fr 0.5fr; gap: 5px; font-size: 0.85rem; font-weight: bold; text-align: center; margin-bottom: 5px; color: #666; }

        /* í•˜ë‹¨ ê³ ì • ë²„íŠ¼ë°” */
        .bottom-bar { position: fixed; bottom: 0; left: 0; width: 100%; padding: 15px 20px; background: white; border-top: 1px solid #eee; display: flex; gap: 10px; z-index: 900; box-sizing: border-box; }
        .btn-prev { flex: 1; background: #f0f0f0; color: #333; border: none; padding: 15px; border-radius: 12px; font-weight: bold; font-size: 1.1rem; cursor: pointer; }
        .btn-next { flex: 2; background: var(--primary); color: white; border: none; padding: 15px; border-radius: 12px; font-weight: bold; font-size: 1.1rem; cursor: pointer; }
        .btn-save { flex: 0.8; background: #333; color: white; border: none; padding: 15px; border-radius: 12px; font-weight: bold; font-size: 1rem; cursor: pointer; }

        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .intro-logo { color: var(--primary); font-size: 2rem; font-weight: 900; margin-bottom: 10px; }

        /* ì¸ì‡„ ìŠ¤íƒ€ì¼ */
        @media print {
            body { background: white; padding: 0; }
            .nav-bar, .bottom-bar, .no-print, #intro-page, #wizard-container { display: none !important; }
            #report-area { display: block !important; }
            table { width: 100%; border-collapse: collapse; margin-bottom: 10px; font-size: 10pt; }
            th, td { border: 1px solid #000; padding: 5px; text-align: center; }
            th { background: #f0f0f0; }
            .text-left { text-align: left; padding-left: 5px; }
            .section-title { font-size: 12pt; font-weight: bold; border-bottom: 2px solid #000; margin-top: 20px; }
        }
    </style>
</head>
<body>

<div class="nav-bar no-print">
    <div class="nav-title">ë…¸ì›êµ¬ ê¿ˆë“œë¦¼</div>
    <button class="nav-btn" onclick="showAdmin()">ê´€ë¦¬ì</button>
</div>

<div id="intro-page" class="container text-center" style="margin-top: 150px;">
    <div class="intro-logo">ë…¸ì›êµ¬ ê¿ˆë“œë¦¼</div>
    <h1 style="font-size: 1.5rem; margin-bottom: 30px;">í¬ë§ ì„œë¹„ìŠ¤ ì¡°ì‚¬í‘œ</h1>
    <p style="color: #666; margin-bottom: 50px; line-height: 1.6;">
        ì•ˆë…•í•˜ì„¸ìš”!<br>
        ê¿ˆë“œë¦¼ ì„¼í„°ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.<br>
        ì—¬ëŸ¬ë¶„ì—ê²Œ ê¼­ í•„ìš”í•œ ë„ì›€ì„ ë“œë¦¬ê¸° ìœ„í•´<br>
        ëª‡ ê°€ì§€ ì§ˆë¬¸ì„ ì¤€ë¹„í–ˆìŠµë‹ˆë‹¤.<br>
        í¸ì•ˆí•œ ë§ˆìŒìœ¼ë¡œ ì†”ì§í•˜ê²Œ ì‘ì„±í•´ ì£¼ì„¸ìš”.
    </p>
    <button class="btn-next" style="width: 100%;" onclick="startSurvey()">ì‹œì‘í•˜ê¸°</button>
</div>

<div id="wizard-container" class="container hidden">
    
    <div id="step-1" class="wizard-step">
        <div class="card">
            <h2>1. ê¸°ë³¸ ì¸ì ì‚¬í•­</h2>
            
            <div class="form-group">
                <label>ì„±ëª…</label>
                <input type="text" id="userName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>

            <div class="form-group">
                <label>ì„±ë³„</label>
                <div class="btn-select-group">
                    <label><input type="radio" name="gender" value="ë‚¨">ë‚¨ì</label>
                    <label><input type="radio" name="gender" value="ì—¬">ì—¬ì</label>
                </div>
            </div>

            <div class="form-group">
                <label>ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ <span class="sub-desc">(13ìë¦¬)</span></label>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="number" id="rrn1" placeholder="ì• 6ìë¦¬" style="flex:1; text-align:center;" oninput="if(this.value.length>6) this.value=this.value.slice(0,6)">
                    <span>-</span>
                    <input type="password" id="rrn2" placeholder="ë’¤ 7ìë¦¬" style="flex:1; text-align:center;" oninput="if(this.value.length>7) this.value=this.value.slice(0,7)">
                </div>
            </div>

            <div class="form-group">
                <label>ì—°ë½ì²˜ (ë³¸ì¸)</label>
                <input type="tel" id="telSelf" placeholder="010-0000-0000">
            </div>

            <div class="form-group">
                <label>ì—°ë½ì²˜ (ë³´í˜¸ì)</label>
                <input type="tel" id="telParent" placeholder="010-0000-0000">
            </div>

            <div class="form-group">
                <label>í˜„ì¬ ì²­ì†Œë…„ ìƒíƒœ</label>
                <div class="btn-select-group" style="flex-direction: column;">
                    <label><input type="radio" name="status" value="í•™êµë°–ì²­ì†Œë…„">í•™êµ ë°– ì²­ì†Œë…„ (ìí‡´, ë¯¸ì§„í•™, ì œì  ë“±)</label>
                    <label><input type="radio" name="status" value="ê³ ì¡¸ê²€ì •ê³ ì‹œí•©ê²©">ê³ ì¡¸ ê²€ì •ê³ ì‹œ í•©ê²© ì²­ì†Œë…„</label>
                    <label><input type="radio" name="status" value="í•™ì—…ì¤‘ë‹¨ìˆ™ë ¤ì œ">í•™ì—…ì¤‘ë‹¨ ìˆ™ë ¤ì œ ìƒë‹´ ì°¸ì—¬ ì¤‘</label>
                </div>
            </div>
        </div>
    </div>

    <div id="step-2" class="wizard-step hidden">
        <div class="card">
            <h2>2. í•™ì—… ì¤‘ë‹¨ ë° ë°°ê²½</h2>

            <div class="form-group">
                <label>ë§ˆì§€ë§‰ìœ¼ë¡œ ë‹¤ë‹Œ í•™êµ (ì¤‘ë‹¨ ì‹œê¸°)</label>
                <div class="btn-select-group" style="margin-bottom: 10px;">
                    <label><input type="radio" name="schoolLevel" value="ì´ˆ" onclick="setGrades(6)">ì´ˆë“±í•™êµ</label>
                    <label><input type="radio" name="schoolLevel" value="ì¤‘" onclick="setGrades(3)">ì¤‘í•™êµ</label>
                    <label><input type="radio" name="schoolLevel" value="ê³ " onclick="setGrades(3)">ê³ ë“±í•™êµ</label>
                    <label><input type="radio" name="schoolLevel" value="ë¯¸ì§„í•™" onclick="setGrades(0)">ì§„í•™ ì•ˆ í•¨</label>
                </div>
                <div id="grade-area" class="grid-options hidden">
                    </div>
            </div>

            <div class="form-group">
                <label>í•™êµë¥¼ ê·¸ë§Œë‘” ë‚ ì§œ (ë…„/ì›”/ì¼)</label>
                <input type="date" id="dropDate">
            </div>

            <div class="form-group">
                <label>í•™êµë¥¼ ê·¸ë§Œë‘ê²Œ ëœ ì´ìœ  <span class="sub-desc">(1ìˆœìœ„ëŠ” í•„ìˆ˜)</span></label>
                <p style="font-size:0.9rem; color:#666; margin-bottom:5px;">â€» 1ìˆœìœ„: ê°€ì¥ í° ì´ìœ , 2/3ìˆœìœ„: ê·¸ ë‹¤ìŒ ì´ìœ </p>
                
                <select id="reason1" onchange="filterReasons()" style="margin-bottom:8px; font-weight:bold; border-color:var(--primary);">
                    <option value="">1ìˆœìœ„ ì„ íƒ (í•„ìˆ˜)</option>
                    </select>
                <select id="reason2" onchange="filterReasons()" style="margin-bottom:8px;">
                    <option value="">2ìˆœìœ„ ì„ íƒ (ì„ íƒ)</option>
                </select>
                <select id="reason3" style="margin-bottom:8px;">
                    <option value="">3ìˆœìœ„ ì„ íƒ (ì„ íƒ)</option>
                </select>
                <input type="text" id="reasonEtc" placeholder="ê¸°íƒ€ ì„ íƒ ì‹œ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" class="hidden">
            </div>

            <div class="form-group">
                <label>ê·¸ë§Œë‘˜ ë‹¹ì‹œ ë¶€ëª¨ë‹˜(ë³´í˜¸ì)ì˜ ì˜ê²¬</label>
                <div class="btn-select-group">
                    <label><input type="radio" name="parentAgree" value="ë™ì˜">ë™ì˜í•¨</label>
                    <label><input type="radio" name="parentAgree" value="ë°˜ëŒ€">ë°˜ëŒ€í•¨</label>
                    <label><input type="radio" name="parentAgree" value="ë¬´ê´€ì‹¬">ë¬´ê´€ì‹¬</label>
                    <label><input type="radio" name="parentAgree" value="ì˜ëª¨ë¦„">ì˜ ëª¨ë¦„</label>
                    <label><input type="radio" name="parentAgree" value="ê¸°íƒ€">ê¸°íƒ€</label>
                </div>
            </div>
        </div>
    </div>

    <div id="step-3" class="wizard-step hidden">
        <div class="card">
            <h2>3. ê¿ˆë“œë¦¼ ì„¼í„° ë°©ë¬¸ ê²½ë¡œ</h2>
            <div class="form-group">
                <label>ì–´ë–»ê²Œ ì•Œê³  ì˜¤ê²Œ ë˜ì—ˆë‚˜ìš”?</label>
                <div class="btn-select-group" style="flex-direction: column; align-items: stretch;">
                    <label><input type="radio" name="visitPath" value="ì¹œêµ¬/ì„ ë°°">ì¹œêµ¬, ì„ ë°°ì˜ ì†Œê°œ</label>
                    <label><input type="radio" name="visitPath" value="ê°€ì¡±">ë¶€ëª¨ë‹˜, í˜•ì œ ë“± ê°€ì¡±ì˜ ê¶Œìœ </label>
                    <label><input type="radio" name="visitPath" value="í•™êµ">í•™êµ ì„ ìƒë‹˜ì˜ ì•ˆë‚´</label>
                    <label><input type="radio" name="visitPath" value="ì¸í„°ë„·">ì¸í„°ë„· ê²€ìƒ‰ (ë„¤ì´ë²„, SNS ë“±)</label>
                    <label><input type="radio" name="visitPath" value="ê²½ì°°">ê²½ì°°ì„œ, ë³´í˜¸ê´€ì°°ì†Œ ì—°ê³„</label>
                    <label><input type="radio" name="visitPath" value="í™ë³´ë¬¼">ê¸¸ê±°ë¦¬ í™ë³´, í˜„ìˆ˜ë§‰</label>
                    <label><input type="radio" name="visitPath" value="ê¸°íƒ€">ê¸°íƒ€</label>
                </div>
            </div>
        </div>
    </div>

    <div id="step-4" class="wizard-step hidden">
        <div class="card">
            <h2>4. ê°€ì¡± ë° ê²½ì œ ìƒí™©</h2>
            
            <div class="form-group">
                <label>ê°€ì¡± êµ¬ì„±ì› <span class="sub-desc">(ìµœëŒ€ 5ëª…, ì„ íƒì‚¬í•­)</span></label>
                <div class="family-header">
                    <span>ê´€ê³„</span><span>ì„±ëª…</span><span>ì—°ë ¹</span><span>ì—°ë½ì²˜</span><span>ë™ê±°</span>
                </div>
                <div id="family-rows">
                    </div>
            </div>

            <h3>ê°€ì • í™˜ê²½ ìƒì„¸</h3>
            <div class="form-group">
                <label>í˜„ì¬ ê°€ì • í˜•íƒœ</label>
                <div class="btn-select-group">
                    <label><input type="radio" name="famType" value="ì¹œë¶€ëª¨">ì¹œë¶€ëª¨ ê°€ì¡±</label>
                    <label><input type="radio" name="famType" value="í•œë¶€ëª¨(ë¶€)">í•œë¶€ëª¨(ì•„ë²„ì§€)</label>
                    <label><input type="radio" name="famType" value="í•œë¶€ëª¨(ëª¨)">í•œë¶€ëª¨(ì–´ë¨¸ë‹ˆ)</label>
                    <label><input type="radio" name="famType" value="ì¡°ì†">ì¡°ì† ê°€ì¡±</label>
                    <label><input type="radio" name="famType" value="ì¬í˜¼">ì¬í˜¼ ê°€ì¡±</label>
                    <label><input type="radio" name="famType" value="ì²­ì†Œë…„ê°€ì¥">ì²­ì†Œë…„ ê°€ì¥</label>
                    <label><input type="radio" name="famType" value="ì‹œì„¤">ì‹œì„¤/ì‰¼í„°</label>
                    <label><input type="radio" name="famType" value="ì¹œì¸ì²™">ì¹œì¸ì²™ ìœ„íƒ</label>
                    <label><input type="radio" name="famType" value="ê¸°íƒ€">ê¸°íƒ€</label>
                </div>
            </div>

            <div class="form-group">
                <label>ê°€ì •ì˜ ê²½ì œ ìƒíƒœ (ë³¸ì¸ ìƒê°)</label>
                <div class="btn-select-group">
                    <label><input type="radio" name="econ" value="ìƒ">ì—¬ìœ  ìˆìŒ</label>
                    <label><input type="radio" name="econ" value="ì¤‘">ë³´í†µì´ë‹¤</label>
                    <label><input type="radio" name="econ" value="í•˜">ì–´ë µë‹¤</label>
                    <label><input type="radio" name="econ" value="ê¸°ì´ˆìˆ˜ê¸‰">êµ­ê°€ì§€ì›(ìˆ˜ê¸‰) ë°›ìŒ</label>
                </div>
            </div>

            <div class="form-group">
                <label>ìš©ëˆì€ ì¶©ë¶„í•œê°€ìš”?</label>
                <div class="btn-select-group">
                    <label><input type="radio" name="moneySat" value="ì¶©ë¶„">ì¶©ë¶„í•¨</label>
                    <label><input type="radio" name="moneySat" value="ë³´í†µ">ë³´í†µ</label>
                    <label><input type="radio" name="moneySat" value="ë¶€ì¡±">ë¶€ì¡±í•¨</label>
                    <label><input type="radio" name="moneySat" value="ì—†ìŒ">ì•ˆ ë°›ìŒ</label>
                </div>
            </div>

            <div class="form-group">
                <label>ê°€ì • ë‚´ ê´€ì‹¬ ì •ë„</label>
                <div class="btn-select-group">
                    <label><input type="radio" name="famInterest" value="ë§¤ìš°ë§ìŒ">ë§¤ìš° ë§ìŒ</label>
                    <label><input type="radio" name="famInterest" value="ì•½ê°„">ì•½ê°„ ìˆìŒ</label>
                    <label><input type="radio" name="famInterest" value="ë³´í†µ">ë³´í†µ</label>
                    <label><input type="radio" name="famInterest" value="ë³„ë¡œì—†ìŒ">ë³„ë¡œ ì—†ìŒ</label>
                    <label><input type="radio" name="famInterest" value="ì „í˜€ì—†ìŒ">ì „í˜€ ì—†ìŒ</label>
                </div>
            </div>

            <div class="form-group">
                <label>ê³ ë¯¼ì„ ì£¼ë¡œ ì˜ë…¼í•˜ëŠ” ëŒ€ìƒ</label>
                <div class="btn-select-group">
                    <label><input type="radio" name="talkTarget" value="ë¶€ëª¨">ë¶€ëª¨ë‹˜</label>
                    <label><input type="radio" name="talkTarget" value="í˜•ì œ">í˜•ì œ/ìë§¤</label>
                    <label><input type="radio" name="talkTarget" value="ì¹œêµ¬">ì¹œêµ¬</label>
                    <label><input type="radio" name="talkTarget" value="ì„ ìƒë‹˜">ì„ ìƒë‹˜</label>
                    <label><input type="radio" name="talkTarget" value="ì—†ìŒ">ì—†ìŒ(í˜¼ì í•´ê²°)</label>
                </div>
            </div>
        </div>
    </div>

    <div id="step-5" class="wizard-step hidden">
        <div class="card">
            <h2>5. ì–´ë ¤ì›€ ë° ì„œë¹„ìŠ¤ ìš•êµ¬</h2>
            
            <div class="form-group">
                <label>í˜„ì¬ ê²ªê³  ìˆëŠ” ì–´ë ¤ì›€ (í•´ë‹¹ë˜ëŠ” ê²ƒ ëª¨ë‘ ì²´í¬)</label>
                
                <h3>ğŸ˜Ÿ ê°œì¸ì  ì–´ë ¤ì›€</h3>
                <div class="btn-select-group">
                    <label><input type="checkbox" name="diff" value="ì„±ê²©">ì„±ê²©/ì •ì„œ(ìš°ìš¸,ë¶ˆì•ˆ)</label>
                    <label><input type="checkbox" name="diff" value="ê±´ê°•">ì‹ ì²´ ê±´ê°•</label>
                    <label><input type="checkbox" name="diff" value="ìƒí™œìŠµê´€">ë¶ˆê·œì¹™í•œ ìƒí™œ</label>
                    <label><input type="checkbox" name="diff" value="ì¥ì• ">ì¥ì•  ê´€ë ¨</label>
                </div>

                <h3>ğŸ  ê°€ì • ë° í™˜ê²½</h3>
                <div class="btn-select-group">
                    <label><input type="checkbox" name="diff" value="ê°€ì¡±ê°ˆë“±">ê°€ì¡± ê°„ì˜ ê°ˆë“±</label>
                    <label><input type="checkbox" name="diff" value="ê²½ì œ">ê²½ì œì  ì–´ë ¤ì›€</label>
                    <label><input type="checkbox" name="diff" value="ë¶€ëª¨ë°©ì„">ë¶€ëª¨ë‹˜ì˜ ë¬´ê´€ì‹¬</label>
                </div>

                <h3>ğŸ« í•™êµ ë° ì‚¬íšŒ</h3>
                <div class="btn-select-group">
                    <label><input type="checkbox" name="diff" value="í•™ì—…">ê³µë¶€/ì„±ì  ë¬¸ì œ</label>
                    <label><input type="checkbox" name="diff" value="ì§„ë¡œ">ì§„ë¡œ ë¯¸ê²°ì •</label>
                    <label><input type="checkbox" name="diff" value="ì¹œêµ¬">ì¹œêµ¬ ê´€ê³„</label>
                    <label><input type="checkbox" name="diff" value="ë”°ëŒë¦¼">ë”°ëŒë¦¼/ê´´ë¡­í˜</label>
                </div>

                <h3>ğŸ® í–‰ë™ ë° ê¸°íƒ€</h3>
                <div class="btn-select-group">
                    <label><input type="checkbox" name="diff" value="ìŠ¤ë§ˆíŠ¸í°">ìŠ¤ë§ˆíŠ¸í°/ê²Œì„ ê³¼ëª°ì…</label>
                    <label><input type="checkbox" name="diff" value="ë¹„í–‰">ìŒì£¼/í¡ì—°/ë¹„í–‰</label>
                    <label><input type="checkbox" name="diff" value="ë²•ë¥ ">ë²•ì  ë¬¸ì œ</label>
                    <label><input type="checkbox" name="diff" value="ì„±">ì„± ê´€ë ¨ ê³ ë¯¼</label>
                </div>
            </div>

            <div class="form-group">
                <label>í•™êµ ì¤‘ë‹¨ í›„ ëª©í‘œ</label>
                <div class="btn-select-group">
                    <label><input type="radio" name="goal" value="ê²€ì •ê³ ì‹œ">ê²€ì •ê³ ì‹œ í•©ê²©</label>
                    <label><input type="radio" name="goal" value="ë³µí•™">í•™êµ ë³µí•™</label>
                    <label><input type="radio" name="goal" value="ì§„í•™">ìƒê¸‰í•™êµ(ëŒ€í•™) ì§„í•™</label>
                    <label><input type="radio" name="goal" value="ì·¨ì—…">ì·¨ì—…/ì•„ë¥´ë°”ì´íŠ¸</label>
                    <label><input type="radio" name="goal" value="ìê²©ì¦">ìê²©ì¦ ì·¨ë“</label>
                    <label><input type="radio" name="goal" value="ë¬´ê³„íš">ì•„ì§ ê³„íš ì—†ìŒ</label>
                </div>
            </div>

            <div class="form-group">
                <label>ê¿ˆë“œë¦¼ì—ì„œ ë°›ê³  ì‹¶ì€ ì„œë¹„ìŠ¤ (ì¤‘ë³µ ê°€ëŠ¥)</label>
                <div class="btn-select-group">
                    <label><input type="checkbox" name="service" value="ìƒë‹´">ì‹¬ë¦¬ìƒë‹´</label>
                    <label><input type="checkbox" name="service" value="êµìœ¡">í•™ì—…ì§€ì›(ê²€ì •ê³ ì‹œ)</label>
                    <label><input type="checkbox" name="service" value="ìë¦½">ìë¦½ì§€ì›(ìê²©ì¦/ì¸í„´)</label>
                    <label><input type="checkbox" name="service" value="ë¬¸í™”">ë¬¸í™”ì²´í—˜/ë™ì•„ë¦¬</label>
                    <label><input type="checkbox" name="service" value="ê±´ê°•">ê±´ê°•ê²€ì§„</label>
                    <label><input type="checkbox" name="service" value="ê²½ì œ">ê¸‰ì‹/êµí†µë¹„ ì§€ì›</label>
                    <label><input type="checkbox" name="service" value="ë©˜í† ë§">ëŒ€í•™ìƒ ë©˜í† ë§</label>
                </div>
            </div>

            <div class="form-group">
                <label>ê³¼ê±° í•™êµìƒí™œ ë§Œì¡±ë„</label>
                <div class="btn-select-group">
                    <label><input type="radio" name="pastSchool" value="ë§Œì¡±">ë§Œì¡±í–ˆë‹¤</label>
                    <label><input type="radio" name="pastSchool" value="ë³´í†µ">ë³´í†µì´ë‹¤</label>
                    <label><input type="radio" name="pastSchool" value="ë¶ˆë§Œì¡±">ë¶ˆë§Œì¡±í–ˆë‹¤</label>
                </div>
            </div>

            <div class="form-group">
                <label>í˜„ì¬ ê±´ê°• ìƒíƒœ</label>
                <div class="btn-select-group">
                    <label><input type="radio" name="health" value="ì¢‹ìŒ">ê±´ê°•í•˜ë‹¤</label>
                    <label><input type="radio" name="health" value="ë³´í†µ">ë³´í†µì´ë‹¤</label>
                    <label><input type="radio" name="health" value="ë‚˜ì¨">ê±´ê°•í•˜ì§€ ì•Šë‹¤</label>
                </div>
            </div>
        </div>
    </div>

    <div id="step-6" class="wizard-step hidden">
        <div class="card">
            <h2 id="scale-title">ì²™ë„ ê²€ì‚¬</h2>
            <div id="questions-area"></div>
        </div>
    </div>

    <div id="step-end" class="wizard-step hidden text-center" style="padding-top:50px;">
        <h1 style="font-size:3rem;">ğŸ‰</h1>
        <h2>ëª¨ë“  ì‘ì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h2>
        <p style="color:#666; font-size:1.1rem; line-height:1.6;">
            ê¸´ ì„¤ë¬¸ì— ì‘ë‹µí•˜ëŠë¼ ê³ ìƒ ë§ìœ¼ì…¨ìŠµë‹ˆë‹¤.<br>
            íƒœë¸”ë¦¿ì„ ìƒë‹´ ì„ ìƒë‹˜ê»˜ ë“œë ¤ì£¼ì„¸ìš”.
        </p>
        <button class="nav-btn" style="margin-top:30px;" onclick="location.reload()">ì²˜ìŒìœ¼ë¡œ</button>
    </div>

</div>

<div class="bottom-bar no-print hidden" id="bottom-bar">
    <button class="btn-prev" onclick="moveStep(-1)">ì´ì „</button>
    <button class="btn-save" onclick="saveDraft()">ì„ì‹œì €ì¥</button>
    <button class="btn-next" onclick="moveStep(1)" id="btn-next-text">ë‹¤ìŒ</button>
</div>

<script>
    // [1] Firebase ì„¤ì •
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY", // ë³¸ì¸ì˜ í‚¤ë¡œ ë³€ê²½í•˜ì„¸ìš”
        authDomain: "kdream-db462.firebaseapp.com",
        projectId: "kdream-db462",
        storageBucket: "kdream-db462.firebasestorage.app",
        messagingSenderId: "1020262030810",
        appId: "1:1020262030810:web:3482636bc020bb4310b4e3"
    };

    let db;
    try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
    } catch(e) { console.log("Firebase not init (Local mode)"); }

    // [2] ì „ì—­ ë³€ìˆ˜ ë° ì´ˆê¸°í™”
    let currentStep = 0;
    const totalSteps = 7; 
    let userData = {};
    let answers = {};
    let scalePart = "jarip"; // jarip -> simni

    const DROPOUT_REASONS = [
        "ê³µë¶€í•˜ê¸° ì‹«ì–´ì„œ", "ì›í•˜ëŠ” ê³µë¶€(ê²€ì •ê³ ì‹œ ë“±)ë¥¼ í•˜ê¸° ìœ„í•´", "í•™êµ ì¹œêµ¬ì™€ì˜ ë¬¸ì œ", 
        "ì„ ìƒë‹˜ê³¼ì˜ ê°ˆë“±", "í•™êµ ê·œì¹™ ë¶€ì ì‘", "í•™êµí­ë ¥ í”¼í•´", "ë°©ì†¡/ì—°ì˜ˆ/ì²´ìœ¡ í™œë™", 
        "ê²½ì œì  ì‚¬ì •", "ì§ˆë³‘ ë° ì‚¬ê³ ", "ê°€ì¶œ", "ë¹„í–‰/ë²•ì ë¬¸ì œ", "ì‹¬ë¦¬/ì •ì„œì  ë¬¸ì œ", 
        "í•´ì™¸ìœ í•™/ì´ë¯¼", "ê¸°íƒ€"
    ];

    window.onload = function() {
        initFamilyRows();
        initReasonOptions();
        loadDraft(); // ì„ì‹œì €ì¥ ë¶ˆëŸ¬ì˜¤ê¸°
    };

    function initFamilyRows() {
        const area = document.getElementById('family-rows');
        for(let i=1; i<=5; i++) {
            area.innerHTML += `
                <div class="family-input-row">
                    <input type="text" id="famRel${i}" placeholder="ê´€ê³„">
                    <input type="text" id="famName${i}" placeholder="ì„±ëª…">
                    <input type="number" id="famAge${i}" placeholder="ì—°ë ¹">
                    <input type="tel" id="famTel${i}" placeholder="ì—°ë½ì²˜">
                    <select id="famLive${i}"><option value="Y">O</option><option value="N">X</option></select>
                </div>
            `;
        }
    }

    function initReasonOptions() {
        const selects = ['reason1', 'reason2', 'reason3'];
        selects.forEach(id => {
            const el = document.getElementById(id);
            DROPOUT_REASONS.forEach(r => {
                const opt = document.createElement('option');
                opt.value = r;
                opt.text = r;
                el.appendChild(opt);
            });
        });
    }

    function filterReasons() {
        const r1 = document.getElementById('reason1').value;
        const r2 = document.getElementById('reason2');
        const r3 = document.getElementById('reason3');
        const etc = document.getElementById('reasonEtc');

        // ê¸°íƒ€ ì…ë ¥ì°½ í† ê¸€
        if(r1 === 'ê¸°íƒ€') etc.classList.remove('hidden');
        else etc.classList.add('hidden');

        // ì˜µì…˜ ìˆ¨ê¹€ ì²˜ë¦¬ (ë‹¨ìˆœí™”: ì´ë¯¸ ì„ íƒëœ ê°’ ë¹„í™œì„±í™”)
        // ì‹¤ì œë¡œëŠ” optionsë¥¼ ë‹¤ì‹œ ê·¸ë¦¬ëŠ”ê²Œ ì¢‹ì§€ë§Œ, ì—¬ê¸°ì„  ê°„ë‹¨íˆ
    }

    function setGrades(max) {
        const area = document.getElementById('grade-area');
        area.innerHTML = "";
        area.classList.remove('hidden');
        if(max === 0) {
            area.classList.add('hidden');
            return;
        }
        for(let i=1; i<=max; i++) {
            area.innerHTML += `
                <label class="btn-select-group" style="display:inline-block; width:auto; margin:0;">
                    <label style="min-width:60px;"><input type="radio" name="dropGrade" value="${i}í•™ë…„">${i}í•™ë…„</label>
                </label>
            `;
        }
    }

    // [3] ë„¤ë¹„ê²Œì´ì…˜ ë° ë¡œì§
    function startSurvey() {
        document.getElementById('intro-page').classList.add('hidden');
        document.getElementById('wizard-container').classList.remove('hidden');
        document.getElementById('bottom-bar').classList.remove('hidden');
        moveStep(1);
    }

    function moveStep(direction) {
        // í˜„ì¬ ìŠ¤í… ìˆ¨ê¸°ê¸° (ë‹¨, 0ì¸ ê²½ìš° ì œì™¸)
        if(currentStep > 0 && currentStep <= 6) {
            document.getElementById(`step-${currentStep}`).classList.add('hidden');
        }

        // ìŠ¤í… ì´ë™
        if(direction === 1) currentStep++;
        else if(direction === -1) currentStep--;

        // ë²”ìœ„ ì²´í¬
        if(currentStep < 1) currentStep = 1;
        
        // ìŠ¤í…ë³„ ë¡œì§
        if(currentStep === 6) { // ì²™ë„ ì‹œì‘
            startScale(); 
        } else if(currentStep > 6) { // ì™„ë£Œ
            submitFinal();
            return;
        }

        // í•´ë‹¹ ìŠ¤í… ë³´ì´ê¸°
        document.getElementById(`step-${currentStep}`).classList.remove('hidden');
        
        // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
        document.getElementById('btn-next-text').innerText = (currentStep === 6) ? "ë‹¤ìŒ (ì²™ë„)" : "ë‹¤ìŒ";
        if(scalePart === 'simni' && currentStep === 6) document.getElementById('btn-next-text').innerText = "ì œì¶œí•˜ê¸°";

        // ì§„í–‰ë°”
        document.querySelector('.progress-bar').style.width = (currentStep / totalSteps * 100) + "%";
        window.scrollTo(0,0);
    }

    // [4] ë°ì´í„° ìˆ˜ì§‘ ë° ì²™ë„ ë¡œì§
    function startScale() {
        collectFormData(); // ì•ì„  í¼ ë°ì´í„° ì €ì¥
        
        // ë‚˜ì´ ê³„ì‚°
        const birthYear = document.getElementById('rrn1').value.substring(0,2);
        const fullYear = (parseInt(birthYear) > 25) ? 19 + birthYear : 20 + birthYear; // ëŒ€ëµì  ë¡œì§
        const age = new Date().getFullYear() - parseInt(fullYear);
        userData.type = (age >= 13) ? "YOUTH" : "CHILD";
        
        renderQuestions("jarip");
    }

    function renderQuestions(part) {
        scalePart = part;
        const list = DB_QUESTIONS[userData.type][part];
        const area = document.getElementById('questions-area');
        document.getElementById('scale-title').innerText = (part === 'jarip') ? "5-1. ìë¦½ì—­ëŸ‰ ì²™ë„" : "5-2. ì‹¬ë¦¬ì •ì„œ ì²™ë„";
        
        area.innerHTML = "";
        list.forEach((q, idx) => {
            area.innerHTML += `
                <div class="q-card">
                    <div class="q-text">${idx+1}. ${q.t}</div>
                    <div class="btn-select-group">
                        <label><input type="radio" name="${part}_${q.n}" value="1" onchange="saveAns('${part}',${q.n},1,${q.rev},${q.crit},'${q.d}','${q.t}')">ì „í˜€ì•„ë‹˜</label>
                        <label><input type="radio" name="${part}_${q.n}" value="2" onchange="saveAns('${part}',${q.n},2,${q.rev},${q.crit},'${q.d}','${q.t}')">ì•„ë‹ˆë‹¤</label>
                        <label><input type="radio" name="${part}_${q.n}" value="3" onchange="saveAns('${part}',${q.n},3,${q.rev},${q.crit},'${q.d}','${q.t}')">ë³´í†µ</label>
                        <label><input type="radio" name="${part}_${q.n}" value="4" onchange="saveAns('${part}',${q.n},4,${q.rev},${q.crit},'${q.d}','${q.t}')">ê·¸ë ‡ë‹¤</label>
                        <label><input type="radio" name="${part}_${q.n}" value="5" onchange="saveAns('${part}',${q.n},5,${q.rev},${q.crit},'${q.d}','${q.t}')">ë§¤ìš°ê·¸ë ‡ë‹¤</label>
                    </div>
                </div>
            `;
        });
        
        if(part === 'simni') document.getElementById('btn-next-text').innerText = "ì œì¶œí•˜ê¸°";
    }

    function saveAns(part, n, v, r, c, d, t) {
        answers[`${part}_${n}`] = {val:v, rev:r, crit:c, domain:d, text:t};
    }

    // ë‹¤ìŒ ë²„íŠ¼ í´ë¦­ ì‹œ (ì²™ë„ ë‚´ë¶€ ì´ë™ í¬í•¨)
    function handleNext() {
        if(currentStep === 6) {
            if(scalePart === 'jarip') {
                renderQuestions('simni');
                window.scrollTo(0,0);
            } else {
                moveStep(1); // ì™„ë£Œ í˜ì´ì§€ë¡œ
            }
        } else {
            moveStep(1);
        }
    }
    
    // ì˜¤ë²„ë¼ì´ë“œ: ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ë¥¼ ì—¬ê¸°ë¡œ ì—°ê²°
    document.querySelector('.btn-next').onclick = handleNext;

    function collectFormData() {
        // ì…ë ¥ê°’ ìˆ˜ì§‘ (ID ê¸°ì¤€)
        userData.name = document.getElementById('userName').value;
        userData.rrn = document.getElementById('rrn1').value + "-" + document.getElementById('rrn2').value;
        userData.telSelf = document.getElementById('telSelf').value;
        userData.dropDate = document.getElementById('dropDate').value;
        userData.reason1 = document.getElementById('reason1').value;
        userData.reasonEtc = document.getElementById('reasonEtc').value;
        
        // ë¼ë””ì˜¤ ê°’ ìˆ˜ì§‘
        ['gender', 'status', 'schoolLevel', 'dropGrade', 'parentAgree', 'visitPath', 
         'famType', 'econ', 'moneySat', 'famInterest', 'talkTarget', 'goal', 'pastSchool', 'health'].forEach(key => {
            const el = document.querySelector(`input[name="${key}"]:checked`);
            userData[key] = el ? el.value : "";
        });

        // ì²´í¬ë°•ìŠ¤ ìˆ˜ì§‘ (ì–´ë ¤ì›€, ì„œë¹„ìŠ¤)
        let diffs = []; document.querySelectorAll(`input[name="diff"]:checked`).forEach(e=>diffs.push(e.value));
        userData.difficulties = diffs.join(",");
        
        let servs = []; document.querySelectorAll(`input[name="service"]:checked`).forEach(e=>servs.push(e.value));
        userData.services = servs.join(",");

        // ê°€ì¡±
        let fam = [];
        for(let i=1; i<=5; i++) {
            let rel = document.getElementById(`famRel${i}`).value;
            let nm = document.getElementById(`famName${i}`).value;
            if(rel && nm) fam.push(`${rel}/${nm}`);
        }
        userData.family = fam.join(", ");
    }

    // [ê¸°ëŠ¥] ì„ì‹œì €ì¥
    function saveDraft() {
        collectFormData();
        const data = { user: userData, ans: answers, step: currentStep };
        localStorage.setItem('kdream_draft', JSON.stringify(data));
        alert('í˜„ì¬ê¹Œì§€ ë‚´ìš©ì´ ê¸°ê¸°ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    function loadDraft() {
        const draft = localStorage.getItem('kdream_draft');
        if(draft) {
            if(confirm('ì´ì „ì— ì‘ì„±í•˜ë˜ ë‚´ìš©ì´ ìˆìŠµë‹ˆë‹¤. ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                const d = JSON.parse(draft);
                // (ì‹¤ì œë¡œëŠ” ì—¬ê¸°ì„œ ê°’ì„ í•˜ë‚˜í•˜ë‚˜ í¼ì— ë„£ì–´ì£¼ëŠ” ì½”ë“œê°€ í•„ìš”í•¨. ë¶„ëŸ‰ìƒ ìƒëµë˜ì—ˆìœ¼ë‚˜ êµ¬ì¡°ëŠ” ì´ë ‡ìŠµë‹ˆë‹¤.)
                alert('ë¶ˆëŸ¬ì˜¤ê¸° ì™„ë£Œ (êµ¬í˜„ í•„ìš”)'); 
            }
        }
    }

    function submitFinal() {
        collectFormData();
        const payload = {
            info: userData,
            ans: answers,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        if(db) {
            db.collection("intake_full").add(payload).then(() => {
                document.getElementById('step-6').classList.add('hidden');
                document.getElementById('bottom-bar').classList.add('hidden');
                document.getElementById('step-end').classList.remove('hidden');
                localStorage.removeItem('kdream_draft');
            });
        } else {
            alert("DB ë¯¸ì—°ê²°: ë¡œì»¬ ì €ì¥ë¨");
            document.getElementById('step-6').classList.add('hidden');
            document.getElementById('step-end').classList.remove('hidden');
        }
    }

    // [ê´€ë¦¬ì ëª¨ë“œ ë“± ë‚˜ë¨¸ì§€ ì½”ë“œëŠ” ì´ì „ ë‹µë³€ì˜ ë¡œì§ê³¼ ë™ì¼í•˜ê²Œ ìœ ì§€í•˜ê±°ë‚˜ í•„ìš” ì‹œ ì¶”ê°€]
    // ... (ì´ì „ ì½”ë“œì˜ admin ê´€ë ¨ í•¨ìˆ˜ë“¤ ë³µì‚¬í•´ì„œ ì‚¬ìš© ê°€ëŠ¥)

    // [ë°ì´í„°ì…‹: ê°„ì†Œí™”ëœ ì˜ˆì‹œ, ì‹¤ì œë¡œëŠ” ì „ì²´ ë³µì‚¬ í•„ìš”]
    const DB_QUESTIONS = {
        YOUTH: {
            jarip: [{n:1,t:"ë‚˜ëŠ” ê°€ì¹˜ìˆëŠ” ì‚¬ëŒì´ë‹¤",d:"ìì¡´ê°"},{n:7,t:"ë§¡ê²¨ì§„ ì¼ì€ ëê¹Œì§€ í•œë‹¤",d:"ì„±ì‹¤ì„±"}],
            simni: [{n:1,t:"ìš°ìš¸í•˜ë‹¤",d:"ìš°ìš¸"},{n:48,t:"ìì‚´ìƒê°",d:"ìì‚´",crit:true}]
        },
        CHILD: {
            jarip: [{n:1,t:"ë‚˜ëŠ” ì¢‹ì€ ì ì´ ë§ë‹¤",d:"ìì¡´ê°"}],
            simni: [{n:1,t:"í”¼ê³¤í•˜ë‹¤",d:"ìš°ìš¸"}]
        }
    };
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë…¸ì›êµ¬ ê¿ˆë“œë¦¼ í¬ë§ì„œë¹„ìŠ¤ ì¡°ì‚¬í‘œ</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --primary: #FF7F50; --bg: #FFF9F5; --white: #ffffff; --text: #333; --border: #ddd; }
        
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; padding-bottom: 80px; -webkit-tap-highlight-color: transparent; }
        
        /* í—¤ë” & ì§„í–‰ë°” */
        .header { position: fixed; top: 0; width: 100%; height: 50px; background: var(--white); z-index: 100; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; align-items: center; padding: 0 20px; }
        .progress-bar-bg { position: fixed; top: 50px; left: 0; width: 100%; height: 5px; background: #eee; z-index: 99; }
        .progress-bar-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }
        
        .container { max-width: 800px; margin: 80px auto 0; padding: 20px; }
        .card { background: var(--white); border-radius: 15px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        
        h1 { color: var(--primary); text-align: center; margin-bottom: 5px; }
        h2 { border-bottom: 2px solid var(--primary); padding-bottom: 10px; margin-top: 0; color: #444; font-size: 1.3rem; }
        h3 { background: #f4f4f4; padding: 10px; border-radius: 8px; font-size: 1.1rem; margin-top: 30px; }

        /* ì…ë ¥ ìš”ì†Œ */
        label { display: block; font-weight: 700; margin-bottom: 8px; margin-top: 20px; }
        .sub-text { font-weight: normal; font-size: 0.9em; color: #888; }
        
        input, select { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 10px; font-size: 1rem; box-sizing: border-box; background: #fff; }
        input:focus, select:focus { border-color: var(--primary); outline: none; }

        /* ë²„íŠ¼í˜• ë¼ë””ì˜¤/ì²´í¬ë°•ìŠ¤ */
        .btn-group { display: flex; flex-wrap: wrap; gap: 8px; }
        .btn-group label { margin: 0; flex: 1; min-width: 80px; text-align: center; padding: 12px; border: 1px solid var(--border); border-radius: 10px; background: #fff; cursor: pointer; transition: 0.2s; font-weight: 500; display: flex; align-items: center; justify-content: center; }
        .btn-group input { display: none; }
        .btn-group label:has(input:checked) { background: #FFF0EB; border-color: var(--primary); color: var(--primary); font-weight: 800; box-shadow: 0 0 0 1px var(--primary); }

        /* í•˜ë‹¨ ë²„íŠ¼ë°” */
        .bottom-bar { position: fixed; bottom: 0; left: 0; width: 100%; padding: 15px; background: var(--white); border-top: 1px solid #eee; display: flex; gap: 10px; box-sizing: border-box; z-index: 100; }
        .btn { padding: 15px; border-radius: 10px; border: none; font-size: 1.1rem; font-weight: bold; cursor: pointer; flex: 1; }
        .btn-prev { background: #eee; color: #555; }
        .btn-save { background: #555; color: #fff; flex: 0.6; font-size: 1rem; }
        .btn-next { background: var(--primary); color: #fff; flex: 2; }

        .hidden { display: none !important; }
        .family-row { display: grid; grid-template-columns: 0.8fr 1fr 0.6fr 1fr 0.6fr; gap: 5px; margin-bottom: 5px; }
        .family-row input, .family-row select { padding: 8px; font-size: 0.9rem; }

        /* ì¸ì‡„ */
        @media print {
            .no-print, .bottom-bar, .header, .progress-bar-bg { display: none !important; }
            #report-area { display: block !important; }
            body { background: white; padding: 0; }
            .card { box-shadow: none; border: none; padding: 0; }
            table { width: 100%; border-collapse: collapse; font-size: 10pt; }
            th, td { border: 1px solid #000; padding: 5px; text-align: center; }
            th { background: #eee; }
            .page-break { page-break-before: always; }
        }
    </style>
</head>
<body>

<div class="header no-print">
    <span style="font-weight:bold; color:var(--primary);">ë…¸ì›êµ¬ ê¿ˆë“œë¦¼</span>
    <span style="margin-left:auto; font-size:0.9rem; color:#888; cursor:pointer;" onclick="showAdmin()">ê´€ë¦¬ì</span>
</div>
<div class="progress-bar-bg no-print"><div class="progress-bar-fill" id="progressBar"></div></div>

<div id="page-intro" class="container" style="text-align: center; padding-top: 100px;">
    <div class="card">
        <h1 style="font-size: 2rem;">í¬ë§ ì„œë¹„ìŠ¤ ì¡°ì‚¬í‘œ</h1>
        <p style="color:#666; margin: 30px 0; line-height: 1.6;">
            ì•ˆë…•í•˜ì„¸ìš”.<br>
            ë…¸ì›êµ¬ ê¿ˆë“œë¦¼ ì„¼í„°ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.<br>
            ì—¬ëŸ¬ë¶„ì—ê²Œ ê¼­ í•„ìš”í•œ ì§€ì›ì„ ìœ„í•´<br>
            ì†”ì§í•˜ê²Œ ë‹µë³€í•´ ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤.
        </p>
        <button class="btn btn-next" style="width:100%;" onclick="startSurvey()">ì‹œì‘í•˜ê¸°</button>
    </div>
</div>

<div id="page-survey" class="container hidden">
    
    <div id="step-1" class="step-content">
        <div class="card">
            <h2>1. ê¸°ë³¸ ì¸ì ì‚¬í•­</h2>
            
            <label>ì„±ëª…</label>
            <input type="text" id="userName">

            <label>ì„±ë³„</label>
            <div class="btn-group">
                <label><input type="radio" name="gender" value="ë‚¨">ë‚¨ì</label>
                <label><input type="radio" name="gender" value="ì—¬">ì—¬ì</label>
            </div>

            <label>ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ <span class="sub-text">(13ìë¦¬)</span></label>
            <div style="display:flex; gap:10px;">
                <input type="number" id="rrn1" placeholder="ì• 6ìë¦¬" oninput="if(this.value.length>6)this.value=this.value.slice(0,6)">
                <input type="password" id="rrn2" placeholder="ë’¤ 7ìë¦¬" oninput="if(this.value.length>7)this.value=this.value.slice(0,7)">
            </div>

            <label>ì—°ë½ì²˜ (ë³¸ì¸)</label>
            <input type="tel" id="telSelf" placeholder="010-0000-0000">

            <label>ì—°ë½ì²˜ (ë³´í˜¸ì)</label>
            <input type="tel" id="telParent" placeholder="010-0000-0000">

            <label>í˜„ì¬ ìƒíƒœ</label>
            <div class="btn-group" style="flex-direction:column;">
                <label><input type="radio" name="status" value="í•™êµë°–ì²­ì†Œë…„">í•™êµ ë°– ì²­ì†Œë…„</label>
                <label><input type="radio" name="status" value="ê³ ì¡¸ê²€ì •ê³ ì‹œí•©ê²©">ê³ ì¡¸ ê²€ì •ê³ ì‹œ í•©ê²© ì²­ì†Œë…„</label>
                <label><input type="radio" name="status" value="í•™ì—…ì¤‘ë‹¨ìˆ™ë ¤ì œ">í•™ì—…ì¤‘ë‹¨ ìˆ™ë ¤ì œ ì°¸ì—¬ ì¤‘</label>
            </div>
        </div>
    </div>

    <div id="step-2" class="step-content hidden">
        <div class="card">
            <h2>2. í•™ì—… ì¤‘ë‹¨ ì •ë³´</h2>
            
            <label>ì¤‘ë‹¨ ì‹œê¸° (í•™êµê¸‰ ë° í•™ë…„)</label>
            <div class="btn-group">
                <label><input type="radio" name="schLvl" value="ì´ˆ" onclick="setGrades(6)">ì´ˆë“±í•™êµ</label>
                <label><input type="radio" name="schLvl" value="ì¤‘" onclick="setGrades(3)">ì¤‘í•™êµ</label>
                <label><input type="radio" name="schLvl" value="ê³ " onclick="setGrades(3)">ê³ ë“±í•™êµ</label>
                <label><input type="radio" name="schLvl" value="ë¯¸ì§„í•™" onclick="setGrades(0)">ë¯¸ì§„í•™</label>
            </div>
            <div id="grade-area" class="btn-group hidden" style="margin-top:10px;"></div>

            <label>ì¤‘ë‹¨ ë‚ ì§œ (ë…„ì›”ì¼)</label>
            <input type="date" id="dropDate">

            <label>ì¤‘ë‹¨ ì´ìœ  <span class="sub-text">(1ìˆœìœ„ í•„ìˆ˜)</span></label>
            <select id="reason1" onchange="updateReasons()" style="margin-bottom:5px; border:2px solid var(--primary);">
                <option value="">1ìˆœìœ„ (ê°€ì¥ í° ì´ìœ )</option>
            </select>
            <select id="reason2" onchange="updateReasons()" style="margin-bottom:5px;">
                <option value="">2ìˆœìœ„ (ì„ íƒ)</option>
            </select>
            <select id="reason3" style="margin-bottom:5px;">
                <option value="">3ìˆœìœ„ (ì„ íƒ)</option>
            </select>
            <input type="text" id="reasonEtc" placeholder="ê¸°íƒ€ ì‚¬ìœ  ì…ë ¥" class="hidden" style="margin-top:5px;">

            <label>ì¤‘ë‹¨ ë‹¹ì‹œ ë¶€ëª¨ë‹˜(ë³´í˜¸ì) ì˜ê²¬</label>
            <div class="btn-group">
                <label><input type="radio" name="parentAgree" value="ë™ì˜">ë™ì˜í•¨</label>
                <label><input type="radio" name="parentAgree" value="ë°˜ëŒ€">ë°˜ëŒ€í•¨</label>
                <label><input type="radio" name="parentAgree" value="ë¬´ê´€ì‹¬">ë¬´ê´€ì‹¬</label>
                <label><input type="radio" name="parentAgree" value="ì˜ëª¨ë¦„">ì˜ ëª¨ë¦„</label>
                <label><input type="radio" name="parentAgree" value="ê¸°íƒ€">ê¸°íƒ€</label>
            </div>
        </div>
    </div>

    <div id="step-3" class="step-content hidden">
        <div class="card">
            <h2>3. ê¿ˆë“œë¦¼ ë°©ë¬¸ ê²½ë¡œ</h2>
            <div class="btn-group" style="flex-direction:column;">
                <label><input type="radio" name="visitPath" value="ì¹œêµ¬">ì¹œêµ¬/ì„ ë°° ì†Œê°œ</label>
                <label><input type="radio" name="visitPath" value="ê°€ì¡±">ê°€ì¡±ì˜ ê¶Œìœ </label>
                <label><input type="radio" name="visitPath" value="í•™êµ">í•™êµ ì„ ìƒë‹˜ ì•ˆë‚´</label>
                <label><input type="radio" name="visitPath" value="ì¸í„°ë„·">ì¸í„°ë„· ê²€ìƒ‰ (SNS ë“±)</label>
                <label><input type="radio" name="visitPath" value="ìœ ê´€ê¸°ê´€">ê²½ì°°ì„œ/êµìœ¡ì²­ ë“± ì—°ê³„</label>
                <label><input type="radio" name="visitPath" value="í™ë³´ë¬¼">ê±°ë¦¬ í™ë³´/í˜„ìˆ˜ë§‰</label>
                <label><input type="radio" name="visitPath" value="ê¸°íƒ€">ê¸°íƒ€</label>
            </div>
        </div>
    </div>

    <div id="step-4" class="step-content hidden">
        <div class="card">
            <h2>4. ê°€ì¡± ë° ê²½ì œ ìƒí™©</h2>
            
            <label>ê°€ì¡± êµ¬ì„±ì› <span class="sub-text">(ìµœëŒ€ 5ëª… / ì„ íƒì‚¬í•­)</span></label>
            <div style="font-size:0.8rem; display:grid; grid-template-columns:0.8fr 1fr 0.6fr 1fr 0.6fr; gap:5px; text-align:center; margin-bottom:5px; font-weight:bold;">
                <span>ê´€ê³„</span><span>ì´ë¦„</span><span>ë‚˜ì´</span><span>ì—°ë½ì²˜</span><span>ë™ê±°</span>
            </div>
            <div id="family-inputs"></div>

            <label>í˜„ì¬ ê°€ì • í˜•íƒœ</label>
            <div class="btn-group">
                <label><input type="radio" name="famType" value="ì¹œë¶€ëª¨">ì¹œë¶€ëª¨</label>
                <label><input type="radio" name="famType" value="í•œë¶€ëª¨(ë¶€)">í•œë¶€ëª¨(ë¶€)</label>
                <label><input type="radio" name="famType" value="í•œë¶€ëª¨(ëª¨)">í•œë¶€ëª¨(ëª¨)</label>
                <label><input type="radio" name="famType" value="ì¡°ì†">ì¡°ì†</label>
                <label><input type="radio" name="famType" value="ì¬í˜¼">ì¬í˜¼</label>
                <label><input type="radio" name="famType" value="ì‹œì„¤">ì‹œì„¤/ì‰¼í„°</label>
                <label><input type="radio" name="famType" value="ì¹œì¸ì²™">ì¹œì¸ì²™</label>
                <label><input type="radio" name="famType" value="ê¸°íƒ€">ê¸°íƒ€</label>
            </div>

            <label>ê°€ì • ê²½ì œ ìƒíƒœ</label>
            <div class="btn-group">
                <label><input type="radio" name="econ" value="ìƒ">ì—¬ìœ  ìˆìŒ</label>
                <label><input type="radio" name="econ" value="ì¤‘">ë³´í†µ</label>
                <label><input type="radio" name="econ" value="í•˜">ì–´ë ¤ì›€</label>
                <label><input type="radio" name="econ" value="ê¸°ì´ˆìˆ˜ê¸‰">ê¸°ì´ˆìˆ˜ê¸‰</label>
                <label><input type="radio" name="econ" value="ì°¨ìƒìœ„">ì°¨ìƒìœ„</label>
            </div>

            <label>ìš©ëˆ ë§Œì¡±ë„</label>
            <div class="btn-group">
                <label><input type="radio" name="money" value="ì¶©ë¶„">ì¶©ë¶„í•¨</label>
                <label><input type="radio" name="money" value="ë³´í†µ">ë³´í†µ</label>
                <label><input type="radio" name="money" value="ë¶€ì¡±">ë¶€ì¡±í•¨</label>
                <label><input type="radio" name="money" value="ì—†ìŒ">ì•ˆ ë°›ìŒ</label>
            </div>

            <label>ê°€ì • ë‚´ ê´€ì‹¬ ì •ë„</label>
            <div class="btn-group">
                <label><input type="radio" name="interest" value="ë§¤ìš°ë§ìŒ">ë§¤ìš° ë§ìŒ</label>
                <label><input type="radio" name="interest" value="ë³´í†µ">ë³´í†µ</label>
                <label><input type="radio" name="interest" value="ê±°ì˜ì—†ìŒ">ê±°ì˜ ì—†ìŒ</label>
            </div>

            <label>ê³ ë¯¼ ì˜ë…¼ ëŒ€ìƒ</label>
            <div class="btn-group">
                <label><input type="radio" name="talk" value="ë¶€ëª¨">ë¶€ëª¨ë‹˜</label>
                <label><input type="radio" name="talk" value="í˜•ì œ">í˜•ì œ/ìë§¤</label>
                <label><input type="radio" name="talk" value="ì¹œêµ¬">ì¹œêµ¬</label>
                <label><input type="radio" name="talk" value="ì—†ìŒ">ì—†ìŒ</label>
            </div>
        </div>
    </div>

    <div id="step-5" class="step-content hidden">
        <div class="card">
            <h2>5. ì–´ë ¤ì›€ ë° ìš•êµ¬</h2>
            
            <label>í˜„ì¬ ê²ªê³  ìˆëŠ” ì–´ë ¤ì›€ (ì¤‘ë³µ ì„ íƒ)</label>
            
            <h3>ğŸ˜Ÿ ê°œì¸/ì •ì„œ</h3>
            <div class="btn-group">
                <label><input type="checkbox" name="diff" value="ì„±ê²©">ì„±ê²©/ì •ì„œ</label>
                <label><input type="checkbox" name="diff" value="ê±´ê°•">ê±´ê°•</label>
                <label><input type="checkbox" name="diff" value="ìƒí™œìŠµê´€">ë¶ˆê·œì¹™ ìƒí™œ</label>
            </div>

            <h3>ğŸ  ê°€ì •/í™˜ê²½</h3>
            <div class="btn-group">
                <label><input type="checkbox" name="diff" value="ê°€ì¡±ê°ˆë“±">ê°€ì¡±ê°ˆë“±</label>
                <label><input type="checkbox" name="diff" value="ê²½ì œ">ê²½ì œì  ì–´ë ¤ì›€</label>
                <label><input type="checkbox" name="diff" value="ë°©ì„">ë¶€ëª¨ ë¬´ê´€ì‹¬</label>
            </div>

            <h3>ğŸ« í•™êµ/ì‚¬íšŒ</h3>
            <div class="btn-group">
                <label><input type="checkbox" name="diff" value="í•™ì—…">í•™ì—…ë¶€ì§„</label>
                <label><input type="checkbox" name="diff" value="ì§„ë¡œ">ì§„ë¡œë¯¸ê²°ì •</label>
                <label><input type="checkbox" name="diff" value="ì¹œêµ¬">ëŒ€ì¸ê´€ê³„</label>
                <label><input type="checkbox" name="diff" value="ë”°ëŒë¦¼">ë”°ëŒë¦¼</label>
            </div>

            <h3>ğŸ® í–‰ë™/ê¸°íƒ€</h3>
            <div class="btn-group">
                <label><input type="checkbox" name="diff" value="ìŠ¤ë§ˆíŠ¸í°">ìŠ¤ë§ˆíŠ¸í°</label>
                <label><input type="checkbox" name="diff" value="ë¹„í–‰">ë¹„í–‰/ì¼íƒˆ</label>
                <label><input type="checkbox" name="diff" value="ì„±">ì„± ê´€ë ¨</label>
            </div>

            <label>í•™êµ ì¤‘ë‹¨ í›„ ëª©í‘œ</label>
            <div class="btn-group">
                <label><input type="radio" name="goal" value="ê²€ì •ê³ ì‹œ">ê²€ì •ê³ ì‹œ</label>
                <label><input type="radio" name="goal" value="ë³µí•™">ë³µí•™</label>
                <label><input type="radio" name="goal" value="ì§„í•™">ìƒê¸‰í•™êµ ì§„í•™</label>
                <label><input type="radio" name="goal" value="ì·¨ì—…">ì·¨ì—…/ì•Œë°”</label>
                <label><input type="radio" name="goal" value="ìê²©ì¦">ìê²©ì¦</label>
                <label><input type="radio" name="goal" value="ë¯¸ì •">ì•„ì§ ëª¨ë¦„</label>
            </div>

            <label>í¬ë§ ì„œë¹„ìŠ¤ (ì¤‘ë³µ ì„ íƒ)</label>
            <div class="btn-group">
                <label><input type="checkbox" name="service" value="ìƒë‹´">ì‹¬ë¦¬ìƒë‹´</label>
                <label><input type="checkbox" name="service" value="êµìœ¡">í•™ì—…ì§€ì›(ê²€ì •ê³ ì‹œ)</label>
                <label><input type="checkbox" name="service" value="ìë¦½">ìë¦½ì§€ì›(ìê²©ì¦)</label>
                <label><input type="checkbox" name="service" value="ë¬¸í™”">ë¬¸í™”ì²´í—˜</label>
                <label><input type="checkbox" name="service" value="ê±´ê°•">ê±´ê°•ê²€ì§„</label>
                <label><input type="checkbox" name="service" value="ìƒí™œ">ê¸‰ì‹/êµí†µë¹„</label>
            </div>
        </div>
    </div>

    <div id="step-6" class="step-content hidden">
        <div class="card">
            <h2>6. ê³¼ê±° ìƒí™œ ë° ê±´ê°•</h2>
            <label>ê³¼ê±° í•™êµìƒí™œ ë§Œì¡±ë„</label>
            <div class="btn-group">
                <label><input type="radio" name="pastSchool" value="ë§Œì¡±">ë§Œì¡±í–ˆë‹¤</label>
                <label><input type="radio" name="pastSchool" value="ë³´í†µ">ë³´í†µì´ë‹¤</label>
                <label><input type="radio" name="pastSchool" value="ë¶ˆë§Œì¡±">ë¶ˆë§Œì¡±í–ˆë‹¤</label>
            </div>

            <label>í˜„ì¬ ê±´ê°• ìƒíƒœ</label>
            <div class="btn-group">
                <label><input type="radio" name="health" value="ì¢‹ìŒ">ê±´ê°•í•˜ë‹¤</label>
                <label><input type="radio" name="health" value="ë³´í†µ">ë³´í†µì´ë‹¤</label>
                <label><input type="radio" name="health" value="ë‚˜ì¨">ë‚˜ì˜ë‹¤/ì¹˜ë£Œì¤‘</label>
            </div>
        </div>
    </div>

    <div id="step-7" class="step-content hidden">
        <div class="card">
            <h2>7. ìë¦½ì—­ëŸ‰ ì²™ë„</h2>
            <p style="text-align:center; color:#666;">ê±°ì˜ ë‹¤ ì™”ìŠµë‹ˆë‹¤! í¸ì•ˆí•˜ê²Œ ì²´í¬í•´ ì£¼ì„¸ìš”.</p>
            <div id="jarip-area"></div>
        </div>
    </div>

    <div id="step-8" class="step-content hidden">
        <div class="card">
            <h2>8. ì‹¬ë¦¬ì •ì„œ ì²™ë„</h2>
            <div id="simni-area"></div>
        </div>
    </div>

    <div id="page-end" class="container hidden text-center" style="text-align:center; padding-top:50px;">
        <h1 style="font-size:3rem;">ğŸ‰</h1>
        <h2>ì‘ì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</h2>
        <p>ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤. íƒœë¸”ë¦¿ì„ ìƒë‹´ ì„ ìƒë‹˜ê»˜ ë“œë ¤ì£¼ì„¸ìš”.</p>
        <button class="btn btn-save" onclick="location.reload()" style="margin-top:20px;">ì²˜ìŒìœ¼ë¡œ</button>
    </div>

</div>

<div class="bottom-bar hidden no-print" id="bottom-bar">
    <button class="btn btn-prev" onclick="move(-1)">ì´ì „</button>
    <button class="btn btn-save" onclick="saveDraft()">ì„ì‹œì €ì¥</button>
    <button class="btn btn-next" onclick="move(1)" id="btn-next">ë‹¤ìŒ</button>
</div>

<div id="admin-view" class="container hidden no-print">
    <div class="card">
        <h2>ğŸ”’ ê´€ë¦¬ì ì ‘ì†</h2>
        <input type="password" id="adminPw" placeholder="ë¹„ë°€ë²ˆí˜¸ 1388">
        <button class="btn btn-next" style="margin-top:10px;" onclick="loginAdmin()">í™•ì¸</button>
        <button class="btn btn-prev" style="margin-top:10px;" onclick="location.reload()">ë‚˜ê°€ê¸°</button>
    </div>
</div>

<div id="admin-list" class="container hidden no-print">
    <div class="card">
        <h2>ğŸ“‹ ì°¸ì—¬ì ëª©ë¡</h2>
        <ul id="list-area" style="list-style:none; padding:0;"></ul>
        <button class="btn btn-prev" onclick="location.reload()">ë‚˜ê°€ê¸°</button>
    </div>
</div>

<div id="report-area" class="hidden">
    <div style="text-align:center; border:2px solid #333; padding:10px; margin-bottom:15px;">
        <h1 style="margin:0; font-size:18pt; color:#000;">í•™êµ ë°– ì²­ì†Œë…„ ì´ˆê¸°ìƒë‹´ ê¸°ë¡ì§€</h1>
    </div>
    
    <h3>â… . ê¸°ë³¸ ì •ë³´</h3>
    <table>
        <tr><th width="15%">ì„±ëª…</th><td id="r-name"></td><th width="15%">ìƒë…„ì›”ì¼</th><td id="r-birth"></td></tr>
        <tr><th>ì—°ë½ì²˜</th><td id="r-tel"></td><th>ë³´í˜¸ì</th><td id="r-parent-tel"></td></tr>
        <tr><th>í˜„ì¬ìƒíƒœ</th><td colspan="3" id="r-status"></td></tr>
    </table>

    <h3>â…¡. í•™ì—… ë° ë°°ê²½</h3>
    <table>
        <tr><th>ì¤‘ë‹¨ì‹œê¸°</th><td id="r-drop-when"></td><th>ì¤‘ë‹¨ì´ìœ </th><td id="r-drop-reason"></td></tr>
        <tr><th>ë¶€ëª¨ì˜ê²¬</th><td id="r-agree"></td><th>ë‚´ë°©ê²½ë¡œ</th><td id="r-path"></td></tr>
    </table>

    <h3>â…¢. ê°€ì¡± ë° ê²½ì œ</h3>
    <table>
        <tr><th>ê°€ì¡±êµ¬ì„±</th><td colspan="3" id="r-family"></td></tr>
        <tr><th>ê°€ì •í˜•íƒœ</th><td id="r-fam-type"></td><th>ê²½ì œìˆ˜ì¤€</th><td id="r-econ"></td></tr>
        <tr><th>ê´€ì‹¬ë„</th><td id="r-interest"></td><th>ê³ ë¯¼ì˜ë…¼</th><td id="r-talk"></td></tr>
    </table>

    <h3>â…£. ìƒíƒœ ë° ìš•êµ¬</h3>
    <table>
        <tr><th>ì–´ë ¤ì›€</th><td colspan="3" id="r-diff"></td></tr>
        <tr><th>ëª©í‘œ</th><td id="r-goal"></td><th>í¬ë§ì„œë¹„ìŠ¤</th><td id="r-service"></td></tr>
        <tr><th>ê±´ê°•</th><td id="r-health"></td><th>ê³¼ê±°í•™êµ</th><td id="r-school"></td></tr>
    </table>

    <h3>â…¤. ì²™ë„ ê²°ê³¼</h3>
    <table>
        <thead><tr><th>ì˜ì—­</th><th>ì ìˆ˜</th><th>íŒì •</th></tr></thead>
        <tbody id="r-scale-body"></tbody>
    </table>
    
    <div style="border:2px solid red; padding:10px; margin-top:10px;">
        <strong style="color:red;">ğŸš¨ ìœ„ê¸°(Red Flag) ë° í™•ì¸ì‚¬í•­</strong>
        <div id="r-redflag"></div>
    </div>
</div>

<script>
    // =======================================================
    // 1. DATA FILE (ì²™ë„ ë¬¸í•­ ë°ì´í„° - ì—¬ê¸°ì„œ ìˆ˜ì • ê°€ëŠ¥)
    // =======================================================
    const SCALE_DATA = {
        YOUTH: {
            jarip: [
                {n:1, t:"ë‚˜ëŠ” ê°€ì¹˜ìˆëŠ” ì‚¬ëŒì´ë‹¤", d:"ìì¡´ê°"},
                {n:2, t:"ë‚˜ëŠ” ë‚´ê°€ ë¬´ì—‡ì„ ì•Œê³  ëª¨ë¥´ëŠ”ì§€ ì •í™•íˆ ì•ˆë‹¤", d:"í•™ì—…íš¨ëŠ¥ê°"},
                {n:3, t:"í•„ìš”í•  ë•Œ ë‚¨ì—ê²Œ ë„ì›€ì„ ìš”ì²­í•  ìˆ˜ ìˆë‹¤", d:"ì‚¬íšŒì ìœ ëŠ¥ê°"},
                {n:7, t:"ë§¡ê²¨ì§„ ì¼ì€ ëê¹Œì§€ í•˜ë ¤ê³  ë…¸ë ¥í•œë‹¤", d:"ì„±ì‹¤ì„±"},
                // ... (í•„ìš”ì‹œ ë¬¸í•­ ì¶”ê°€) ...
            ],
            simni: [
                {n:1, t:"ì§€ë‚œ 1ë‹¬ê°„ ìŠ¬í”„ê±°ë‚˜ ìš°ìš¸í•  ë•Œê°€ ìì£¼ ìˆë‹¤", d:"ìš°ìš¸"},
                {n:48, t:"ì§€ë‚œ 3ê°œì›”ê°„ ìì‚´ì„ ìƒê°í•´ ë³¸ ì  ìˆë‹¤", d:"ìì‚´", crit:true},
                {n:15, t:"ë‚´ê²ŒëŠ” ì†ë§ˆìŒì„ í„°ë†“ì„ ì¹œêµ¬ê°€ ìˆë‹¤", d:"ë˜ë˜í™˜ê²½", rev:true},
                // ... (í•„ìš”ì‹œ ë¬¸í•­ ì¶”ê°€) ...
            ]
        },
        CHILD: {
            jarip: [{n:1, t:"ë‚˜ëŠ” ì¢‹ì€ ì ì´ ë§ì€ ì‚¬ëŒì´ë‹¤", d:"ìì¡´ê°"}],
            simni: [{n:1, t:"ìë„ ìë„ í”¼ê³¤í•˜ë‹¤", d:"ìš°ìš¸"}]
        }
    };

    const REASONS = [
        "ê³µë¶€í•˜ê¸° ì‹«ì–´ì„œ", "ì›í•˜ëŠ” ê³µë¶€(ê²€ì •ê³ ì‹œ ë“±)ë¥¼ í•˜ê¸° ìœ„í•´", "í•™êµ ì¹œêµ¬ì™€ì˜ ë¬¸ì œ",
        "ì„ ìƒë‹˜ê³¼ì˜ ê°ˆë“±", "í•™êµ ê·œì¹™ ë¶€ì ì‘", "í•™êµí­ë ¥ í”¼í•´", "íŠ¹ê¸°/ì†Œì§ˆì„ ì‚´ë¦¬ê¸° ìœ„í•´",
        "ê²½ì œì  ì‚¬ì •", "ì§ˆë³‘/ì‚¬ê³ ", "ê°€ì¶œ", "ë¹„í–‰/ë²•ì ë¬¸ì œ", "ì‹¬ë¦¬/ì •ì„œì  ë¬¸ì œ", "í•´ì™¸ìœ í•™", "ê¸°íƒ€"
    ];

    // =======================================================
    // 2. FIREBASE CONFIG (ë³¸ì¸ í‚¤ë¡œ êµì²´ í•„ìˆ˜)
    // =======================================================
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY_HERE",
        authDomain: "kdream-db462.firebaseapp.com",
        projectId: "kdream-db462",
        storageBucket: "kdream-db462.firebasestorage.app",
        messagingSenderId: "1020262030810",
        appId: "1:1020262030810:web:3482636bc020bb4310b4e3"
    };

    let db;
    try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
    } catch(e) { console.log("Firebase ë¡œì»¬ ëª¨ë“œ"); }

    // =======================================================
    // 3. APP LOGIC
    // =======================================================
    let currentStep = 0;
    const totalSteps = 8;
    let userData = {};
    let answers = {};

    window.onload = function() {
        // ê°€ì¡± ì…ë ¥í¼ ìƒì„±
        const famBox = document.getElementById('family-inputs');
        for(let i=1; i<=5; i++){
            famBox.innerHTML += `
                <div class="family-row">
                    <input type="text" id="fr${i}" placeholder="ê´€ê³„">
                    <input type="text" id="fn${i}" placeholder="ì´ë¦„">
                    <input type="number" id="fa${i}" placeholder="ë‚˜ì´">
                    <input type="tel" id="ft${i}" placeholder="ì—°ë½ì²˜">
                    <select id="fl${i}"><option value="Y">O</option><option value="N">X</option></select>
                </div>
            `;
        }
        
        // ì¤‘ë‹¨ì‚¬ìœ  ì˜µì…˜ ìƒì„±
        ['reason1','reason2','reason3'].forEach(id => {
            const el = document.getElementById(id);
            REASONS.forEach(r => {
                let opt = document.createElement('option');
                opt.value = r; opt.text = r;
                el.appendChild(opt);
            });
        });

        // ì„ì‹œì €ì¥ ë¶ˆëŸ¬ì˜¤ê¸°
        if(localStorage.getItem('kdream_draft')) {
            if(confirm('ì‘ì„± ì¤‘ì¸ ë‚´ìš©ì´ ìˆìŠµë‹ˆë‹¤. ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // (ê°„ë‹¨íˆ)
                alert('ë¶ˆëŸ¬ì˜¤ê¸°ëŠ” ì‹¤ì œ êµ¬í˜„ ì‹œ ê°’ì„ ë§¤í•‘í•´ì•¼ í•©ë‹ˆë‹¤.');
            }
        }
    };

    // ì¤‘ë‹¨ì‚¬ìœ  ë¡œì§ (ì¤‘ë³µ ë°©ì§€)
    function updateReasons() {
        const v1 = document.getElementById('reason1').value;
        const v2 = document.getElementById('reason2');
        const v3 = document.getElementById('reason3');
        const etc = document.getElementById('reasonEtc');

        if(v1 === 'ê¸°íƒ€') etc.classList.remove('hidden');
        else etc.classList.add('hidden');

        // (ë‹¨ìˆœ ì²˜ë¦¬) ì„ íƒëœ ê°’ì€ í•˜ìœ„ì—ì„œ ë¹„í™œì„±í™” ë¡œì§ í•„ìš”í•˜ë‚˜ ìƒëµ
    }

    // í•™ë…„ ë²„íŠ¼ ìƒì„±
    function setGrades(max) {
        const area = document.getElementById('grade-area');
        area.innerHTML = "";
        area.classList.remove('hidden');
        if(max === 0) { area.classList.add('hidden'); return; }
        
        for(let i=1; i<=max; i++) {
            area.innerHTML += `<label><input type="radio" name="dropGrade" value="${i}í•™ë…„">${i}í•™ë…„</label>`;
        }
    }

    function startSurvey() {
        document.getElementById('page-intro').classList.add('hidden');
        document.getElementById('page-survey').classList.remove('hidden');
        document.getElementById('bottom-bar').classList.remove('hidden');
        move(1);
    }

    function move(dir) {
        if(currentStep === 0 && dir === 1) currentStep = 1;
        else {
            document.getElementById(`step-${currentStep}`).classList.add('hidden');
            currentStep += dir;
        }

        if(currentStep < 1) currentStep = 1;
        if(currentStep > totalSteps) { submitFinal(); return; }

        document.getElementById(`step-${currentStep}`).classList.remove('hidden');
        
        // ë²„íŠ¼ í…ìŠ¤íŠ¸
        const nextBtn = document.getElementById('btn-next');
        if(currentStep === totalSteps) nextBtn.innerText = "ì œì¶œí•˜ê¸°";
        else nextBtn.innerText = "ë‹¤ìŒ";

        // ì§„í–‰ë°”
        document.getElementById('progressBar').style.width = (currentStep / totalSteps * 100) + "%";
        window.scrollTo(0,0);

        // ì²™ë„ ë°ì´í„° ë¡œë“œ ì‹œì 
        if(currentStep === 7) loadScale('jarip');
        if(currentStep === 8) loadScale('simni');
    }

    function collectData() {
        // ê°„ë‹¨ ìˆ˜ì§‘ (ì¼ë¶€ IDë§Œ ì˜ˆì‹œ)
        userData.name = document.getElementById('userName').value;
        userData.birth = `19${document.getElementById('rrn1').value.substr(0,2)}`; // ëŒ€ëµ
        // ì‹¤ì œë¡œëŠ” ëª¨ë“  í•„ë“œ ìˆ˜ì§‘ í•„ìš”
    }

    function loadScale(part) {
        // ë‚˜ì´ ê³„ì‚° (í•„ìˆ˜)
        const y2 = document.getElementById('rrn1').value.substr(0,2);
        const year = parseInt(y2) < 30 ? 2000 + parseInt(y2) : 1900 + parseInt(y2);
        const age = new Date().getFullYear() - year;
        const type = (age >= 13) ? "YOUTH" : "CHILD";
        
        const list = SCALE_DATA[type][part];
        const area = document.getElementById(part + '-area');
        area.innerHTML = "";
        
        list.forEach((q, i) => {
            area.innerHTML += `
                <div class="card" style="padding:15px;">
                    <div style="font-weight:bold; margin-bottom:10px;">${i+1}. ${q.t}</div>
                    <div class="btn-group">
                        <label><input type="radio" name="${part}_${q.n}" value="1" onchange="saveAns('${part}',${q.n},1,${q.rev},${q.crit},'${q.d}')">ì „í˜€ì•„ë‹˜</label>
                        <label><input type="radio" name="${part}_${q.n}" value="2" onchange="saveAns('${part}',${q.n},2,${q.rev},${q.crit},'${q.d}')">ì•„ë‹ˆë‹¤</label>
                        <label><input type="radio" name="${part}_${q.n}" value="3" onchange="saveAns('${part}',${q.n},3,${q.rev},${q.crit},'${q.d}')">ë³´í†µ</label>
                        <label><input type="radio" name="${part}_${q.n}" value="4" onchange="saveAns('${part}',${q.n},4,${q.rev},${q.crit},'${q.d}')">ê·¸ë ‡ë‹¤</label>
                        <label><input type="radio" name="${part}_${q.n}" value="5" onchange="saveAns('${part}',${q.n},5,${q.rev},${q.crit},'${q.d}')">ë§¤ìš°ê·¸ë ‡ë‹¤</label>
                    </div>
                </div>
            `;
        });
    }

    function saveAns(part, n, v, r, c, d) {
        answers[`${part}_${n}`] = {val:v, rev:r, crit:c, domain:d};
    }

    function saveDraft() {
        alert("ì„ì‹œì €ì¥ ë˜ì—ˆìŠµë‹ˆë‹¤ (ê¸°ê¸°ì— ì €ì¥).");
        localStorage.setItem('kdream_draft', JSON.stringify({step:currentStep}));
    }

    function submitFinal() {
        collectData();
        const payload = {
            info: userData,
            ans: answers,
            date: new Date().toLocaleDateString(),
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        };

        if(db) {
            db.collection("intake_complete").add(payload).then(()=>{
                document.getElementById('page-survey').classList.add('hidden');
                document.getElementById('bottom-bar').classList.add('hidden');
                document.getElementById('page-end').classList.remove('hidden');
            });
        } else {
            alert("DB ë¯¸ì—°ê²°: ë¡œì»¬ ì €ì¥ ì™„ë£Œ");
            document.getElementById('page-survey').classList.add('hidden');
            document.getElementById('page-end').classList.remove('hidden');
        }
    }

    // ê´€ë¦¬ì ê´€ë ¨
    function showAdmin() {
        document.getElementById('page-intro').classList.add('hidden');
        document.getElementById('admin-view').classList.remove('hidden');
    }
    
    function loginAdmin() {
        if(document.getElementById('adminPw').value === "1388") {
            document.getElementById('admin-view').classList.add('hidden');
            document.getElementById('admin-list').classList.remove('hidden');
            loadList();
        } else alert("ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜");
    }

    function loadList() {
        const list = document.getElementById('list-area');
        list.innerHTML = "ë¡œë”©ì¤‘...";
        if(!db) return;
        
        db.collection("intake_complete").orderBy("timestamp", "desc").limit(10).get().then(snap => {
            list.innerHTML = "";
            snap.forEach(doc => {
                const d = doc.data();
                list.innerHTML += `<li class="card" style="padding:15px; display:flex; justify-content:space-between;">
                    <b>${d.info.name || 'ë¬´ëª…'}</b> <button class="btn btn-next" style="width:auto; padding:5px 15px;" onclick='viewRpt(${JSON.stringify(d)})'>ë³´ê¸°</button>
                </li>`;
            });
        });
    }

    function viewRpt(data) {
        document.getElementById('admin-list').classList.add('hidden');
        document.getElementById('report-area').classList.remove('hidden');
        // ì—¬ê¸°ì— ë°ì´í„° ë§¤í•‘ ë¡œì§ (ì´ì „ ì½”ë“œ ì°¸ì¡°)
        document.getElementById('r-name').innerText = data.info.name || "";
        // ... ë‚˜ë¨¸ì§€ í•„ë“œ ë§¤í•‘ ...
    }

</script>
</body>
</html>

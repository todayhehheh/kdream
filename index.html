<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë…¸ì›êµ¬ ê¿ˆë“œë¦¼ ì´ˆê¸°ìƒë‹´</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script src="scales.js"></script>
    
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --primary: #00BFA5; --bg: #F5F7FA; --white: #fff; --text: #333; --border: #DDD; }
        
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; padding-bottom: 90px; -webkit-tap-highlight-color: transparent; }
        
        /* ìƒë‹¨ë°” */
        .header { position: fixed; top: 0; left: 0; width: 100%; height: 50px; background: white; z-index: 999; display: flex; align-items: center; justify-content: center; font-weight: 800; color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .progress-bar { position: fixed; top: 50px; left: 0; height: 4px; background: var(--primary); width: 0%; z-index: 1000; transition: width 0.3s; }

        .container { max-width: 720px; margin: 80px auto 0; padding: 20px; }
        
        /* í˜ì´ì§€ ì• ë‹ˆë©”ì´ì…˜ */
        .page { display: none; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .card { background: white; border-radius: 16px; padding: 25px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.02); }
        
        h2 { font-size: 1.3rem; margin: 0 0 20px 0; border-bottom: 2px solid var(--primary); padding-bottom: 8px; display: inline-block; color: #222; }
        h3 { font-size: 1.1rem; color: #444; background: #f0f0f0; padding: 10px 15px; border-radius: 8px; margin: 30px 0 15px 0; font-weight: 700; }

        .form-group { margin-bottom: 30px; }
        label { display: block; font-weight: 700; margin-bottom: 8px; font-size: 1rem; color: #333; }
        .sub-desc { font-weight: normal; font-size: 0.85rem; color: #888; margin-left: 5px; }
        
        input, select { width: 100%; padding: 13px; border: 1px solid #ddd; border-radius: 10px; font-size: 1rem; box-sizing: border-box; background: #fff; text-align: center; transition: 0.2s; }
        input.text-left { text-align: left; }
        input:focus, select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(0, 191, 165, 0.1); }
        
        /* ë²„íŠ¼ ê·¸ë£¹ */
        .btn-group { display: flex; flex-wrap: wrap; gap: 8px; }
        .btn-opt { 
            flex: 1; min-width: 100px; padding: 13px; border: 1px solid #ddd; border-radius: 10px; 
            background: #fff; text-align: center; cursor: pointer; font-weight: 600; display: flex; align-items: center; justify-content: center; transition: 0.1s;
        }
        .btn-opt:active { transform: scale(0.98); }
        .btn-opt.selected { background: #E0F2F1; border-color: var(--primary); color: #00897B; box-shadow: 0 2px 5px rgba(0,0,0,0.1); font-weight: 800; }

        /* 5ì  ì²™ë„ ì „ìš© */
        .grid-5 { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; }
        .grid-5 .btn-opt { min-width: 0; padding: 12px 2px; font-size: 0.9rem; }

        /* ì²™ë„ ê²€ì‚¬ ë¬¸í•­ */
        .scale-row { background: #f9f9f9; padding: 15px; border-radius: 12px; margin-bottom: 12px; border: 1px solid #eee; }
        .scale-q { font-weight: bold; margin-bottom: 10px; line-height: 1.4; word-break: keep-all; }
        .scale-btns { display: flex; gap: 4px; }
        .scale-btn { 
            flex: 1; padding: 10px 0; border: 1px solid #ddd; border-radius: 8px; background: white; 
            text-align: center; cursor: pointer; font-size: 0.8rem; color: #666; display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .scale-btn span.num { font-size: 1.1rem; font-weight: 800; display: block; margin-bottom: 2px; }
        .scale-btn.selected { background: var(--primary); color: white; border-color: var(--primary); }
        .scale-btn.selected span.num { color: white; }

        /* í…Œì´ë¸”í˜• ì…ë ¥ */
        .fam-row { display: grid; grid-template-columns: 0.7fr 1fr 0.5fr 1.2fr 0.6fr; gap: 5px; margin-bottom: 5px; }
        .fam-row input, .fam-row select { padding: 10px 5px; font-size: 0.9rem; }

        /* í•˜ë‹¨ë°” */
        .bottom-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: white; padding: 15px; border-top: 1px solid #eee; display: flex; gap: 10px; box-sizing: border-box; z-index: 1000; }
        .btn { flex: 1; padding: 16px; border-radius: 12px; border: none; font-size: 1.1rem; font-weight: 800; cursor: pointer; }
        .btn-prev { background: #f0f0f0; color: #555; flex: 0.4; }
        .btn-next { background: var(--primary); color: white; flex: 1; }

        .hidden { display: none !important; }
        .split { display: flex; gap: 5px; align-items: center; }
        .split input { flex: 1; min-width: 0; }

        /* ë¦¬ë·° í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        .review-section { margin-bottom: 20px; border-bottom: 1px dashed #ddd; padding-bottom: 10px; }
        .review-title { font-weight: bold; color: var(--primary); margin-bottom: 5px; }
        .review-content { font-size: 0.95rem; color: #555; line-height: 1.5; white-space: pre-wrap; }

        @media print { .no-print { display: none; } }
    </style>
</head>
<body>

<div class="header no-print">ë…¸ì›êµ¬ ê¿ˆë“œë¦¼ <span style="position:absolute; right:20px; font-size:0.8rem; color:#ccc; cursor:pointer;" onclick="showAdmin()">ğŸ”’</span></div>
<div class="progress-bar no-print" id="progressBar"></div>

<div id="intro-page" class="container page active text-center" style="margin-top:120px;">
    <div class="card">
        <h1 style="color:var(--primary); margin-bottom:15px;">í¬ë§ ì„œë¹„ìŠ¤ ì¡°ì‚¬í‘œ</h1>
        <p style="color:#666; line-height:1.6; margin-bottom:40px;">
            ì•ˆë…•í•˜ì„¸ìš”.<br>ê¿ˆë“œë¦¼ ì„¼í„°ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.<br>
            ì—¬ëŸ¬ë¶„ì„ ë•ê¸° ìœ„í•œ ì†Œì¤‘í•œ ìë£Œì…ë‹ˆë‹¤.<br>
            <strong>ì†”ì§í•˜ê²Œ</strong> ì‘ì„±í•´ ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤.
        </p>
        <button class="btn btn-next" style="width:100%;" onclick="startSurvey()">ì‘ì„± ì‹œì‘í•˜ê¸°</button>
        <p style="margin-top:20px; color:#ccc; font-size:0.9rem; cursor:pointer;" onclick="showAdmin()">ê´€ë¦¬ì ì ‘ì†</p>
    </div>
</div>

<div id="survey-wrap" class="container hidden">

    <div id="page-1" class="page">
        <div class="card">
            <h2>1. ê¸°ë³¸ ì¸ì ì‚¬í•­</h2>
            <div class="form-group"><label>ì„±ëª…</label><input type="text" id="userName"></div>
            <div class="form-group"><label>ì„±ë³„</label>
                <div class="btn-group">
                    <div class="btn-opt" onclick="sel(this,'gender','ë‚¨')">ë‚¨ì</div>
                    <div class="btn-opt" onclick="sel(this,'gender','ì—¬')">ì—¬ì</div>
                </div>
            </div>
            <div class="form-group"><label>ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ <span class="sub-desc">(ìƒë…„ì›”ì¼ ìë™ê³„ì‚°)</span></label>
                <div class="split">
                    <input type="tel" id="rrn1" maxlength="6" placeholder="ì• 6ìë¦¬" oninput="autoBirth(this)"> - <input type="password" id="rrn2" maxlength="7" placeholder="ë’¤ 7ìë¦¬">
                </div>
                <div id="birthDisplay" style="margin-top:5px; color:var(--primary); font-weight:bold; font-size:0.9rem;"></div>
            </div>
            <div class="form-group"><label>ì£¼ì†Œ</label>
                <div class="split" style="margin-bottom:5px;">
                    <input type="text" id="postcode" placeholder="ìš°í¸ë²ˆí˜¸" readonly style="flex:0.4;">
                    <button class="btn-opt" style="flex:0.3; padding:10px; min-width:auto;" onclick="execPostcode()">ê²€ìƒ‰</button>
                </div>
                <input type="text" id="address" placeholder="ê¸°ë³¸ ì£¼ì†Œ" readonly style="margin-bottom:5px;">
                <input type="text" id="detailAddr" placeholder="ìƒì„¸ ì£¼ì†Œ ì…ë ¥">
            </div>
            <div class="form-group"><label>ì—°ë½ì²˜ (ë³¸ì¸)</label>
                <div class="split"><input type="tel" id="t1" maxlength="3"><input type="tel" id="t2" maxlength="4"><input type="tel" id="t3" maxlength="4"></div>
            </div>
            <div class="form-group"><label>ì—°ë½ì²˜ (ë³´í˜¸ì)</label>
                <div class="split"><input type="tel" id="p1" maxlength="3"><input type="tel" id="p2" maxlength="4"><input type="tel" id="p3" maxlength="4"></div>
            </div>
            <div class="form-group"><label>ì²­ì†Œë…„ ìƒíƒœ</label>
                <div class="btn-group" style="flex-direction:column;">
                    <div class="btn-opt" onclick="sel(this,'status','í•™êµ ë°– ì²­ì†Œë…„')">í•™êµ ë°– ì²­ì†Œë…„</div>
                    <div class="btn-opt" onclick="sel(this,'status','ê³ ì¡¸ê²€ì •ê³ ì‹œí•©ê²©')">ê³ ì¡¸ ê²€ì •ê³ ì‹œ í•©ê²© ì²­ì†Œë…„</div>
                    <div class="btn-opt" onclick="sel(this,'status','í•™ì—…ì¤‘ë‹¨ìˆ™ë ¤ì œ')">í•™ì—…ì¤‘ë‹¨ ìˆ™ë ¤ì œ(ì¬í•™ìƒ)</div>
                </div>
            </div>
        </div>
    </div>

    <div id="page-2" class="page">
        <div class="card">
            <h2>2. í•™ì—… ì¤‘ë‹¨ ë° ë°°ê²½</h2>
            
            <div class="form-group">
                <label>1. ì–¸ì œê¹Œì§€ í•™êµì— ë‹¤ë…”ìŠµë‹ˆê¹Œ?</label>
                <div class="btn-group">
                    <div class="btn-opt" onclick="selSchool(this, 'ì´ˆ', 6)">ì´ˆë“±í•™êµ</div>
                    <div class="btn-opt" onclick="selSchool(this, 'ì¤‘', 3)">ì¤‘í•™êµ</div>
                    <div class="btn-opt" onclick="selSchool(this, 'ê³ ', 3)">ê³ ë“±í•™êµ</div>
                    <div class="btn-opt" onclick="selSchool(this, 'ë¯¸ì§„í•™', 0)">ë¯¸ì§„í•™</div>
                </div>
            </div>

            <div id="grade-box" class="form-group hidden" style="background:#f9f9f9; padding:15px; border-radius:10px;">
                <label>í•™ë…„ì„ ì„ íƒí•´ ì£¼ì„¸ìš”</label>
                <div id="grade-opts" class="btn-group"></div>
            </div>

            <div id="semester-box" class="form-group hidden" style="background:#f9f9f9; padding:15px; border-radius:10px; margin-top:-15px;">
                <label>í•™ê¸°ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”</label>
                <div class="btn-group">
                    <div class="btn-opt" onclick="sel(this,'sem','1í•™ê¸°')">1í•™ê¸°</div>
                    <div class="btn-opt" onclick="sel(this,'sem','2í•™ê¸°')">2í•™ê¸°</div>
                </div>
            </div>

            <div class="form-group" style="margin-top:25px;">
                <label>2. ì–¸ì œ í•™êµë¥¼ ê·¸ë§Œë‘ì—ˆìŠµë‹ˆê¹Œ?</label>
                <div class="split">
                    <input type="number" id="dY" placeholder="ë…„(4ìë¦¬)" oninput="sliceLen(this, 4)"><span>ë…„</span>
                    <input type="number" id="dM" placeholder="ì›”(2ìë¦¬)" oninput="sliceLen(this, 2)"><span>ì›”</span>
                    <input type="number" id="dD" placeholder="ì¼(2ìë¦¬)" oninput="sliceLen(this, 2)"><span>ì¼</span>
                </div>
            </div>

            <div class="form-group">
                <label>3. í•™êµë¥¼ ê·¸ë§Œë‘ê²Œ ëœ ì´ìœ ëŠ” ë¬´ì—‡ì…ë‹ˆê¹Œ? (1ìˆœìœ„)</label>
                <select id="reason1" onchange="updR()"><option value="">ì„ íƒ (í•„ìˆ˜)</option></select>
            </div>
            <div class="form-group">
                <label>3. í•™êµë¥¼ ê·¸ë§Œë‘ê²Œ ëœ ì´ìœ ëŠ” ë¬´ì—‡ì…ë‹ˆê¹Œ? (2ìˆœìœ„)</label>
                <select id="reason2" onchange="updR()"><option value="">ì„ íƒ</option></select>
            </div>
            <div class="form-group">
                <label>3. í•™êµë¥¼ ê·¸ë§Œë‘ê²Œ ëœ ì´ìœ ëŠ” ë¬´ì—‡ì…ë‹ˆê¹Œ? (3ìˆœìœ„)</label>
                <select id="reason3"><option value="">ì„ íƒ</option></select>
            </div>
            <input type="text" id="reasonEtc" class="hidden text-left" placeholder="ê¸°íƒ€ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="width:100%; margin-top:5px;">

            <div class="form-group" style="margin-top:25px;">
                <label>4. ê·¸ë§Œë‘ëŠ” ê²ƒì— ëŒ€í•œ ë¶€ëª¨ë‹˜ ì˜ê²¬ì€?</label>
                <div id="agree-opts" class="btn-group"></div>
                <input type="text" id="agreeEtc" class="hidden text-left" placeholder="ê¸°íƒ€ ì˜ê²¬" style="width:100%; margin-top:5px;">
            </div>
        </div>
    </div>

    <div id="page-3" class="page">
        <div class="card">
            <h2>3. ë°©ë¬¸ ê²½ë¡œ</h2>
            <div class="form-group"><label>5. ê¿ˆë“œë¦¼ ì„¼í„°ë¥¼ ë°©ë¬¸í•˜ê²Œ ëœ ê²½ë¡œëŠ”?</label>
                <div id="path-opts" class="btn-group" style="flex-direction:column;"></div>
                <input type="text" id="pathEtc" class="hidden text-left" placeholder="ê¸°íƒ€ ê²½ë¡œ" style="width:100%; margin-top:5px;">
            </div>
            <div id="org-wrap" class="hidden" style="margin-top:20px; border-top:1px dashed #ddd; padding-top:20px;">
                <label>ì–´ë–¤ ê¸°ê´€ì¸ê°€ìš”?</label>
                <div id="org-opts" class="btn-group"></div>
            </div>
        </div>
    </div>

<div id="page-4" class="page">
        <div class="card">
            <h2>4. ê°€ì¡± ë° ê²½ì œ ìƒí™©</h2>
            <div class="form-group">
                <label>1. ê°€ì¡± êµ¬ì„±ì› <span class="sub-desc">(ë™ê±° ì—¬ë¶€ O/X)</span></label>
                <div class="fam-row" style="font-weight:bold; color:#666; text-align:center;"><span>ê´€ê³„</span><span>ì„±ëª…</span><span>ë‚˜ì´</span><span>ì—°ë½ì²˜</span><span>ë™ê±°</span></div>
                <div id="fam-rows"></div>
                <button type="button" class="btn-opt" style="width:100%; margin-top:5px; background:#f0f0f0;" onclick="addFamRow()">+ ê°€ì¡± ì¶”ê°€ (ìµœëŒ€ 5ëª…)</button>
            </div>
            
            <div class="form-group"><label>1-1. í˜„ì¬ ê°€ì •ìƒíƒœ (ì¤‘ë³µê°€ëŠ¥)</label><div id="fam-bg-opts" class="btn-group"></div></div>
            <div class="form-group"><label>1-2. í˜„ì¬ ê°€ì¡±í˜•íƒœ</label><div id="fam-type-opts" class="btn-group"></div><input type="text" id="famEtc" class="hidden text-left" placeholder="ê¸°íƒ€"></div>
            <div class="form-group"><label>1-3. ê²½ì œìƒíƒœ</label><div id="econ-opts" class="btn-group"></div></div>
            
            <hr style="margin:30px 0; border:0; border-top:1px dashed #ddd;">

            <div class="form-group">
                <label>2. ê°€ì •(ë¶€ëª¨ë‹˜ ë˜ëŠ” ë³´í˜¸ì)ì—ì„œ ë¬¼ì§ˆì  ì§€ì›(ìš©ëˆ, í•™ì›ë¹„, ì±…ê°’, í†µì‹ ë¹„, ì˜· ë“±)ì„ ì–´ëŠ ì •ë„ë‚˜ ë°›ê³  ìˆë‹¤ê³  ìƒê°í•©ë‹ˆê¹Œ?</label>
                <div class="grid-5" id="support-opts">
                    </div>
                <input type="text" id="supEtc" class="hidden text-left" placeholder="ê¸°íƒ€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" style="width:100%; margin-top:5px;">
            </div>

            <div id="lack-box" class="hidden" style="margin-bottom:25px; background:#f9f9f9; padding:15px; border-radius:10px;">
                <label style="font-size:0.95rem; margin-bottom:10px; line-height:1.4;">2-1. ê°€ì •ì—ì„œ ë°›ëŠ” ë¬¼ì§ˆì  ì§€ì›ì´ ì¶©ë¶„í•˜ì§€ ì•Šì€ ê²½ìš°, ë‚˜ë¨¸ì§€ë¥¼ ì–´ë–»ê²Œ ì¶©ë‹¹í•©ë‹ˆê¹Œ?</label>
                <div id="lack-opts" class="btn-group" style="flex-direction:column;">
                    </div>
                <input type="text" id="lackEtc" class="hidden text-left" placeholder="ê¸°íƒ€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”" style="width:100%; margin-top:5px;">
            </div>

            <div class="form-group">
                <label>2-2. í•œ ë‹¬ ìƒí™œë¹„ìš©(ìš©ëˆ)ì€ ì–¼ë§ˆë‚˜ ì“°ê³  ìˆìŠµë‹ˆê¹Œ?</label>
                <div class="grid-5" id="money-opts">
                    </div>
            </div>
        </div>
    </div>>

    <div id="page-5" class="page">
        <div class="card">
            <h2>5. ê´€ê³„ ë° ì–´ë ¤ì›€</h2>
            <div class="form-group"><label>3. ê°€ì • ë‚´ ì¡´ì¤‘ ì •ë„</label>
                <div class="grid-5" id="respect-opts"></div>
                <input type="text" id="resEtc" class="hidden text-left" placeholder="ê¸°íƒ€" style="width:100%; margin-top:5px;">
            </div>
            <div class="form-group"><label>4. ê³ ë¯¼ ìƒë‹´ ëŒ€ìƒ</label>
                <div id="talk-opts" class="btn-group"></div>
                <input type="text" id="talkEtc" class="hidden text-left" placeholder="ê¸°íƒ€" style="width:100%; margin-top:5px;">
            </div>
            
            <hr style="margin:30px 0; border:0; border-top:1px dashed #ddd;">
            
            <div class="form-group">
                <label>1. í˜„ì¬ ê²ªê³  ìˆëŠ” ì–´ë ¤ì›€ (ëª¨ë‘ ì„ íƒ)</label>
                <div id="diff-opts"></div>
                <input type="text" id="diffEtc" class="hidden text-left" placeholder="ê¸°íƒ€ ì–´ë ¤ì›€" style="width:100%; margin-top:5px;">
            </div>
        </div>
    </div>

    <div id="page-6" class="page">
        <div class="card">
            <h2>6. ëª©í‘œ ë° í¬ë§ ì„œë¹„ìŠ¤</h2>
            <div class="form-group"><label>4. í•™êµ ì¤‘ë‹¨ í›„ ê³„íš (ìˆœìœ„)</label>
                <div style="margin-bottom:8px;">1ìˆœìœ„: <select id="g1" onchange="updG()"><option value="">ì„ íƒ</option></select></div>
                <div style="margin-bottom:8px;">2ìˆœìœ„: <select id="g2" onchange="updG()"></select></div>
                <div style="margin-bottom:8px;">3ìˆœìœ„: <select id="g3"></select></div>
                <input type="text" id="gEtc" class="hidden text-left" placeholder="ê¸°íƒ€ ê³„íš">
            </div>
            <hr style="margin:30px 0; border:0; border-top:1px dashed #ddd;">
            <div class="form-group"><label>í¬ë§ ì„œë¹„ìŠ¤ (ëª¨ë‘ ì„ íƒ)</label><div id="service-opts"></div></div>
        </div>
    </div>

    <div id="page-7" class="page">
        <div class="card">
            <h2>7. ê³¼ê±° í•™êµìƒí™œ ë° ê±´ê°•</h2>
            
            <h3>ê³¼ê±° í•™êµ ìƒí™œ</h3>
            <div class="form-group"><label>1. í•™êµì—ì„œ ì–´ë ¤ìš¸ ë•Œ ë„ì›€ ì£¼ëŠ” ì„ ìƒë‹˜ì´ ê³„ì…¨ìŠµë‹ˆê¹Œ?</label>
                <div class="btn-group"><div class="btn-opt" onclick="sel(this,'tHelp','ì˜ˆ')">ì˜ˆ</div><div class="btn-opt" onclick="sel(this,'tHelp','ì•„ë‹ˆì˜¤')">ì•„ë‹ˆì˜¤</div></div>
            </div>
            <div class="form-group"><label>2. í˜ë“¤ ë•Œ ë§ˆìŒì„ í„°ë†“ê³  ì´ì•¼ê¸°í•  ì¹œêµ¬ê°€ ìˆì—ˆìŠµë‹ˆê¹Œ?</label>
                <div class="btn-group"><div class="btn-opt" onclick="sel(this,'fHelp','ì˜ˆ')">ì˜ˆ</div><div class="btn-opt" onclick="sel(this,'fHelp','ì•„ë‹ˆì˜¤')">ì•„ë‹ˆì˜¤</div></div>
            </div>
            <div class="form-group"><label>3. í¥ë¯¸ë¥¼ ê°–ê³  ì°¸ì—¬í•œ í•™êµ ì•ˆ/ë°– í™œë™ì´ ìˆì—ˆìŠµë‹ˆê¹Œ?</label>
                <div class="btn-group"><div class="btn-opt" onclick="sel(this,'act','ì˜ˆ'); document.getElementById('act-txt').classList.remove('hidden')">ì˜ˆ</div><div class="btn-opt" onclick="sel(this,'act','ì•„ë‹ˆì˜¤'); document.getElementById('act-txt').classList.add('hidden')">ì•„ë‹ˆì˜¤</div></div>
                <input type="text" id="act-txt" class="hidden text-left" placeholder="3-1. ë¬´ì—‡ì´ì—ˆìŠµë‹ˆê¹Œ? (ì˜ˆ: ë°´ë“œë¶€)" style="width:100%; margin-top:5px;">
            </div>

            <h3>ê±´ê°• ìƒíƒœ</h3>
            <div class="form-group"><label>1. ìµœê·¼ 2ë…„ ë‚´ ê±´ê°•ê²€ì§„ì„ ë°›ì•˜ìŠµë‹ˆê¹Œ?</label>
                <div class="btn-group"><div class="btn-opt" onclick="sel(this,'chk','ì˜ˆ'); document.getElementById('h1-1').classList.remove('hidden')">ì˜ˆ</div><div class="btn-opt" onclick="sel(this,'chk','ì•„ë‹ˆì˜¤'); document.getElementById('h1-1').classList.add('hidden'); document.getElementById('h1-2').classList.add('hidden')">ì•„ë‹ˆì˜¤</div></div>
            </div>
            <div id="h1-1" class="hidden" style="margin-left:10px; border-left:3px solid #eee; padding-left:10px; margin-bottom:20px;">
                <label style="font-size:0.95rem;">1-1. ê²€ì§„ì„ í†µí•´ ë°œê²¬ëœ ê±´ê°• ë¬¸ì œê°€ ìˆìŠµë‹ˆê¹Œ?</label>
                <div class="btn-group"><div class="btn-opt" onclick="sel(this,'prob','ì˜ˆ'); document.getElementById('h1-2').classList.remove('hidden')">ì˜ˆ</div><div class="btn-opt" onclick="sel(this,'prob','ì•„ë‹ˆì˜¤'); document.getElementById('h1-2').classList.add('hidden')">ì•„ë‹ˆì˜¤</div></div>
                <input type="text" id="h1-2" class="hidden text-left" placeholder="1-2. ì§„ë‹¨ëª…ì´ë‚˜ ì¦ìƒì€?" style="width:100%; margin-top:5px;">
            </div>

            <div class="form-group"><label>2. ì •ê¸°ì ìœ¼ë¡œ ë³‘ì› ë°©ë¬¸/ì•½ ë³µìš© ì¤‘ì…ë‹ˆê¹Œ?</label>
                <div class="btn-group"><div class="btn-opt" onclick="sel(this,'med','ì˜ˆ'); document.getElementById('h2-1').classList.remove('hidden')">ì˜ˆ</div><div class="btn-opt" onclick="sel(this,'med','ì•„ë‹ˆì˜¤'); document.getElementById('h2-1').classList.add('hidden')">ì•„ë‹ˆì˜¤</div></div>
                <input type="text" id="h2-1" class="hidden text-left" placeholder="2-1. ì§„ë‹¨ëª…ì´ë‚˜ ì¦ìƒì€?" style="width:100%; margin-top:5px;">
            </div>

            <div class="form-group"><label>3. ê³¼ê±° ì¥ê¸°ì…ì›(1ê°œì›” ì´ìƒ) ê²½í—˜ì´ ìˆìŠµë‹ˆê¹Œ?</label>
                <div class="btn-group"><div class="btn-opt" onclick="sel(this,'hosp','ì˜ˆ'); document.getElementById('h3-box').classList.remove('hidden')">ì˜ˆ</div><div class="btn-opt" onclick="sel(this,'hosp','ì•„ë‹ˆì˜¤'); document.getElementById('h3-box').classList.add('hidden')">ì•„ë‹ˆì˜¤</div></div>
            </div>
            <div id="h3-box" class="hidden" style="margin-left:10px; border-left:3px solid #eee; padding-left:10px;">
                <input type="text" id="h3-1" class="text-left" placeholder="3-1. ë³‘ëª… ë˜ëŠ” ì¦ìƒ" style="width:100%; margin-bottom:10px;">
                <label style="font-size:0.95rem;">3-2. ì…ì› ê¸°ê°„ì€?</label>
                <div id="hosp-time" class="btn-group"></div>
            </div>
        </div>
    </div>

    <div id="page-8" class="page">
        <div class="card">
            <h2>8. ìë¦½ì—­ëŸ‰ ì²™ë„</h2>
            <p style="color:#666; margin-bottom:20px;">â€» ê° ë¬¸í•­ì„ ì½ê³  ìì‹ ì—ê²Œ í•´ë‹¹ë˜ëŠ” ì •ë„ë¥¼ ì²´í¬í•´ì£¼ì„¸ìš”.</p>
            <div id="jarip-area"></div>
        </div>
    </div>

    <div id="page-9" class="page">
        <div class="card">
            <h2>9. ì‹¬ë¦¬ì •ì„œ ì²™ë„</h2>
            <p style="color:#666; margin-bottom:20px;">â€» ì†”ì§í•œ ë‹µë³€ì´ í° ë„ì›€ì´ ë©ë‹ˆë‹¤.</p>
            <div id="simni-area"></div>
        </div>
    </div>

    <div id="page-10" class="page">
        <div class="card">
            <h2>ì‘ì„± ë‚´ìš© í™•ì¸</h2>
            <p style="color:#666; margin-bottom:20px;">ì œì¶œí•˜ê¸° ì „ì— ì‘ì„±í•œ ë‚´ìš©ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.</p>
            <div id="review-content" style="white-space: pre-wrap; line-height: 1.6; font-size: 0.95rem; background: #f9f9f9; padding: 15px; border-radius: 10px;"></div>
        </div>
    </div>

    <div id="page-end" class="page text-center" style="margin-top:120px;">
        <div style="font-size:4rem;">ğŸ‰</div>
        <h1 style="color:var(--primary); margin-top:10px;">ì‘ì„± ì™„ë£Œ!</h1>
        <p style="font-size:1.1rem; color:#555; margin:30px 0;">ê¸´ ì‹œê°„ ë™ì•ˆ ìˆ˜ê³  ë§ìœ¼ì…¨ìŠµë‹ˆë‹¤.<br>ìƒë‹´ ì„ ìƒë‹˜ê»˜ íƒœë¸”ë¦¿ì„ ì „ë‹¬í•´ ì£¼ì„¸ìš”.</p>
        <button class="btn btn-prev" style="margin-top:40px; padding:15px 40px; width:auto;" onclick="location.reload()">ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>

</div>

<div class="bottom-bar hidden no-print" id="bottom-bar">
    <button class="btn btn-prev" onclick="move(-1)">ì´ì „</button>
    <button class="btn btn-next" id="nextBtn" onclick="move(1)">ë‹¤ìŒ</button>
</div>

<div id="admin-view" class="container hidden no-print">
    <div class="card">
        <h2>ğŸ”’ ê´€ë¦¬ì</h2>
        <input type="password" id="adminPw" placeholder="ë¹„ë°€ë²ˆí˜¸ 1388">
        <button class="btn btn-next" style="width:100%; margin-top:10px;" onclick="loginAdmin()">í™•ì¸</button>
        <button class="btn btn-prev" style="width:100%; margin-top:10px;" onclick="location.reload()">ë‚˜ê°€ê¸°</button>
    </div>
</div>
<div id="admin-list" class="container hidden no-print">
    <div class="card">
        <h2>ğŸ“‹ ì°¸ì—¬ì ëª©ë¡</h2>
        <ul id="list-area" style="list-style:none; padding:0;"></ul>
        <button class="btn btn-prev" style="width:100%;" onclick="location.reload()">ë‚˜ê°€ê¸°</button>
    </div>
</div>
<div id="report-area" class="hidden"></div>

<script>
    // [1] Firebase ì„¤ì •
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "kdream-db462.firebaseapp.com",
        projectId: "kdream-db462",
        storageBucket: "kdream-db462.firebasestorage.app",
        messagingSenderId: "1020262030810",
        appId: "1:1020262030810:web:3482636bc020bb4310b4e3"
    };
    try { firebase.initializeApp(firebaseConfig); var db = firebase.firestore(); } catch(e){}

    let curr = 1;
    const max = 10; // 9(ì²™ë„) + 1(ë¦¬ë·°)
    let data = {};
    let answers = {};
    let userType = "YOUTH"; 

    window.onload = () => {
        initAll();
        addFamRow(2); // ì´ˆê¸° 2ì¤„
    };

function initAll() {
        // [1] ë¶€ëª¨ë‹˜ ì˜ê²¬ (ì§ì ‘ ì •ì˜)
        const parentOpts = ["â‘  ì¼ì¹˜(ì°¬ì„±)", "â‘¡ ì¼ì¹˜(ë°˜ëŒ€)", "â‘¢ ë¶ˆì¼ì¹˜", "â‘£ ë¬´ê´€ì‹¬", "â‘¤ ê¸°íƒ€"];
        const agreeBox = document.getElementById('agree-opts');
        if (agreeBox) {
            agreeBox.innerHTML = parentOpts.map(o => 
                `<div class="btn-opt" onclick="sel(this,'agree','${o}'); if('${o}'.includes('ê¸°íƒ€')) document.getElementById('agreeEtc').classList.remove('hidden'); else document.getElementById('agreeEtc').classList.add('hidden')">${o}</div>`
            ).join('');
        }

        // [2] ì¤‘ë‹¨ ì‚¬ìœ 
        const r1 = document.getElementById('reason1');
        const r2 = document.getElementById('reason2');
        const r3 = document.getElementById('reason3');
        if(r1 && typeof REASON_OPTIONS !== 'undefined') {
            REASON_OPTIONS.forEach(r => {
                r1.add(new Option(r, r)); r2.add(new Option(r, r)); r3.add(new Option(r, r));
            });
        }
        
        // [3] ë°©ë¬¸ ê²½ë¡œ
        const pathBox = document.getElementById('path-opts');
        if(pathBox && typeof VISIT_PATHS !== 'undefined') {
            VISIT_PATHS.forEach(p => {
                let click = p.includes("ê¸°ê´€") ? `document.getElementById('org-wrap').classList.remove('hidden')` : `document.getElementById('org-wrap').classList.add('hidden')`;
                if(p.includes("ê¸°íƒ€")) click = `document.getElementById('pathEtc').classList.toggle('hidden')`;
                pathBox.innerHTML += `<div class="btn-opt" onclick="sel(this,'path','${p}'); ${click}">${p}</div>`;
            });
        }
        if(document.getElementById('org-opts') && typeof ORG_DETAILS !== 'undefined') {
            document.getElementById('org-opts').innerHTML = ORG_DETAILS.map(o => `<div class="btn-opt" onclick="sel(this,'orgDetail','${o}')">${o}</div>`).join('');
        }

        // [4] ê°€ì¡±/ê²½ì œ
        if(typeof FAMILY_BG_OPTIONS !== 'undefined') document.getElementById('fam-bg-opts').innerHTML = FAMILY_BG_OPTIONS.map(o => `<div class="btn-opt" onclick="toggle(this,'famBg','${o}')">${o}</div>`).join('');
        if(typeof FAMILY_TYPE_OPTIONS !== 'undefined') document.getElementById('fam-type-opts').innerHTML = FAMILY_TYPE_OPTIONS.map(t => `<div class="btn-opt" onclick="sel(this,'famType','${t}'); if('${t}'=='ê¸°íƒ€') document.getElementById('famEtc').classList.remove('hidden')">${t}</div>`).join('');
        if(typeof ECON_STATUS_OPTIONS !== 'undefined') document.getElementById('econ-opts').innerHTML = ECON_STATUS_OPTIONS.map(e => `<div class="btn-opt" onclick="sel(this,'econ','${e}')">${e}</div>`).join('');
        
        // 2. ë¬¼ì§ˆì  ì§€ì› (ì§ì ‘ ì •ì˜)
        const supportData = ["â‘  ë§¤ìš° ì¶©ë¶„", "â‘¡ ì¶©ë¶„", "â‘¢ ë³´í†µ", "â‘£ ë¶€ì¡±", "â‘¤ ë§¤ìš° ë¶€ì¡±", "â‘¥ ê¸°íƒ€"];
        document.getElementById('support-opts').innerHTML = supportData.map(o => 
            `<div class="btn-opt" onclick="sel(this,'support','${o}'); chkLack('${o}')">${o}</div>`
        ).join('');

        // 2-1. ë¶€ì¡± ì¶©ë‹¹ (ì§ì ‘ ì •ì˜)
        const lackData = ["â‘  ì¼(ì•„ë¥´ë°”ì´íŠ¸ í¬í•¨)ì„ í•´ì„œ ì¶©ë‹¹í•¨", "â‘¡ êµ­ê°€ë‚˜ ì§€ë°©ìì¹˜ë‹¨ì²´ì˜ ì§€ì›ê¸ˆì„ ë°›ê³  ìˆìŒ", "â‘¢ ìƒí™œë¹„ìš©(ìš©ëˆ)ì´ ì¶©ë¶„í•˜ì§€ ì•Šì§€ë§Œ ì•„ê»´ ì”€", "â‘£ ê¸°íƒ€"];
        document.getElementById('lack-opts').innerHTML = lackData.map(o => 
            `<div class="btn-opt" onclick="sel(this,'lackSol','${o}'); if('${o}'.includes('ê¸°íƒ€')) document.getElementById('lackEtc').classList.remove('hidden'); else document.getElementById('lackEtc').classList.add('hidden')">${o}</div>`
        ).join('');

        // 2-2. ìš©ëˆ (ì§ì ‘ ì •ì˜)
        const moneyData = ["â‘  ì „í˜€ ì—†ìŒ", "â‘¡ 10ë§Œì› ë¯¸ë§Œ", "â‘¢ 10~20ë§Œì›", "â‘£ 21~30ë§Œì›", "â‘¤ 30ë§Œì› ì´ìƒ"];
        document.getElementById('money-opts').innerHTML = moneyData.map(o => 
            `<div class="btn-opt" onclick="sel(this,'pocket','${o}')">${o}</div>`
        ).join('');

        // [5] ê´€ê³„/ì–´ë ¤ì›€ (ì§ì ‘ ì •ì˜ë¡œ ê°•ì œ ì¶œë ¥)
        const respectData = ["â‘  ë§¤ìš° ì¶©ë¶„", "â‘¡ ì¶©ë¶„", "â‘¢ ë³´í†µ", "â‘£ ë¶€ì¡±", "â‘¤ ë§¤ìš° ë¶€ì¡±", "â‘¥ ê¸°íƒ€"];
        document.getElementById('respect-opts').innerHTML = respectData.map(o => 
            `<div class="btn-opt" onclick="sel(this,'respect','${o}'); if('${o}'.includes('ê¸°íƒ€')) document.getElementById('resEtc').classList.remove('hidden'); else document.getElementById('resEtc').classList.add('hidden')">${o}</div>`
        ).join('');

        if(typeof CONFIDANT_OPTIONS !== 'undefined') document.getElementById('talk-opts').innerHTML = CONFIDANT_OPTIONS.map(o => `<div class="btn-opt" onclick="sel(this,'talk','${o}'); if('${o}'.includes('ê¸°íƒ€')) document.getElementById('talkEtc').classList.remove('hidden')">${o}</div>`).join('');
        
        const diff = document.getElementById('diff-opts');
        if(diff && typeof DIFFICULTY_GROUPS !== 'undefined') {
            for(let k in DIFFICULTY_GROUPS) {
                diff.innerHTML += `<h3>${k}</h3><div class="btn-group">` + 
                    DIFFICULTY_GROUPS[k].map(i => `<div class="btn-opt" onclick="toggle(this,'diff','${i}'); if('${i}'.includes('ê¸°íƒ€')) document.getElementById('diffEtc').classList.remove('hidden')">${i}</div>`).join('') + `</div>`;
            }
        }

        // [6] ëª©í‘œ/ì„œë¹„ìŠ¤
        if(document.getElementById('g1') && typeof GOAL_OPTIONS !== 'undefined') {
            ['g1','g2','g3'].forEach(id => {
                const el = document.getElementById(id);
                el.add(new Option("ì„ íƒ", ""));
                GOAL_OPTIONS.forEach(g => el.add(new Option(g, g)));
            });
        }
        
        const serv = document.getElementById('service-opts');
        if(serv && typeof SERVICE_GROUPS !== 'undefined') {
            for(let k in SERVICE_GROUPS) {
                serv.innerHTML += `<h3>${k}</h3><div class="btn-group">` + 
                    SERVICE_GROUPS[k].map(i => `<div class="btn-opt" onclick="toggle(this,'serv','${i}')">${i}</div>`).join('') + `</div>`;
            }
        }

        // [7] ê±´ê°•
        if(document.getElementById('hosp-time') && typeof HOSP_DURATION !== 'undefined') {
            document.getElementById('hosp-time').innerHTML = HOSP_DURATION.map(o => `<div class="btn-opt" onclick="sel(this,'hDur','${o}')">${o}</div>`).join('');
        }
    }

    function addFamRow(cnt = 1) {
        const container = document.getElementById('fam-rows');
        const current = container.getElementsByClassName('fam-row').length;
        if(current + cnt > 6) return alert("ìµœëŒ€ 5ëª…ê¹Œì§€ì…ë‹ˆë‹¤."); // header ì œì™¸
        
        for(let i=0; i<cnt; i++) {
            container.insertAdjacentHTML('beforeend', `<div class="fam-row"><input type="text" class="fr"><input type="text" class="fn"><input type="tel" class="fa"><input type="tel" class="ft"><select class="fl"><option>O</option><option>X</option></select></div>`);
        }
    }

    function sel(el, key, val) {
        data[key] = val;
        Array.from(el.parentElement.children).forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
    }

    function toggle(el, key, val) {
        el.classList.toggle('selected');
        if(!data[key]) data[key] = [];
        if(el.classList.contains('selected')) data[key].push(val);
        else data[key] = data[key].filter(v => v !== val);
    }

    function updR() {
        const v1 = document.getElementById('reason1').value;
        const v2 = document.getElementById('reason2');
        const v3 = document.getElementById('reason3');
        const etc = document.getElementById('reasonEtc');
        
        if(v1.includes("ê¸°íƒ€") || v2.value.includes("ê¸°íƒ€") || v3.value.includes("ê¸°íƒ€")) etc.classList.remove('hidden');
        else etc.classList.add('hidden');
        
        Array.from(v2.options).forEach(o => o.disabled = (o.value && o.value === v1));
        Array.from(v3.options).forEach(o => o.disabled = (o.value && (o.value === v1 || o.value === v2.value)));
    }

    function updG() {
        const v1 = document.getElementById('g1').value;
        const v2 = document.getElementById('g2');
        const v3 = document.getElementById('g3');
        const etc = document.getElementById('gEtc');

        if(v1.includes("ê¸°íƒ€") || v2.value.includes("ê¸°íƒ€") || v3.value.includes("ê¸°íƒ€")) etc.classList.remove('hidden');
        else etc.classList.add('hidden');

        Array.from(v2.options).forEach(o => o.disabled = (o.value && o.value === v1));
        Array.from(v3.options).forEach(o => o.disabled = (o.value && (o.value === v1 || o.value === v2.value)));
    }

    function showGr(n) {
        const box = document.getElementById('grade-wrap');
        const opts = document.getElementById('grade-opts');
        if(n===0) { box.classList.add('hidden'); return; }
        
        box.classList.remove('hidden');
        opts.innerHTML = "";
        for(let i=1; i<=n; i++) opts.innerHTML += `<div class="btn-opt" onclick="sel(this,'grade','${i}í•™ë…„')">${i}í•™ë…„</div>`;
    }

    function move(dir) {
        // ì¸íŠ¸ë¡œ í™”ë©´ ì²˜ë¦¬
        if(document.getElementById('intro-page').classList.contains('active')) return;

        // 1í˜ì´ì§€ì—ì„œ ì´ì „ -> ì¸íŠ¸ë¡œ
        if(curr === 1 && dir === -1) {
            document.getElementById('survey-wrap').classList.add('hidden');
            document.getElementById('bottom-bar').classList.add('hidden');
            document.getElementById('intro-page').classList.remove('hidden');
            document.getElementById('intro-page').classList.add('active');
            return;
        }

        document.getElementById(`page-${curr}`).classList.remove('active');
        curr += dir;
        
        if(curr < 1) curr = 1;
        
        // ì²™ë„ ë°ì´í„° ë¡œë“œ
        if(curr === 8) loadScale('jarip');
        if(curr === 9) loadScale('simni');
        
        // ë¦¬ë·° í˜ì´ì§€
        if(curr === 10) showReview();

        if(curr > max) { submit(); return; }

        document.getElementById(`page-${curr}`).classList.add('active');
        document.getElementById('progressBar').style.width = (curr/max*100) + "%";
        
        // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
        const nextBtn = document.getElementById('nextBtn');
        if(curr === max) nextBtn.innerText = "ì œì¶œí•˜ê¸°";
        else nextBtn.innerText = "ë‹¤ìŒ";
        
        window.scrollTo(0,0);
    }

    function loadScale(part) {
        const y2 = document.getElementById('rrn1').value.substr(0,2);
        const y = parseInt(y2) < 30 ? 2000+parseInt(y2) : 1900+parseInt(y2);
        userType = (new Date().getFullYear() - y >= 13) ? "YOUTH" : "CHILD";

        const list = SCALE_DATA[userType][part];
        const div = document.getElementById(part+'-area');
        div.innerHTML = "";
        list.forEach((q, i) => {
            div.innerHTML += `
                <div class="scale-row">
                    <div class="scale-q">${i+1}. ${q.t}</div>
                    <div class="scale-btns">
                        <div class="scale-btn" onclick="ans('${part}',${q.n},1,this,${q.rev},${q.crit},'${q.d}')"><span class="num">1</span>ì „í˜€ì•„ë‹˜</div>
                        <div class="scale-btn" onclick="ans('${part}',${q.n},2,this,${q.rev},${q.crit},'${q.d}')"><span class="num">2</span>ì•„ë‹ˆë‹¤</div>
                        <div class="scale-btn" onclick="ans('${part}',${q.n},3,this,${q.rev},${q.crit},'${q.d}')"><span class="num">3</span>ë³´í†µ</div>
                        <div class="scale-btn" onclick="ans('${part}',${q.n},4,this,${q.rev},${q.crit},'${q.d}')"><span class="num">4</span>ê·¸ë ‡ë‹¤</div>
                        <div class="scale-btn" onclick="ans('${part}',${q.n},5,this,${q.rev},${q.crit},'${q.d}')"><span class="num">5</span>ë§¤ìš°ê·¸ë ‡ë‹¤</div>
                    </div>
                </div>`;
        });
    }

    function ans(part, n, v, el, r, c, d) {
        answers[`${part}_${n}`] = {val:v, rev:r, crit:c, domain:d};
        Array.from(el.parentElement.children).forEach(c => c.classList.remove('selected'));
        el.classList.add('selected');
    }

    function startSurvey() {
        document.getElementById('intro-page').classList.add('hidden');
        document.getElementById('intro-page').classList.remove('active');
        
        document.getElementById('survey-wrap').classList.remove('hidden');
        document.getElementById('bottom-bar').classList.remove('hidden');
        
        curr = 1;
        document.getElementById(`page-1`).classList.add('active');
        document.getElementById('progressBar').style.width = (1/max*100) + "%";
    }

    function autoBirth(el) {
        if(el.value.length === 6) {
            const y = parseInt(el.value.substr(0,2));
            const fy = y < 30 ? 2000+y : 1900+y;
            document.getElementById('birthDisplay').innerText = `${fy}ë…„ ${el.value.substr(2,2)}ì›” ${el.value.substr(4,2)}ì¼`;
            document.getElementById('rrn2').focus();
        }
    }

    function execPostcode() {
        new daum.Postcode({
            oncomplete: function(data) {
                document.getElementById('address').value = data.roadAddress;
                document.getElementById('detailAddr').focus();
            }
        }).open();
    }

    function showReview() {
        // ë°ì´í„° ìˆ˜ì§‘
        collectData();
        const div = document.getElementById('review-content');
        div.innerHTML = `
            <div class="review-section"><div class="review-title">ê¸°ë³¸ ì •ë³´</div>ì´ë¦„: ${data.name}<br>ì—°ë½ì²˜: ${data.tel}</div>
            <div class="review-section"><div class="review-title">í•™ì—… ì¤‘ë‹¨</div>${data.dropDate} ì¤‘ë‹¨ (${data.reasons})</div>
            <div class="review-section"><div class="review-title">ì§„ë¡œ/ëª©í‘œ</div>${data.goals}</div>
            <div class="review-section"><div class="review-title">í¬ë§ ì„œë¹„ìŠ¤</div>${data.serv ? data.serv.join(", ") : "-"}</div>
        `;
    }

    function collectData() {
        data.name = document.getElementById('userName').value;
        data.rrn = document.getElementById('rrn1').value + "-" + document.getElementById('rrn2').value;
        data.addr = document.getElementById('address').value + " " + document.getElementById('detailAddr').value;
        data.tel = `${document.getElementById('t1').value}-${document.getElementById('t2').value}-${document.getElementById('t3').value}`;
        data.ptel = `${document.getElementById('p1').value}-${document.getElementById('p2').value}-${document.getElementById('p3').value}`;
        data.dropDate = `${document.getElementById('dY').value}.${document.getElementById('dM').value}.${document.getElementById('dD').value}`;
        data.goals = [document.getElementById('g1').value, document.getElementById('g2').value, document.getElementById('g3').value].filter(Boolean).join(", ");
        data.reasons = [document.getElementById('reason1').value, document.getElementById('reason2').value, document.getElementById('reason3').value].filter(Boolean).join(", ");
        if(document.getElementById('reasonEtc').value) data.reasons += ` (${document.getElementById('reasonEtc').value})`;
    }

    function submit() {
        if(!confirm("ì œì¶œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) { curr--; document.getElementById(`page-${curr}`).classList.add('active'); return; }
        
        collectData();
        const payload = { info: data, ans: answers, ts: firebase.firestore.FieldValue.serverTimestamp() };
        
        if(db) {
            db.collection("intake_complete").add(payload).then(() => showEnd());
        } else {
            alert("DB ë¯¸ì—°ê²° (í…ŒìŠ¤íŠ¸ ì™„ë£Œ)");
            showEnd();
        }
    }

    function showEnd() {
        document.getElementById('survey-wrap').classList.add('hidden');
        document.getElementById('bottom-bar').classList.add('hidden');
        document.getElementById('page-end').classList.remove('hidden');
    }

    function showAdmin() {
        document.getElementById('intro-page').classList.add('hidden');
        document.getElementById('admin-view').classList.remove('hidden');
    }
    
    function loginAdmin() {
        if(document.getElementById('adminPw').value === "1388") {
            document.getElementById('admin-view').classList.add('hidden');
            document.getElementById('admin-list').classList.remove('hidden');
            loadList();
        } else alert("ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜");
    }

    function loadList() {
        const ul = document.getElementById('list-area');
        ul.innerHTML = "ë¡œë”©ì¤‘...";
        db.collection("intake_complete").orderBy("ts", "desc").limit(10).get().then(snap => {
            ul.innerHTML = "";
            snap.forEach(doc => {
                const d = doc.data();
                ul.innerHTML += `<li class="card" style="padding:15px; display:flex; justify-content:space-between;">
                    <b>${d.info.name}</b> <button class="btn-opt" style="width:auto; min-width:60px;" onclick='viewRpt(${JSON.stringify(d)})'>ë³´ê¸°</button>
                </li>`;
            });
        });
    }

    function viewRpt(d) {
        document.getElementById('admin-list').classList.add('hidden');
        document.getElementById('report-area').classList.remove('hidden');
        document.getElementById('report-area').innerHTML = `<div style="padding:20px; border:2px solid #333;"><h2>ê²°ê³¼</h2><pre>${JSON.stringify(d, null, 2)}</pre></div><button class="no-print btn-opt" onclick="location.reload()">ë‹«ê¸°</button>`;
    }

    // [2P] í•™êµ ì„ íƒ ì‹œ í•™ë…„ ë…¸ì¶œ
    function selSchool(el, type, maxGrade) {
        sel(el, 'schLvl', type); // ê°’ ì €ì¥ ë° ìŠ¤íƒ€ì¼ ì ìš©
        
        const gBox = document.getElementById('grade-box');
        const sBox = document.getElementById('semester-box');
        
        // ì´ˆê¸°í™”
        gBox.classList.add('hidden');
        sBox.classList.add('hidden');
        document.getElementById('grade-opts').innerHTML = "";

        // ë¯¸ì§„í•™ì´ë©´ ì¢…ë£Œ
        if (maxGrade === 0) return;

        // í•™ë…„ ë²„íŠ¼ ìƒì„± ë° ë…¸ì¶œ
        gBox.classList.remove('hidden');
        let html = "";
        for(let i=1; i<=maxGrade; i++) {
            html += `<div class="btn-opt" onclick="selGrade(this, '${i}í•™ë…„')">${i}í•™ë…„</div>`;
        }
        document.getElementById('grade-opts').innerHTML = html;
    }

    // [2P] í•™ë…„ ì„ íƒ ì‹œ í•™ê¸° ë…¸ì¶œ
    function selGrade(el, val) {
        sel(el, 'grade', val); // ê°’ ì €ì¥
        document.getElementById('semester-box').classList.remove('hidden'); // í•™ê¸° ë°•ìŠ¤ ë³´ì´ê¸°
    }

    // [2P] ë‚ ì§œ ê¸€ììˆ˜ ì œí•œ (4ìë¦¬, 2ìë¦¬)
    function sliceLen(el, max) {
        if(el.value.length > max) {
            el.value = el.value.slice(0, max);
        }
    }

    // [4P] ë¬¼ì§ˆì  ì§€ì› ì„ íƒ ì‹œ ë¡œì§ (ë¶€ì¡±í•˜ë©´ 2-1 í‘œì‹œ, ê¸°íƒ€ë©´ ì…ë ¥ì°½ í‘œì‹œ)
    function chkLack(val) {
        sel(event.currentTarget, 'support', val); // ê°’ ì €ì¥
        
        // ë¶€ì¡±/ë§¤ìš°ë¶€ì¡± ì„ íƒ ì‹œ 2-1 ì§ˆë¬¸ ë³´ì´ê¸°
        if(val.includes('ë¶€ì¡±')) document.getElementById('lack-box').classList.remove('hidden');
        else document.getElementById('lack-box').classList.add('hidden');
        
        // ê¸°íƒ€ ì„ íƒ ì‹œ ì…ë ¥ì°½ ë³´ì´ê¸°
        if(val.includes('ê¸°íƒ€')) document.getElementById('supEtc').classList.remove('hidden');
        else document.getElementById('supEtc').classList.add('hidden');
    }
</script>
</body>
</html>






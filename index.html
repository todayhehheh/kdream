<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë…¸ì›êµ¬ ê¿ˆë“œë¦¼ í†µí•© ì¸í…Œì´í¬</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --primary: #00C7AE; --secondary: #333; --bg: #F0F4F8; --card: #FFFFFF; --text: #333; --danger: #FF6B6B; }
        
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; line-height: 1.5; -webkit-tap-highlight-color: transparent; }
        
        /* ì§„í–‰ë¥  ë°” */
        .progress-container { position: fixed; top: 0; left: 0; width: 100%; height: 6px; background: #E0E0E0; z-index: 100; }
        .progress-bar { height: 100%; background: var(--primary); width: 0%; transition: width 0.4s ease; }

        .container { max-width: 800px; margin: 0 auto; padding: 40px 20px 80px 20px; }
        .card { background: var(--card); border-radius: 20px; padding: 30px; margin-bottom: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); animation: fadeIn 0.5s ease; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h1 { color: var(--primary); text-align: center; margin-bottom: 10px; font-weight: 800; font-size: 1.8rem; }
        h2 { color: var(--secondary); margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 15px; font-size: 1.4rem; }
        h3 { font-size: 1.1rem; color: #555; margin-top: 25px; margin-bottom: 10px; }

        /* ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ */
        .form-group { margin-bottom: 20px; }
        label { display: block; font-weight: 700; margin-bottom: 8px; color: #444; }
        .sub-label { font-size: 0.9em; color: #888; font-weight: normal; margin-left: 5px; }
        
        input, select, textarea { width: 100%; padding: 14px; border: 1px solid #ddd; border-radius: 12px; font-size: 1rem; box-sizing: border-box; transition: 0.2s; background: #fafafa; }
        input:focus, select:focus, textarea:focus { border-color: var(--primary); outline: none; background: #fff; box-shadow: 0 0 0 3px rgba(0, 199, 174, 0.1); }

        /* ì£¼ë¯¼ë²ˆí˜¸ ì…ë ¥ìš© */
        .rrn-box { display: flex; align-items: center; gap: 10px; }
        .rrn-box input { text-align: center; letter-spacing: 2px; }

        /* ë¼ë””ì˜¤/ì²´í¬ë°•ìŠ¤ ë²„íŠ¼í˜• */
        .btn-group { display: flex; gap: 8px; flex-wrap: wrap; }
        .btn-group label { 
            flex: 1; min-width: 80px; text-align: center; padding: 12px; border: 1px solid #ddd; border-radius: 10px; cursor: pointer; 
            font-weight: 500; background: #fff; transition: 0.2s; margin: 0;
        }
        .btn-group input { display: none; }
        .btn-group label:has(input:checked) { background: var(--primary); color: white; border-color: var(--primary); font-weight: 700; }

        /* ê°€ì¡±ê´€ê³„ í…Œì´ë¸” ìŠ¤íƒ€ì¼ ì…ë ¥ */
        .family-row { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 5px; margin-bottom: 10px; }
        .family-row input { padding: 10px; font-size: 0.9em; }

        /* ë²„íŠ¼ */
        .btn-action { width: 100%; padding: 18px; background: var(--primary); color: white; border: none; border-radius: 12px; font-size: 1.2rem; font-weight: 800; cursor: pointer; margin-top: 30px; box-shadow: 0 5px 15px rgba(0, 199, 174, 0.3); transition: 0.2s; }
        .btn-action:active { transform: scale(0.98); }
        .btn-secondary { background: #95a5a6; box-shadow: none; margin-top: 10px; }

        .hidden { display: none !important; }
        .q-card { background: #fff; border: 1px solid #eee; border-radius: 15px; padding: 25px; margin-bottom: 20px; }
        .q-text { font-size: 1.2rem; font-weight: bold; margin-bottom: 15px; word-break: keep-all; }

        /* [ì¸ì‡„ ì „ìš© ìŠ¤íƒ€ì¼] */
        @media print {
            body { background: white; padding: 0; font-size: 10pt; }
            .progress-container, .no-print, .btn-action, #step-intro, #step-forms, #admin-login { display: none !important; }
            #report-area { display: block !important; }
            .card { box-shadow: none; border: none; padding: 0; margin: 0; }
            table { width: 100%; border-collapse: collapse; margin-bottom: 15px; font-size: 9pt; }
            th, td { border: 1px solid #000; padding: 5px; text-align: center; word-break: keep-all; }
            th { background-color: #f0f0f0; font-weight: bold; }
            .text-left { text-align: left; padding-left: 10px; }
            .section-header { font-size: 12pt; font-weight: bold; border-bottom: 2px solid #000; margin: 20px 0 5px 0; }
            .page-break { page-break-before: always; }
        }
    </style>
</head>
<body>

<div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>

<div id="step-intro" class="container" style="text-align: center; padding-top: 100px;">
    <div class="card">
        <h1 style="font-size: 2rem;">ë…¸ì›êµ¬ ê¿ˆë“œë¦¼</h1>
        <h2 style="border:none; color:#666;">í¬ë§ ì„œë¹„ìŠ¤ ë° ì´ˆê¸°ìƒë‹´ ì¡°ì‚¬í‘œ</h2>
        <p style="margin: 40px 0; font-size: 1.1rem; color: #555; line-height: 1.8;">
            ì•ˆë…•í•˜ì„¸ìš”.<br>
            ì—¬ëŸ¬ë¶„ì—ê²Œ ê¼­ í•„ìš”í•œ ì§€ì›ì„ ì œê³µí•˜ê¸° ìœ„í•´<br>
            ëª‡ ê°€ì§€ ì§ˆë¬¸ì„ ë“œë¦¬ê³ ì í•©ë‹ˆë‹¤.<br>
            <br>
            ëª¨ë“  ë‚´ìš©ì€ <strong>ë¹„ë°€ì´ ë³´ì¥</strong>ë˜ë‹ˆ<br>
            í¸ì•ˆí•œ ë§ˆìŒìœ¼ë¡œ ì‘ì„±í•´ ì£¼ì„¸ìš”.
        </p>
        <button class="btn-action" onclick="startSurvey()">ì‹œì‘í•˜ê¸°</button>
        <p style="margin-top: 20px; color: #ccc; cursor: pointer;" onclick="showAdmin()">ğŸ”’ ê´€ë¦¬ì ëª¨ë“œ</p>
    </div>
</div>

<div id="step-forms" class="container hidden">
    
    <div id="section-basic" class="card">
        <h2>1. ê¸°ë³¸ ì¸ì ì‚¬í•­</h2>
        
        <div class="form-group">
            <label>ì„±ëª…</label>
            <input type="text" id="userName" placeholder="ì´ë¦„ ì…ë ¥">
        </div>
        
        <div class="form-group">
            <label>ì„±ë³„</label>
            <div class="btn-group">
                <label><input type="radio" name="gender" value="ë‚¨">ë‚¨ì</label>
                <label><input type="radio" name="gender" value="ì—¬">ì—¬ì</label>
            </div>
        </div>

        <div class="form-group">
            <label>ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ <span class="sub-label">(13ìë¦¬)</span></label>
            <div class="rrn-box">
                <input type="number" id="rrn1" placeholder="ì• 6ìë¦¬" oninput="if(this.value.length>6) this.value=this.value.slice(0,6)">
                <span>-</span>
                <input type="password" id="rrn2" placeholder="ë’¤ 7ìë¦¬" oninput="if(this.value.length>7) this.value=this.value.slice(0,7)">
            </div>
        </div>

        <div class="form-group">
            <label>ì—°ë½ì²˜ (ë³¸ì¸)</label>
            <input type="tel" id="telSelf" placeholder="010-0000-0000">
        </div>

        <div class="form-group">
            <label>ì—°ë½ì²˜ (ë³´í˜¸ì)</label>
            <input type="tel" id="telParent" placeholder="010-0000-0000">
        </div>

        <div class="form-group">
            <label>í˜„ì¬ ìƒíƒœ êµ¬ë¶„</label>
            <div class="btn-group" style="flex-direction: column;">
                <label><input type="radio" name="status" value="í•™êµë°–ì²­ì†Œë…„">í•™êµ ë°– ì²­ì†Œë…„ (ìí‡´, ë¯¸ì§„í•™ ë“±)</label>
                <label><input type="radio" name="status" value="ê²€ì •ê³ ì‹œí•©ê²©">ê³ ì¡¸ ê²€ì •ê³ ì‹œ í•©ê²© ì²­ì†Œë…„</label>
                <label><input type="radio" name="status" value="í•™ì—…ì¤‘ë‹¨ìˆ™ë ¤ì œ">í•™ì—…ì¤‘ë‹¨ ìˆ™ë ¤ì œ (ìƒë‹´ ê¸°ê°„ ì¤‘)</label>
                <label><input type="radio" name="status" value="ì¬í•™ìƒ">ì¬í•™ìƒ (ì ì¬ì  ìœ„ê¸°)</label>
            </div>
        </div>
        <button class="btn-action" onclick="nextSection('section-school')">ë‹¤ìŒ</button>
    </div>

    <div id="section-school" class="card hidden">
        <h2>2. í•™ì—… ê´€ë ¨ ì •ë³´</h2>
        
        <div class="form-group">
            <label>ì–¸ì œ í•™êµë¥¼ ê·¸ë§Œë‘ì—ˆë‚˜ìš”?</label>
            <div style="display:flex; gap:5px; margin-bottom:10px;">
                <select id="dropLevel">
                    <option value="">í•™êµê¸‰</option>
                    <option value="ì´ˆ">ì´ˆë“±í•™êµ</option>
                    <option value="ì¤‘">ì¤‘í•™êµ</option>
                    <option value="ê³ ">ê³ ë“±í•™êµ</option>
                    <option value="ë¯¸ì§„í•™">ë¯¸ì§„í•™</option>
                </select>
                <select id="dropGrade">
                    <option value="">í•™ë…„</option>
                    <option value="1">1í•™ë…„</option>
                    <option value="2">2í•™ë…„</option>
                    <option value="3">3í•™ë…„</option>
                    <option value="4">4í•™ë…„</option>
                    <option value="5">5í•™ë…„</option>
                    <option value="6">6í•™ë…„</option>
                </select>
            </div>
            <label class="sub-label">ê·¸ë§Œë‘” ë‚ ì§œ (ëŒ€ëµì ìœ¼ë¡œ)</label>
            <input type="date" id="dropDate">
        </div>

        <div class="form-group">
            <label>í•™êµë¥¼ ê·¸ë§Œë‘”(ì¤‘ë‹¨í•œ) ì´ìœ  (ìš°ì„ ìˆœìœ„)</label>
            <select id="dropReason1" style="margin-bottom:5px;">
                <option value="">1ìˆœìœ„ (í•„ìˆ˜)</option>
                <option value="ì‹¬ë¦¬">ì‹¬ë¦¬Â·ì •ì„œì  ì–´ë ¤ì›€</option>
                <option value="í•™ì—…">ì›í•˜ëŠ” ê³µë¶€(ê²€ì •ê³ ì‹œ ë“±)ë¥¼ ìœ„í•´</option>
                <option value="ê´€ê³„">ì¹œêµ¬/ì„ ìƒë‹˜ê³¼ì˜ ê´€ê³„</option>
                <option value="íŠ¹ê¸°">íŠ¹ê¸°/ì§„ë¡œë¥¼ ìœ„í•´</option>
                <option value="ê²½ì œ">ê²½ì œì  ì‚¬ì •</option>
                <option value="ê·œì¹™">í•™êµ ê·œì¹™/ë¶„ìœ„ê¸° ë¶€ì ì‘</option>
                <option value="ê¸°íƒ€">ê¸°íƒ€</option>
            </select>
            <select id="dropReason2" style="margin-bottom:5px;">
                <option value="">2ìˆœìœ„ (ì„ íƒ)</option>
                <option value="ì‹¬ë¦¬">ì‹¬ë¦¬Â·ì •ì„œì  ì–´ë ¤ì›€</option>
                <option value="í•™ì—…">ì›í•˜ëŠ” ê³µë¶€(ê²€ì •ê³ ì‹œ ë“±)ë¥¼ ìœ„í•´</option>
                <option value="ê´€ê³„">ì¹œêµ¬/ì„ ìƒë‹˜ê³¼ì˜ ê´€ê³„</option>
                <option value="íŠ¹ê¸°">íŠ¹ê¸°/ì§„ë¡œë¥¼ ìœ„í•´</option>
                <option value="ê²½ì œ">ê²½ì œì  ì‚¬ì •</option>
                <option value="ê·œì¹™">í•™êµ ê·œì¹™/ë¶„ìœ„ê¸° ë¶€ì ì‘</option>
            </select>
        </div>

        <div class="form-group">
            <label>ê·¸ë§Œë‘˜ ë‹¹ì‹œ ë¶€ëª¨ë‹˜(ë³´í˜¸ì)ì˜ ì˜ê²¬ì€?</label>
            <div class="btn-group">
                <label><input type="radio" name="parentAgree" value="ë™ì˜">ë™ì˜í•˜ì…¨ìŒ</label>
                <label><input type="radio" name="parentAgree" value="ë°˜ëŒ€">ë°˜ëŒ€í•˜ì…¨ìŒ</label>
                <label><input type="radio" name="parentAgree" value="ë¬´ê´€ì‹¬">ë³„ ê´€ì‹¬ ì—†ìœ¼ì…¨ìŒ</label>
            </div>
        </div>

        <div class="form-group">
            <label>ê¿ˆë“œë¦¼ ì„¼í„°ë¥¼ ì•Œê²Œ ëœ ê²½ë¡œ</label>
            <select id="referralPath">
                <option value="ì¹œêµ¬">ì¹œêµ¬/ì§€ì¸ ì†Œê°œ</option>
                <option value="ë¶€ëª¨">ë¶€ëª¨ë‹˜/ê°€ì¡± ê¶Œìœ </option>
                <option value="í•™êµ">í•™êµ ì„ ìƒë‹˜ ì•ˆë‚´</option>
                <option value="ì¸í„°ë„·">ì¸í„°ë„· ê²€ìƒ‰/SNS</option>
                <option value="êµìœ¡ì²­">êµìœ¡ì²­/ê²½ì°°ì„œ ì—°ê³„</option>
                <option value="í˜„ìˆ˜ë§‰">í™ë³´ë¬¼(í˜„ìˆ˜ë§‰ ë“±)</option>
            </select>
        </div>
        <button class="btn-action" onclick="nextSection('section-family')">ë‹¤ìŒ</button>
    </div>

    <div id="section-family" class="card hidden">
        <h2>3. ê°€ì¡± ë° ê²½ì œ ìƒí™©</h2>
        
        <div class="form-group">
            <label>ê°€ì¡± êµ¬ì„±ì› (í•¨ê»˜ ì‚¬ëŠ” ê°€ì¡±)</label>
            <div style="background:#f9f9f9; padding:10px; border-radius:10px;">
                <div class="family-row" style="font-weight:bold; font-size:0.8em; text-align:center;">
                    <span>ê´€ê³„</span><span>ì„±ëª…</span><span>ì—°ë ¹</span><span>ë™ê±°</span>
                </div>
                <div class="family-row">
                    <input type="text" id="famRel1" placeholder="ì˜ˆ: ë¶€">
                    <input type="text" id="famName1">
                    <input type="number" id="famAge1">
                    <select id="famLive1"><option value="Y">O</option><option value="N">X</option></select>
                </div>
                <div class="family-row">
                    <input type="text" id="famRel2" placeholder="ì˜ˆ: ëª¨">
                    <input type="text" id="famName2">
                    <input type="number" id="famAge2">
                    <select id="famLive2"><option value="Y">O</option><option value="N">X</option></select>
                </div>
                <div class="family-row">
                    <input type="text" id="famRel3" placeholder="ì˜ˆ: í˜•ì œ">
                    <input type="text" id="famName3">
                    <input type="number" id="famAge3">
                    <select id="famLive3"><option value="Y">O</option><option value="N">X</option></select>
                </div>
            </div>
        </div>

        <div class="form-group">
            <label>í˜„ì¬ ê°€ì • í˜•íƒœ</label>
            <div class="btn-group">
                <label><input type="radio" name="familyType" value="ì–‘ë¶€ëª¨">ì–‘ë¶€ëª¨ ê°€ì •</label>
                <label><input type="radio" name="familyType" value="í•œë¶€ëª¨">í•œë¶€ëª¨ ê°€ì •</label>
                <label><input type="radio" name="familyType" value="ì¡°ì†">ì¡°ì† ê°€ì •</label>
                <label><input type="radio" name="familyType" value="ì‹œì„¤">ì‹œì„¤/ì‰¼í„°</label>
                <label><input type="radio" name="familyType" value="ìì·¨">ìì·¨/ë…ë¦½</label>
            </div>
        </div>

        <div class="form-group">
            <label>ê°€ì •ì˜ ê²½ì œ ìƒíƒœ (ë³¸ì¸ ìƒê°)</label>
            <div class="btn-group">
                <label><input type="radio" name="econStatus" value="ìƒ">ì—¬ìœ  ìˆìŒ</label>
                <label><input type="radio" name="econStatus" value="ì¤‘">ë³´í†µì´ë‹¤</label>
                <label><input type="radio" name="econStatus" value="í•˜">ì–´ë µë‹¤</label>
            </div>
        </div>

        <div class="form-group">
            <label>ìš©ëˆì€ ì¶©ë¶„í•œê°€ìš”?</label>
            <div class="btn-group">
                <label><input type="radio" name="moneySat" value="ì¶©ë¶„">ì¶©ë¶„í•¨</label>
                <label><input type="radio" name="moneySat" value="ë³´í†µ">ë³´í†µ</label>
                <label><input type="radio" name="moneySat" value="ë¶€ì¡±">ë¶€ì¡±í•¨</label>
                <label><input type="radio" name="moneySat" value="ì—†ìŒ">ì•ˆ ë°›ìŒ</label>
            </div>
        </div>
        
        <div class="form-group">
            <label>ê°€ì¡±ì€ ë‚˜ì—ê²Œ ê´€ì‹¬ì´ ìˆë‚˜ìš”?</label>
            <div class="btn-group">
                <label><input type="radio" name="famInterest" value="ë§ìŒ">ì•„ì£¼ ë§ìŒ</label>
                <label><input type="radio" name="famInterest" value="ë³´í†µ">ë³´í†µ</label>
                <label><input type="radio" name="famInterest" value="ì—†ìŒ">ê±°ì˜ ì—†ìŒ</label>
            </div>
        </div>

        <button class="btn-action" onclick="nextSection('section-needs')">ë‹¤ìŒ</button>
    </div>

    <div id="section-needs" class="card hidden">
        <h2>4. í˜„ì¬ ìƒíƒœ ë° ì„œë¹„ìŠ¤ ìš•êµ¬</h2>

        <div class="form-group">
            <label>í˜„ì¬ ê²ªê³  ìˆëŠ” ì–´ë ¤ì›€ (ëª¨ë‘ ì²´í¬)</label>
            <div class="btn-group">
                <label><input type="checkbox" name="difficulties" value="ì§„ë¡œ">ì§„ë¡œê²°ì •</label>
                <label><input type="checkbox" name="difficulties" value="í•™ì—…">í•™ì—…ë¶€ì§„</label>
                <label><input type="checkbox" name="difficulties" value="ê°€ì¡±">ê°€ì¡±ê°ˆë“±</label>
                <label><input type="checkbox" name="difficulties" value="ì¹œêµ¬">ëŒ€ì¸ê´€ê³„</label>
                <label><input type="checkbox" name="difficulties" value="ì„±ê²©">ì„±ê²©/ì •ì„œ</label>
                <label><input type="checkbox" name="difficulties" value="ê²½ì œ">ê²½ì œë¬¸ì œ</label>
                <label><input type="checkbox" name="difficulties" value="ìŠ¤ë§ˆíŠ¸í°">ìŠ¤ë§ˆíŠ¸í°</label>
                <label><input type="checkbox" name="difficulties" value="ë¹„í–‰">ì¼íƒˆ/ë¹„í–‰</label>
            </div>
        </div>

        <div class="form-group">
            <label>í•™êµ ì¤‘ë‹¨ í›„ ëª©í‘œ</label>
            <select id="goal">
                <option value="ê²€ì •ê³ ì‹œ">ê²€ì •ê³ ì‹œ í•©ê²©</option>
                <option value="ì§„í•™">ìƒê¸‰í•™êµ(ëŒ€í•™) ì§„í•™</option>
                <option value="ë³µí•™">ì›ì êµ ë³µí•™</option>
                <option value="ì·¨ì—…">ì·¨ì—…/ì°½ì—…</option>
                <option value="ìê²©ì¦">ìê²©ì¦ ì·¨ë“</option>
                <option value="ë¯¸ì •">ì•„ì§ ëª¨ë¥´ê² ìŒ</option>
            </select>
        </div>

        <div class="form-group">
            <label>ê¿ˆë“œë¦¼ì—ì„œ ë°›ê³  ì‹¶ì€ ì„œë¹„ìŠ¤ (1ìˆœìœ„)</label>
            <select id="serviceWant">
                <option value="ìƒë‹´">ìƒë‹´ (ì‹¬ë¦¬, ì§„ë¡œ)</option>
                <option value="êµìœ¡">êµìœ¡ (ê²€ì •ê³ ì‹œ, ìˆ˜ëŠ¥, ë©˜í† ë§)</option>
                <option value="ìë¦½">ìë¦½ (ìê²©ì¦, ì§ì—…ì²´í—˜)</option>
                <option value="ë¬¸í™”">ë¬¸í™”í™œë™ (ë™ì•„ë¦¬, ìº í”„)</option>
                <option value="ìƒí™œ">ìƒí™œì§€ì› (ê¸‰ì‹, ê±´ê°•ê²€ì§„)</option>
            </select>
        </div>

        <div class="form-group">
            <label>ê³¼ê±° í•™êµìƒí™œì€ ì–´ë• ë‚˜ìš”?</label>
            <div class="btn-group">
                <label><input type="radio" name="pastSchool" value="ë§Œì¡±">ì¬ë¯¸ìˆì—ˆë‹¤</label>
                <label><input type="radio" name="pastSchool" value="ë³´í†µ">ê·¸ì € ê·¸ë¬ë‹¤</label>
                <label><input type="radio" name="pastSchool" value="ë¶ˆë§Œì¡±">ì‹«ì—ˆë‹¤</label>
            </div>
        </div>

        <div class="form-group">
            <label>í˜„ì¬ ê±´ê°• ìƒíƒœ</label>
            <div class="btn-group">
                <label><input type="radio" name="health" value="ì¢‹ìŒ">ê±´ê°•í•¨</label>
                <label><input type="radio" name="health" value="ë³´í†µ">ë³´í†µ</label>
                <label><input type="radio" name="health" value="ë‚˜ì¨">ì•„í”„ê±°ë‚˜ ì¹˜ë£Œ ì¤‘</label>
            </div>
        </div>

        <button class="btn-action" onclick="startScale()">ë‹¤ìŒ (ì²™ë„ ê²€ì‚¬ ì‹œì‘)</button>
    </div>

    <div id="section-scale" class="card hidden">
        <h2 id="scale-title">5. ì²™ë„ ê²€ì‚¬</h2>
        <p style="text-align:center; margin-bottom:20px; color:#666;">ê±°ì˜ ë‹¤ ì™”ìŠµë‹ˆë‹¤!<br>ì†”ì§í•˜ê²Œ ì²´í¬í•´ ì£¼ì„¸ìš”.</p>
        <div id="questions-area"></div>
        <button class="btn-action" onclick="nextScale()">ë‹¤ìŒ</button>
    </div>

    <div id="section-end" class="card hidden" style="text-align: center; padding: 60px 20px;">
        <h1 style="font-size:3rem; margin-bottom:20px;">ğŸ‰</h1>
        <h2 style="border:none;">ì‘ì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</h2>
        <p style="font-size:1.1rem; color:#555;">ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤.<br>ìƒë‹´ ì„ ìƒë‹˜ê»˜ íƒœë¸”ë¦¿ì„ ë“œë ¤ì£¼ì„¸ìš”.</p>
        <button class="btn-action btn-secondary" onclick="location.reload()">ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>

</div>

<div id="admin-view" class="container hidden">
    <div id="admin-login" class="card no-print">
        <h2>ğŸ”’ ê´€ë¦¬ì ì ‘ì†</h2>
        <input type="password" id="adminPw" placeholder="ë¹„ë°€ë²ˆí˜¸ (1388)">
        <button class="btn-action" onclick="loginAdmin()">í™•ì¸</button>
        <button class="btn-action btn-secondary" onclick="location.reload()">ë‚˜ê°€ê¸°</button>
    </div>

    <div id="admin-dash" class="card hidden no-print">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2>ğŸ“‹ ì°¸ì—¬ì ëª©ë¡</h2>
            <button onclick="location.reload()" style="padding:10px; background:#eee; border:none; border-radius:5px;">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
        <ul id="user-list" style="list-style:none; padding:0;"></ul>
    </div>

    <div id="report-area" class="hidden">
        <div style="text-align:center; border:2px solid #333; padding:15px; margin-bottom:20px;">
            <h1 style="margin:0; font-size:20pt; color:#000;">í•™êµ ë°– ì²­ì†Œë…„ ì´ˆê¸°ìƒë‹´ ê¸°ë¡ì§€</h1>
        </div>
        
        <div class="section-header">â… . ê¸°ë³¸ ì¸ì ì‚¬í•­</div>
        <table>
            <tr>
                <th width="15%">ì„±ëª…</th><td id="r-name"></td>
                <th width="15%">ìƒë…„ì›”ì¼</th><td id="r-birth"></td>
                <th width="15%">ì„±ë³„</th><td id="r-gender"></td>
            </tr>
            <tr>
                <th>ì£¼ë¯¼ë²ˆí˜¸</th><td colspan="3" id="r-rrn"></td>
                <th>ì‘ì„±ì¼</th><td id="r-date"></td>
            </tr>
            <tr>
                <th>ì—°ë½ì²˜(ë³¸ì¸)</th><td colspan="2" id="r-tel-self"></td>
                <th>ì—°ë½ì²˜(ë³´í˜¸ì)</th><td colspan="2" id="r-tel-parent"></td>
            </tr>
            <tr>
                <th>í˜„ ìƒíƒœ</th><td colspan="5" id="r-status"></td>
            </tr>
        </table>

        <div class="section-header">â…¡. í•™ì—… ë° ë°°ê²½ì •ë³´</div>
        <table>
            <tr>
                <th width="20%">ì¤‘ë‹¨ ì‹œê¸°</th><td id="r-drop-date"></td>
                <th width="20%">ì¤‘ë‹¨ ì´ìœ  (1ìˆœìœ„)</th><td id="r-drop-reason"></td>
            </tr>
            <tr>
                <th>ë¶€ëª¨ ë™ì˜ì—¬ë¶€</th><td><span id="r-parent-agree"></span></td>
                <th>ì„¼í„° ë‚´ë°©ê²½ë¡œ</th><td><span id="r-path"></span></td>
            </tr>
        </table>

        <div class="section-header">â…¢. ê°€ì¡± ë° ê²½ì œìƒí™©</div>
        <table>
            <tr><th>ê°€ì¡±êµ¬ì„±</th><td colspan="3" id="r-family-mem" class="text-left"></td></tr>
            <tr>
                <th width="20%">ê°€ì • í˜•íƒœ</th><td id="r-fam-type"></td>
                <th width="20%">ê²½ì œ ìˆ˜ì¤€</th><td id="r-econ"></td>
            </tr>
            <tr>
                <th>ê°€ì¡± ê´€ì‹¬ë„</th><td><span id="r-fam-interest"></span></td>
                <th>ìš©ëˆ ë§Œì¡±ë„</th><td><span id="r-money"></span></td>
            </tr>
        </table>

        <div class="section-header">â…£. í˜„ì¬ ìƒíƒœ ë° ì„œë¹„ìŠ¤ ìš•êµ¬</div>
        <table>
            <tr><th>í˜„ì¬ ì–´ë ¤ì›€</th><td colspan="3" id="r-diff" class="text-left"></td></tr>
            <tr>
                <th width="20%">ì§„ë¡œ ëª©í‘œ</th><td id="r-goal"></td>
                <th width="20%">í¬ë§ ì„œë¹„ìŠ¤</th><td id="r-service"></td>
            </tr>
            <tr>
                <th>ê±´ê°• ìƒíƒœ</th><td><span id="r-health"></span></td>
                <th>ê³¼ê±° í•™êµìƒí™œ</th><td><span id="r-school"></span></td>
            </tr>
        </table>

        <div class="section-header">â…¤. ì²™ë„ ê²€ì‚¬ ê²°ê³¼</div>
        <div style="display:flex; gap:10px;">
            <div style="flex:1;">
                <table style="margin-bottom:5px;">
                    <thead><tr><th colspan="3">ìë¦½ì—­ëŸ‰ (ì ìˆ˜ê°€ ë‚®ì„ìˆ˜ë¡ ìœ„í—˜)</th></tr></thead>
                    <thead><tr><th>ì˜ì—­</th><th>ì ìˆ˜</th><th>íŒì •</th></tr></thead>
                    <tbody id="r-jarip-body"></tbody>
                </table>
            </div>
            <div style="flex:1;">
                <table style="margin-bottom:5px;">
                    <thead><tr><th colspan="3">ì‹¬ë¦¬ì •ì„œ (ì ìˆ˜ê°€ ë†’ì„ìˆ˜ë¡ ìœ„í—˜)</th></tr></thead>
                    <thead><tr><th>ì˜ì—­</th><th>ì ìˆ˜</th><th>íŒì •</th></tr></thead>
                    <tbody id="r-simni-body"></tbody>
                </table>
            </div>
        </div>

        <div style="border:2px solid #E74C3C; padding:10px; margin-top:10px; border-radius:5px;">
            <strong style="color:#E74C3C;">ğŸš¨ ìœ„ê¸°(Red Flag) ë° ìƒë‹´ê°€ì´ë“œ</strong>
            <div id="r-guide" style="font-size:9pt; margin-top:5px;"></div>
        </div>

        <div class="no-print" style="margin-top:30px; text-align:center;">
            <button class="btn-action" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„ / PDF ì €ì¥</button>
            <button class="btn-action btn-secondary" onclick="closeReport()">ë‹«ê¸°</button>
        </div>
    </div>
</div>

<script>
    // [1] Firebase ì„¤ì • (ê¸°ì¡´ í‚¤ ìœ ì§€ ë˜ëŠ” êµì²´)
    const firebaseConfig = {
        apiKey: "AIzaSyDgPm4Ig5OLJF5zZrcMTXoIVT3dRlf37Eg",
        authDomain: "kdream-db462.firebaseapp.com",
        projectId: "kdream-db462",
        storageBucket: "kdream-db462.firebasestorage.app",
        messagingSenderId: "1020262030810",
        appId: "1:1020262030810:web:3482636bc020bb4310b4e3"
    };

    let db;
    try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
    } catch(e) { console.error(e); }

    // [2] ìƒíƒœ ê´€ë¦¬
    let formData = {};
    let answers = {};
    let currentScalePart = "jarip";
    
    // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
    function setProgress(percent) {
        document.getElementById('progressBar').style.width = percent + "%";
    }

    // [3] ì¸í…Œì´í¬ ë¡œì§
    function startSurvey() {
        document.getElementById('step-intro').classList.add('hidden');
        document.getElementById('step-forms').classList.remove('hidden');
        setProgress(10);
    }

    function nextSection(nextId) {
        // í˜„ì¬ ì„¹ì…˜ ë‹«ê³  ë‹¤ìŒ ì—´ê¸° (ê°„ë‹¨ ìœ íš¨ì„± ê²€ì‚¬ëŠ” ìƒëµí•˜ì˜€ìœ¼ë‚˜ í•„ìš”ì‹œ ì¶”ê°€ ê°€ëŠ¥)
        const currents = document.querySelectorAll('#step-forms .card:not(.hidden)');
        currents.forEach(el => el.classList.add('hidden'));
        document.getElementById(nextId).classList.remove('hidden');
        window.scrollTo(0,0);
        
        // ì§„í–‰ë°” ì—…ë°ì´íŠ¸
        if(nextId === 'section-school') setProgress(25);
        if(nextId === 'section-family') setProgress(40);
        if(nextId === 'section-needs') setProgress(55);
    }

    function startScale() {
        // ëª¨ë“  í¼ ë°ì´í„° ìˆ˜ì§‘
        collectFormData();
        
        // ë‚˜ì´ ê³„ì‚° ë° ì²™ë„ ë¡œë“œ
        const year = parseInt(formData.userBirth.split('-')[0]);
        const age = new Date().getFullYear() - year;
        formData.age = age;
        formData.type = (age >= 13) ? "YOUTH" : "CHILD";

        document.getElementById('section-needs').classList.add('hidden');
        document.getElementById('section-scale').classList.remove('hidden');
        setProgress(70);
        renderQuestions("jarip");
    }

    function collectFormData() {
        formData.name = document.getElementById('userName').value;
        formData.gender = getRadio('gender');
        formData.rrn = document.getElementById('rrn1').value + "-" + document.getElementById('rrn2').value;
        formData.telSelf = document.getElementById('telSelf').value;
        formData.telParent = document.getElementById('telParent').value;
        formData.status = getRadio('status');
        formData.userBirth = "20" + document.getElementById('rrn1').value.substring(0,2) + "-01-01"; // ê°„ëµ ìƒì¼

        formData.dropLevel = document.getElementById('dropLevel').value;
        formData.dropGrade = document.getElementById('dropGrade').value;
        formData.dropDate = document.getElementById('dropDate').value;
        formData.dropReason = document.getElementById('dropReason1').value;
        formData.parentAgree = getRadio('parentAgree');
        formData.referralPath = document.getElementById('referralPath').value;

        // ê°€ì¡±
        let fam = [];
        if(document.getElementById('famName1').value) fam.push(`${document.getElementById('famRel1').value}/${document.getElementById('famName1').value}(${document.getElementById('famLive1').value})`);
        if(document.getElementById('famName2').value) fam.push(`${document.getElementById('famRel2').value}/${document.getElementById('famName2').value}(${document.getElementById('famLive2').value})`);
        formData.familyMembers = fam.join(", ");
        formData.familyType = getRadio('familyType');
        formData.econStatus = getRadio('econStatus');
        formData.moneySat = getRadio('moneySat');
        formData.famInterest = getRadio('famInterest');

        // ìš•êµ¬
        let diffs = [];
        document.querySelectorAll('input[name="difficulties"]:checked').forEach(el => diffs.push(el.value));
        formData.difficulties = diffs.join(", ");
        formData.goal = document.getElementById('goal').value;
        formData.serviceWant = document.getElementById('serviceWant').value;
        formData.pastSchool = getRadio('pastSchool');
        formData.health = getRadio('health');
        formData.date = new Date().toLocaleDateString();
    }

    function getRadio(name) {
        const el = document.querySelector(`input[name="${name}"]:checked`);
        return el ? el.value : "";
    }

    // [4] ì²™ë„ ë°ì´í„° (13-24ì„¸ ê¸°ì¤€ ì˜ˆì‹œ, ì „ì²´ëŠ” ì´ì „ ì½”ë“œ ì°¸ì¡°)
    const DB_QUESTIONS = {
        YOUTH: {
            jarip: [
                {n:1, t:"ë‚˜ëŠ” ê°€ì¹˜ìˆëŠ” ì‚¬ëŒì´ë‹¤", d:"ìì¡´ê°"},
                {n:2, t:"ë‚˜ëŠ” ë‚´ê°€ ë¬´ì—‡ì„ ì•Œê³  ëª¨ë¥´ëŠ”ì§€ ì •í™•íˆ ì•ˆë‹¤", d:"í•™ì—…íš¨ëŠ¥ê°"},
                {n:7, t:"ë§¡ê²¨ì§„ ì¼ì€ ëê¹Œì§€ í•˜ë ¤ê³  ë…¸ë ¥í•œë‹¤", d:"ì„±ì‹¤ì„±"},
                {n:24, t:"ë‚˜ëŠ” ì›í•˜ëŠ” ê²ƒì„ ê²°êµ­ ì´ë£¨ì–´ë‚¼ ì‚¬ëŒì´ë‹¤", d:"ìì¡´ê°"}
            ],
            simni: [
                {n:1, t:"ì§€ë‚œ 1ë‹¬ê°„ ìŠ¬í”„ê±°ë‚˜ ìš°ìš¸í•  ë•Œê°€ ìì£¼ ìˆë‹¤", d:"ìš°ìš¸Â·ë¶ˆì•ˆ"},
                {n:48, t:"ì§€ë‚œ 3ê°œì›”ê°„ ìì‚´ì„ ìƒê°í•´ ë³¸ ì  ìˆë‹¤", d:"ìì‚´", crit:true},
                {n:15, t:"ë‚´ê²ŒëŠ” ì†ë§ˆìŒì„ í„°ë†“ì„ ì¹œêµ¬ê°€ ìˆë‹¤", d:"ë˜ë˜í™˜ê²½", rev:true},
                {n:45, t:"ìŠ¤ë§ˆíŠ¸í° ê³¼ë‹¤ì‚¬ìš©ìœ¼ë¡œ ê°ˆë“±ì„ ê²ªê³  ìˆë‹¤", d:"ì¤‘ë…", crit:true}
            ]
        },
        CHILD: {
            jarip: [{n:1, t:"ë‚˜ëŠ” ì¢‹ì€ ì ì´ ë§ì€ ì‚¬ëŒì´ë‹¤", d:"ìì¡´ê°"}],
            simni: [{n:1, t:"ìë„ ìë„ í”¼ê³¤í•˜ë‹¤", d:"ìš°ìš¸Â·ë¶ˆì•ˆ"}]
        }
    };

    function renderQuestions(part) {
        currentScalePart = part;
        const list = DB_QUESTIONS[formData.type][part];
        const area = document.getElementById('questions-area');
        const title = document.getElementById('scale-title');
        
        title.innerText = (part === "jarip") ? "5-1. ìë¦½ì—­ëŸ‰ ì²™ë„" : "5-2. ì‹¬ë¦¬ì •ì„œ ì²™ë„";
        area.innerHTML = "";
        window.scrollTo(0,0);

        list.forEach((q, idx) => {
            const div = document.createElement('div');
            div.className = "q-card";
            div.innerHTML = `
                <div class="q-text">${idx+1}. ${q.t}</div>
                <div class="btn-group">
                    <label><input type="radio" name="${part}_${q.n}" value="1" onchange="saveAns('${part}', ${q.n}, 1, ${q.rev}, ${q.crit}, '${q.d}', '${q.t}')">ì „í˜€ì•„ë‹˜</label>
                    <label><input type="radio" name="${part}_${q.n}" value="2" onchange="saveAns('${part}', ${q.n}, 2, ${q.rev}, ${q.crit}, '${q.d}', '${q.t}')">ì•„ë‹ˆë‹¤</label>
                    <label><input type="radio" name="${part}_${q.n}" value="3" onchange="saveAns('${part}', ${q.n}, 3, ${q.rev}, ${q.crit}, '${q.d}', '${q.t}')">ë³´í†µ</label>
                    <label><input type="radio" name="${part}_${q.n}" value="4" onchange="saveAns('${part}', ${q.n}, 4, ${q.rev}, ${q.crit}, '${q.d}', '${q.t}')">ê·¸ë ‡ë‹¤</label>
                    <label><input type="radio" name="${part}_${q.n}" value="5" onchange="saveAns('${part}', ${q.n}, 5, ${q.rev}, ${q.crit}, '${q.d}', '${q.t}')">ë§¤ìš°ê·¸ë ‡ë‹¤</label>
                </div>
            `;
            area.appendChild(div);
        });
    }

    function saveAns(part, no, val, rev, crit, domain, text) {
        answers[`${part}_${no}`] = { val, rev, crit, domain, text };
    }

    function nextScale() {
        if(currentScalePart === "jarip") {
            setProgress(85);
            renderQuestions("simni");
        } else {
            saveToFirebase();
        }
    }

    function saveToFirebase() {
        const payload = {
            info: formData,
            ans: answers,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        };

        db.collection("intake_full").add(payload)
        .then(() => {
            setProgress(100);
            document.getElementById('section-scale').classList.add('hidden');
            document.getElementById('section-end').classList.remove('hidden');
            window.scrollTo(0,0);
        })
        .catch(err => alert("ì €ì¥ ì‹¤íŒ¨: " + err));
    }

    // [5] ê´€ë¦¬ì ëª¨ë“œ
    function showAdmin() {
        document.getElementById('step-intro').classList.add('hidden');
        document.getElementById('admin-view').classList.remove('hidden');
    }

    function loginAdmin() {
        if(document.getElementById('adminPw').value === "1388") {
            document.getElementById('admin-login').classList.add('hidden');
            document.getElementById('admin-dash').classList.remove('hidden');
            loadList();
        } else alert("ë¹„ë²ˆ ì˜¤ë¥˜");
    }

    function loadList() {
        const list = document.getElementById('user-list');
        list.innerHTML = "ë¡œë”©ì¤‘...";
        db.collection("intake_full").orderBy("timestamp", "desc").limit(20).get()
        .then((snapshot) => {
            list.innerHTML = "";
            snapshot.forEach(doc => {
                const d = doc.data();
                const li = document.createElement('li');
                li.innerHTML = `<div class="card" style="padding:15px; display:flex; justify-content:space-between;">
                    <b>${d.info.name}</b> <button onclick='viewReport(${JSON.stringify(d)})'>ë³´ê¸°</button></div>`;
                list.appendChild(li);
            });
        });
    }

    function viewReport(data) {
        document.getElementById('admin-dash').classList.add('hidden');
        document.getElementById('report-area').classList.remove('hidden');

        // ê¸°ë³¸ ì •ë³´ ë§¤í•‘
        const i = data.info;
        document.getElementById('r-name').innerText = i.name;
        document.getElementById('r-gender').innerText = i.gender;
        document.getElementById('r-birth').innerText = i.userBirth; // ì‹¤ì œ êµ¬í˜„ì‹œ ìƒë…„ì›”ì¼ í¬ë§·íŒ…
        document.getElementById('r-rrn').innerText = i.rrn;
        document.getElementById('r-tel-self').innerText = i.telSelf;
        document.getElementById('r-tel-parent').innerText = i.telParent;
        document.getElementById('r-status').innerText = i.status;
        document.getElementById('r-date').innerText = i.date;

        // í•™ì—…
        document.getElementById('r-drop-date').innerText = i.dropDate + ` (${i.dropLevel}${i.dropGrade})`;
        document.getElementById('r-drop-reason').innerText = i.dropReason;
        document.getElementById('r-parent-agree').innerText = i.parentAgree;
        document.getElementById('r-path').innerText = i.referralPath;

        // ê°€ì¡±
        document.getElementById('r-family-mem').innerText = i.familyMembers;
        document.getElementById('r-fam-type').innerText = i.familyType;
        document.getElementById('r-econ').innerText = i.econStatus;
        document.getElementById('r-fam-interest').innerText = i.famInterest;
        document.getElementById('r-money').innerText = i.moneySat;

        // ìš•êµ¬
        document.getElementById('r-diff').innerText = i.difficulties;
        document.getElementById('r-goal').innerText = i.goal;
        document.getElementById('r-service').innerText = i.serviceWant;
        document.getElementById('r-health').innerText = i.health;
        document.getElementById('r-school').innerText = i.pastSchool;

        // ì²™ë„ ê³„ì‚°
        let jScore={}, sScore={}, redFlags=[];
        
        Object.keys(data.ans).forEach(k => {
            const item = data.ans[k];
            let val = item.val;
            if(item.rev) val = 6 - val;
            
            if(k.startsWith('jarip')) {
                if(!jScore[item.domain]) jScore[item.domain] = 0;
                jScore[item.domain] += val;
            } else {
                if(!sScore[item.domain]) sScore[item.domain] = 0;
                sScore[item.domain] += val;
                if(item.crit && item.val >= 3) redFlags.push(item.domain + ": " + item.text);
            }
        });

        // ê²°ê³¼ ë Œë”ë§ (ê°„ëµí™”)
        let jHtml = "";
        for(let k in jScore) jHtml += `<tr><td>${k}</td><td>${jScore[k]}</td><td>${jScore[k]<=10?'ìœ„í—˜':'ì–‘í˜¸'}</td></tr>`;
        document.getElementById('r-jarip-body').innerHTML = jHtml;

        let sHtml = "";
        for(let k in sScore) sHtml += `<tr><td>${k}</td><td>${sScore[k]}</td><td>${sScore[k]>=10?'ìœ„í—˜':'ì–‘í˜¸'}</td></tr>`;
        document.getElementById('r-simni-body').innerHTML = sHtml;

        document.getElementById('r-guide').innerHTML = redFlags.length > 0 ? redFlags.join("<br>") : "íŠ¹ì´ì‚¬í•­ ì—†ìŒ";
    }

    function closeReport() {
        document.getElementById('report-area').classList.add('hidden');
        document.getElementById('admin-dash').classList.remove('hidden');
    }
</script>
</body>
</html>

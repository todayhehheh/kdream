<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ê¿ˆë“œë¦¼ í†µí•© ì¸í…Œì´í¬ (kdream)</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --primary: #4A90E2; --bg: #F4F7F6; --card: #FFFFFF; --text: #333; --danger: #E74C3C; }
        
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; line-height: 1.5; -webkit-tap-highlight-color: transparent; }
        .container { max-width: 900px; margin: 0 auto; }
        .card { background: var(--card); border-radius: 16px; padding: 30px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        
        h1, h2 { text-align: center; color: #2C3E50; }
        .input-group { margin-bottom: 20px; }
        label { display: block; font-weight: bold; margin-bottom: 8px; font-size: 1.1em; }
        input, select { width: 100%; padding: 14px; border: 2px solid #ddd; border-radius: 10px; font-size: 1rem; box-sizing: border-box; }
        input:focus, select:focus { border-color: var(--primary); outline: none; }

        .q-card { background: #fff; border: 1px solid #eee; border-radius: 12px; padding: 20px; margin-bottom: 15px; }
        .q-text { font-size: 1.2em; font-weight: bold; margin-bottom: 15px; word-break: keep-all; }
        
        .options { display: flex; gap: 5px; }
        .options label { 
            flex: 1; text-align: center; padding: 15px 5px; border: 2px solid #eee; border-radius: 10px; cursor: pointer; 
            font-size: 0.95em; display: flex; flex-direction: column; justify-content: center; transition: 0.2s; background: #fff;
        }
        .options input { display: none; }
        .options label:has(input:checked) { background: #EBF5FB; border-color: var(--primary); color: var(--primary); font-weight: bold; }

        .btn { width: 100%; padding: 18px; background: var(--primary); color: white; border: none; border-radius: 10px; font-size: 1.2em; font-weight: bold; cursor: pointer; margin-top: 20px; }
        .btn.secondary { background: #95A5A6; }
        
        .hidden { display: none !important; }
        .danger-text { color: var(--danger); font-weight: bold; }

        @media print {
            body { background: white; padding: 0; font-size: 11pt; }
            .no-print, .btn, .input-group, #youth-view, #admin-login { display: none !important; }
            #report-area { display: block !important; }
            .card { box-shadow: none; border: none; padding: 0; }
            table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 10pt; }
            th, td { border: 1px solid #000; padding: 5px 8px; text-align: center; }
            th { background-color: #f0f0f0; font-weight: bold; }
            .section-header { font-size: 13pt; font-weight: bold; border-bottom: 2px solid #000; margin: 20px 0 10px 0; padding-bottom: 5px; }
            .page-break { page-break-before: always; }
        }
    </style>
</head>
<body>

<div id="youth-view" class="container">
    <div id="step-login" class="card">
        <h1>ğŸŒ± ê¿ˆë“œë¦¼ í†µí•© ì§„ë‹¨</h1>
        <p style="text-align:center; color:#666;">í™˜ì˜í•©ë‹ˆë‹¤. (ì‹œìŠ¤í…œ: kdream)</p>
        <div class="input-group">
            <label>ì´ë¦„</label>
            <input type="text" id="userName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
        </div>
        <div class="input-group">
            <label>ìƒë…„ì›”ì¼</label>
            <input type="date" id="userBirth">
        </div>
        <button class="btn" onclick="startProcess()">ì‹œì‘í•˜ê¸°</button>
        <p style="text-align:center; margin-top:30px; font-size:0.9em; color:#999; cursor:pointer;" onclick="showAdmin()">ğŸ”’ ê´€ë¦¬ì ëª¨ë“œ</p>
    </div>

    <div id="step-survey" class="card hidden">
        <h2>ğŸ“‹ 1. ê¸°ì´ˆ ì •ë³´ ë° í¬ë§ ì„œë¹„ìŠ¤</h2>
        <div class="input-group">
            <label>1. í•™êµë¥¼ ê·¸ë§Œë‘”(ì¤‘ë‹¨í•œ) ì£¼ëœ ì´ìœ ëŠ”? (ê°€ì¥ í° ì´ìœ )</label>
            <select id="dropReason">
                <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                <option value="ì‹¬ë¦¬">ì‹¬ë¦¬Â·ì •ì„œì  ë¬¸ì œ (ìš°ìš¸, ë¶ˆì•ˆ ë“±)</option>
                <option value="í•™ì—…">ì›í•˜ëŠ” ê³µë¶€ë¥¼ í•˜ê¸° ìœ„í•´ (ê²€ì •ê³ ì‹œ, ëŒ€ì•ˆí•™êµ)</option>
                <option value="í•™êµë¶€ì ì‘">í•™êµ ì¹œêµ¬/ì„ ìƒë‹˜ê³¼ì˜ ê´€ê³„ ì–´ë ¤ì›€</option>
                <option value="íŠ¹ê¸°">íŠ¹ê¸°/ì†Œì§ˆì„ ì‚´ë¦¬ê¸° ìœ„í•´</option>
                <option value="ê²½ì œ">ê²½ì œì  ì‚¬ì • ë•Œë¬¸ì—</option>
                <option value="ê¸°íƒ€">ê¸°íƒ€</option>
            </select>
        </div>
        <div class="input-group">
            <label>2. í˜„ì¬ ê²ªê³  ìˆëŠ” ê°€ì¥ í° ì–´ë ¤ì›€ì€? (ì¤‘ë³µ ê°€ëŠ¥)</label>
            <div style="display:flex; flex-wrap:wrap; gap:10px;">
                <label style="font-weight:normal;"><input type="checkbox" class="difficulty" value="ì§„ë¡œ"> ì§„ë¡œ ê²°ì •/ì¤€ë¹„</label>
                <label style="font-weight:normal;"><input type="checkbox" class="difficulty" value="ê°€ì¡±"> ê°€ì¡± ê°ˆë“±</label>
                <label style="font-weight:normal;"><input type="checkbox" class="difficulty" value="ì¹œêµ¬"> ì¹œêµ¬ ê´€ê³„</label>
                <label style="font-weight:normal;"><input type="checkbox" class="difficulty" value="ì‹¬ë¦¬"> ìš°ìš¸/ë¬´ê¸°ë ¥</label>
                <label style="font-weight:normal;"><input type="checkbox" class="difficulty" value="ìŠ¤ë§ˆíŠ¸í°"> ìŠ¤ë§ˆíŠ¸í°/ê²Œì„</label>
                <label style="font-weight:normal;"><input type="checkbox" class="difficulty" value="í•™ì—…"> ê³µë¶€ì˜ ì–´ë ¤ì›€</label>
                <label style="font-weight:normal;"><input type="checkbox" class="difficulty" value="ê²½ì œ"> ê²½ì œì  ì–´ë ¤ì›€</label>
            </div>
        </div>
        <div class="input-group">
            <label>3. ì„¼í„°ì—ì„œ ê°€ì¥ ë°›ê³  ì‹¶ì€ ì„œë¹„ìŠ¤ëŠ”? (1ìˆœìœ„)</label>
            <select id="want1">
                <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                <option value="ìƒë‹´">ìƒë‹´ì§€ì› (ì‹¬ë¦¬, ì§„ë¡œ, ê°€ì¡±ìƒë‹´)</option>
                <option value="êµìœ¡">êµìœ¡ì§€ì› (ê²€ì •ê³ ì‹œ, ìˆ˜ëŠ¥, ë³µí•™)</option>
                <option value="ìë¦½">ìë¦½ì§€ì› (ìê²©ì¦, ì¸í„´ì‹­, ê¸°ìˆ í›ˆë ¨)</option>
                <option value="í™œë™">í™œë™ì§€ì› (ë™ì•„ë¦¬, ìº í”„, ë¬¸í™”ì²´í—˜)</option>
                <option value="ìƒí™œ">ìƒí™œì§€ì› (ê¸‰ì‹, ê±´ê°•ê²€ì§„, êµí†µë¹„)</option>
            </select>
        </div>
        <button class="btn" onclick="goScale()">ë‹¤ìŒ (ì²™ë„ ê²€ì‚¬)</button>
    </div>

    <div id="step-scale" class="card hidden">
        <h2 id="scale-title">ì²™ë„ ê²€ì‚¬</h2>
        <p style="text-align:center; color:#4A90E2; font-weight:bold;">ì†”ì§í•˜ê²Œ ì²´í¬í•´ ì£¼ì„¸ìš”.</p>
        <div id="questions-area"></div>
        <button class="btn" onclick="submitNext()">ë‹¤ìŒ / ì œì¶œ</button>
    </div>

    <div id="step-end" class="card hidden" style="text-align:center; padding:50px 20px;">
        <h1 style="font-size:3em;">âœ…</h1>
        <h2>ê²€ì‚¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</h2>
        <p>íƒœë¸”ë¦¿ì„ ìƒë‹´ ì„ ìƒë‹˜ê»˜ ì „ë‹¬í•´ ì£¼ì„¸ìš”.</p>
        <button class="btn secondary" onclick="location.reload()">ì²˜ìŒ í™”ë©´ìœ¼ë¡œ</button>
    </div>
</div>

<div id="admin-view" class="container hidden">
    <div id="admin-login" class="card no-print">
        <h2>ğŸ”’ ê´€ë¦¬ì ì ‘ì†</h2>
        <input type="password" id="adminPw" placeholder="ë¹„ë°€ë²ˆí˜¸ (1388)">
        <button class="btn" onclick="loginAdmin()">í™•ì¸</button>
        <button class="btn secondary" onclick="location.reload()">ëŒì•„ê°€ê¸°</button>
    </div>

    <div id="admin-dash" class="card hidden no-print">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2>ğŸ“‹ ì°¸ì—¬ì ëª©ë¡</h2>
            <button onclick="location.reload()" style="padding:10px; background:#ddd; border:none; border-radius:5px; cursor:pointer;">ë¡œê·¸ì•„ì›ƒ</button>
        </div>
        <ul id="user-list" style="list-style:none; padding:0;"></ul>
    </div>

    <div id="report-area" class="hidden">
        <div style="border:2px solid #000; padding:15px; text-align:center; margin-bottom:20px;">
            <h1 style="margin:0;">í•™êµ ë°– ì²­ì†Œë…„ í†µí•© ì§„ë‹¨ ê²°ê³¼ë³´ê³ ì„œ</h1>
            <p style="margin:5px 0;">ì„±ëª…: <span id="r-name"></span> | ìƒë…„ì›”ì¼: <span id="r-birth"></span> | ê²€ì‚¬ì¼: <span id="r-date"></span></p>
        </div>
        <div class="section-header">â… . í¬ë§ ì„œë¹„ìŠ¤ ë° ê¸°ì´ˆ ì¡°ì‚¬</div>
        <table>
            <tr><th width="20%">í•™ì—…ì¤‘ë‹¨ ì‚¬ìœ </th><td id="r-reason"></td><th width="20%">ì£¼ìš” í˜¸ì†Œ ë¬¸ì œ</th><td id="r-diff"></td></tr>
            <tr><th>1ìˆœìœ„ í¬ë§ì„œë¹„ìŠ¤</th><td colspan="3" id="r-want"></td></tr>
        </table>
        <div class="section-header">â…¡. ìë¦½ì—­ëŸ‰ ì²™ë„ ê²°ê³¼ (ì ìˆ˜ê°€ ë‚®ì„ìˆ˜ë¡ ìœ„í—˜)</div>
        <table>
            <thead><tr><th>ì˜ì—­</th><th>ë‚˜ì˜ ì ìˆ˜</th><th>ê¸°ì¤€(ì ˆë‹¨) ì ìˆ˜</th><th>íŒì •</th></tr></thead>
            <tbody id="r-jarip-body"></tbody>
        </table>
        <div class="section-header">â…¢. ì‹¬ë¦¬ì •ì„œÂ·í™˜ê²½ ì²™ë„ ê²°ê³¼ (ì ìˆ˜ê°€ ë†’ì„ìˆ˜ë¡ ìœ„í—˜)</div>
        <table>
            <thead><tr><th>ì˜ì—­</th><th>ë‚˜ì˜ ì ìˆ˜</th><th>ê¸°ì¤€(ì ˆë‹¨) ì ìˆ˜</th><th>íŒì •</th></tr></thead>
            <tbody id="r-simni-body"></tbody>
        </table>
        <div class="section-header" style="color:#E74C3C; border-color:#E74C3C;">ğŸš¨ ìœ„ê¸°(Red Flag) ë° ì¶”ê°€ íƒìƒ‰ ê°€ì´ë“œ</div>
        <div id="r-guide" style="border:1px solid #E74C3C; padding:15px; font-size:10pt;"></div>
        <div class="page-break"></div>
        <div class="section-header">[ë³„ì²¨] ë¬¸í•­ë³„ ì‘ë‹µ ìƒì„¸ ë°ì´í„°</div>
        <div id="r-raw-data" style="font-size:9pt; column-count: 2; line-height:1.4;"></div>
        <div class="no-print" style="margin-top:30px; text-align:center;">
            <button class="btn" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„ / PDF ì €ì¥</button>
            <button class="btn secondary" onclick="closeReport()">ëª©ë¡ìœ¼ë¡œ</button>
        </div>
    </div>
</div>

<script>
    // [1] Firebase ì„¤ì • (ì‚¬ìš©ìë‹˜ì´ ì œê³µí•´ì£¼ì‹  í‚¤ ì ìš©ë¨)
    const firebaseConfig = {
        apiKey: "AIzaSyDgPm4Ig5OLJF5zZrcMTXoIVT3dRlf37Eg",
        authDomain: "kdream-db462.firebaseapp.com",
        projectId: "kdream-db462",
        storageBucket: "kdream-db462.firebasestorage.app",
        messagingSenderId: "1020262030810",
        appId: "1:1020262030810:web:3482636bc020bb4310b4e3"
    };

    // Firebase ì´ˆê¸°í™”
    let db;
    try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
        console.log("Firebase Connected");
    } catch(e) {
        console.error("Firebase Error:", e);
        alert("ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨. ì¸í„°ë„· ì—°ê²° ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");
    }

    // [2] ì „ì²´ ë¬¸í•­ ë°ì´í„° (126ë¬¸í•­)
    const DB_QUESTIONS = {
        YOUTH: {
            jarip: [
                {n:1, t:"ë‚˜ëŠ” ê°€ì¹˜ìˆëŠ” ì‚¬ëŒì´ë‹¤", d:"ìì¡´ê°"},
                {n:2, t:"ë‚˜ëŠ” ë‚´ê°€ ë¬´ì—‡ì„ ì•Œê³  ëª¨ë¥´ëŠ”ì§€ ì •í™•íˆ ì•ˆë‹¤", d:"í•™ì—…íš¨ëŠ¥ê°"},
                {n:3, t:"í•„ìš”í•  ë•Œ ë‚¨ì—ê²Œ ë„ì›€ì„ ìš”ì²­í•  ìˆ˜ ìˆë‹¤", d:"ì‚¬íšŒì ìœ ëŠ¥ê°"},
                {n:4, t:"ë‹¤ë¥¸ ì‚¬ëŒê³¼ ê°ˆë“±ì´ ìˆì„ ë•Œ í•´ê²°í•  ë°©ë²•ì„ ì•ˆë‹¤", d:"ì‚¬íšŒì ìœ ëŠ¥ê°"},
                {n:5, t:"ëŒ€ì¸ê´€ê³„ë¥¼ ë§ºëŠ” ë° ì–´ë ¤ì›€ì´ ì—†ë‹¤", d:"ì‚¬íšŒì ìœ ëŠ¥ê°"},
                {n:6, t:"ë‚´ ê¿ˆì„ ì´ë£¨ê¸° ìœ„í•œ ê³„íšì´ ìˆë‹¤", d:"ì§„ë¡œì •ë³´íƒìƒ‰"},
                {n:7, t:"ë§¡ê²¨ì§„ ì¼ì€ ëê¹Œì§€ í•˜ë ¤ê³  ë…¸ë ¥í•œë‹¤", d:"ì„±ì‹¤ì„±"},
                {n:8, t:"ì§„í•™/ì·¨ì—…ì— í•„ìš”í•œ ë¹„ìš©ì„ ì•Œê³  ìˆë‹¤", d:"ì§„ë¡œì •ë³´íƒìƒ‰"},
                {n:9, t:"ë‚˜ì˜ ì ì„±, í¥ë¯¸, ê°€ì¹˜ê´€ ë“±ì„ ì•Œê³  ìˆë‹¤", d:"ì§„ë¡œì •ë³´íƒìƒ‰"},
                {n:10, t:"ê´€ì‹¬ ìˆëŠ” ì§ì—…/í•™êµ ì •ë³´ë¥¼ ì°¾ì•„ ì ê²€í•œë‹¤", d:"ì§„ë¡œì •ë³´íƒìƒ‰"},
                {n:11, t:"ì¼ì„ í•  ë•Œ ê¾¸ì¤€íˆ í•˜ëŠ” í¸ì´ë‹¤", d:"ì„±ì‹¤ì„±"},
                {n:12, t:"ë‚˜ëŠ” ì¢‹ì€ ì¸ì„±ì„ ê°€ì¡Œë‹¤", d:"ìì¡´ê°"},
                {n:13, t:"ë‚´ê°€ ì„¸ìš´ í•™ìŠµê³„íšì„ ì‹¤ì²œí•œë‹¤", d:"í•™ì—…íš¨ëŠ¥ê°"},
                {n:14, t:"ë‚˜ì— ëŒ€í•œ ì¶©ê³ ë¥¼ ê¸°êº¼ì´ ë“¤ì„ ìˆ˜ ìˆë‹¤", d:"ì‚¬íšŒì ìœ ëŠ¥ê°"},
                {n:15, t:"ë¬´ì—‡ì„ í•˜ë“ ì§€ ë¯¸ë¦¬ ê³„íšì„ ì„¸ì›Œ ì‹¤í–‰í•œë‹¤", d:"ì„±ì‹¤ì„±"},
                {n:16, t:"ë‚˜ëŠ” ë‚´ ì™¸ëª¨ì— ë§Œì¡±í•œë‹¤", d:"ìì¡´ê°"},
                {n:17, t:"íš¨ê³¼ì ì¸ í•™ìŠµ ë°©ë²•ì„ ì•Œê³  ìˆë‹¤", d:"í•™ì—…íš¨ëŠ¥ê°"},
                {n:18, t:"ì›í•˜ëŠ” ì§ì—…/í•™êµì— í•„ìš”í•œ í•™ë ¥/ìê²©ì„ ì•ˆë‹¤", d:"ì§„ë¡œì •ë³´íƒìƒ‰"},
                {n:19, t:"ê²€ì •ê³ ì‹œ í•©ê²©ì„ ìœ„í•´ ëê¹Œì§€ ë…¸ë ¥í•  ìì‹ ì´ ìˆë‹¤", d:"í•™ì—…íš¨ëŠ¥ê°"},
                {n:20, t:"ë³µì¡í•˜ê³  ì–´ë ¤ìš´ ë¬¸ì œë¼ë„ ë„ì „í•´ì„œ í•´ê²°í•  ìˆ˜ ìˆë‹¤", d:"í•™ì—…íš¨ëŠ¥ê°"},
                {n:21, t:"ë‚˜ëŠ” ì†Œì¤‘í•œ ì‚¬ëŒì´ë‹¤", d:"ìì¡´ê°"},
                {n:22, t:"ì§€ì¼œì•¼ í•  ì‚¬íšŒì  ê·œì¹™ì´ë‚˜ ì§ˆì„œë¥¼ ì˜ ë”°ë¥¸ë‹¤", d:"ì„±ì‹¤ì„±"},
                {n:23, t:"ë„ì›€ì´ í•„ìš”í•  ë•Œ ë‚˜ë¥¼ ë„ì™€ì¤„ ì‚¬ëŒì„ ì•Œê³  ìˆë‹¤", d:"ì‚¬íšŒì ìœ ëŠ¥ê°"},
                {n:24, t:"ë‚˜ëŠ” ì›í•˜ëŠ” ê²ƒì„ ê²°êµ­ ì´ë£¨ì–´ë‚¼ ì‚¬ëŒì´ë‹¤", d:"ìì¡´ê°"},
                {n:25, t:"ì‹¤ì²œ ê°€ëŠ¥í•œ í˜„ì‹¤ì ì¸ í•™ìŠµê³„íšì„ ì„¸ìš´ë‹¤", d:"í•™ì—…íš¨ëŠ¥ê°"},
                {n:26, t:"ë‚´ ìƒê°/ê°ì •ì„ íƒ€ì¸ì—ê²Œ ëª…í™•íˆ í‘œí˜„í•œë‹¤", d:"ì‚¬íšŒì ìœ ëŠ¥ê°"},
                {n:27, t:"ë‚˜ëŠ” ëŠ¥ë ¥ìˆëŠ” ì‚¬ëŒì´ë‹¤", d:"ìì¡´ê°"},
                {n:28, t:"íƒ€ì¸ì˜ ìš”ì²­ì„ ê¸°ë¶„ ìƒí•˜ì§€ ì•Šê²Œ ê±°ì ˆí•  ìˆ˜ ìˆë‹¤", d:"ì‚¬íšŒì ìœ ëŠ¥ê°"},
                {n:29, t:"ì‹œì‘í•œ ì¼ì€ ê²°ê³¼ë¥¼ ì–»ì„ ë•Œê¹Œì§€ ì§€ì†í•œë‹¤", d:"ì„±ì‹¤ì„±"},
                {n:30, t:"ì¼í•  ë•Œ íƒ€ì¸ê³¼ í˜‘ë ¥ê´€ê³„ë¥¼ ì‰½ê²Œ ë§ºëŠ”ë‹¤", d:"ìì¡´ê°"},
                {n:31, t:"ì›í•˜ëŠ” ë¯¸ë˜ ì‚¶ì˜ ëª¨ìŠµì„ êµ¬ì²´ì ìœ¼ë¡œ ìƒê°í•´ë³¸ ì  ìˆë‹¤", d:"ì§„ë¡œì •ë³´íƒìƒ‰"}
            ],
            simni: [
                {n:1, t:"ì§€ë‚œ 1ë‹¬ê°„ ìŠ¬í”„ê±°ë‚˜ ìš°ìš¸í•  ë•Œê°€ ìì£¼ ìˆë‹¤", d:"ìš°ìš¸Â·ë¶ˆì•ˆ"},
                {n:2, t:"ì‹œì‘í•œ ì¼ì„ ëë‚´ì§€ ëª»í•  ë•Œê°€ ë§ë‹¤", d:"ê³¼ì‰í–‰ë™"},
                {n:3, t:"ì›í•˜ì§€ ì•ŠëŠ” ìƒê°/í–‰ë™ì„ ë°˜ë³µí•˜ê²Œ ë˜ì–´ í˜ë“¤ë‹¤", d:"ìš°ìš¸Â·ë¶ˆì•ˆ"},
                {n:4, t:"ìš°ë¦¬ ë™ë„¤ì—ëŠ” ë„ì›€ë°›ì„ ìˆ˜ ìˆëŠ” ê³³ì´ ìˆë‹¤", d:"ë³´í˜¸ìš”ì¸", rev:true},
                {n:5, t:"ì˜ ë‹¤ì¹˜ê±°ë‚˜ ì‚¬ê³ ë¥¼ ìì£¼ ë‹¹í•œë‹¤", d:"ê³¼ì‰í–‰ë™"},
                {n:6, t:"ì§‘ ì£¼ë³€ì— ìˆ  ì·¨í•œ ì‚¬ëŒ/ì‹¸ì›€ì„ ìì£¼ ë³¸ë‹¤", d:"ì§€ì—­ì‚¬íšŒ"},
                {n:7, t:"ë‹¤ë¥¸ ì‚¬ëŒì˜ ëˆì´ë‚˜ ë¬¼ê±´ì„ í›”ì¹œ ì  ìˆë‹¤", d:"ë°˜í•­Â·í’ˆí–‰", crit:true},
                {n:8, t:"ì–´ë–¤ ì¼ì— ì§‘ì¤‘í•˜ê±°ë‚˜ ì£¼ì˜ ê¸°ìš¸ì´ê¸° ì–´ë µë‹¤", d:"ê³¼ì‰í–‰ë™"},
                {n:9, t:"ì•½í•œ ì‚¬ëŒ/ë™ë¬¼ì„ ê´´ë¡­íŒ ì  ìˆë‹¤", d:"ë°˜í•­Â·í’ˆí–‰", crit:true},
                {n:10, t:"ë¶€ëª¨ë‹˜ì€ ë‚˜ë¥¼ ë„ˆë¬´ ì‹¬í•˜ê²Œ í†µì œí•œë‹¤", d:"ê°€ì •í™˜ê²½", crit:true},
                {n:11, t:"ë™ë„¤ì—ì„œ ì²­ì†Œë…„ë“¤ì´ ìˆ /ë‹´ë°°ë¥¼ ì‰½ê²Œ ì‚°ë‹¤", d:"ì§€ì—­ì‚¬íšŒ"},
                {n:12, t:"ìƒê° ì—†ì´ ë§í•˜ê±°ë‚˜ í–‰ë™í•´ì„œ í›„íšŒí•œë‹¤", d:"ê³¼ì‰í–‰ë™"},
                {n:13, t:"ë¶€ëª¨ë‹˜ì€ ë‚´ê°€ ê³¤ë€í•´ë„ ì‹ ê²½ ì“°ì§€ ì•ŠëŠ”ë‹¤", d:"ê°€ì •í™˜ê²½", crit:true},
                {n:14, t:"íƒ€ì¸ì„ ê³µê²©í•´ ì‹ ì²´ì— í•´ë¥¼ ì…íŒ ì  ìˆë‹¤", d:"ë°˜í•­Â·í’ˆí–‰", crit:true},
                {n:15, t:"ë‚´ê²ŒëŠ” ì†ë§ˆìŒì„ í„°ë†“ì„ ì¹œêµ¬ê°€ ìˆë‹¤", d:"ë˜ë˜í™˜ê²½", rev:true},
                {n:16, t:"ë‚¨ë“¤ì´ ë“£ì§€ ëª»í•˜ëŠ” ì†Œë¦¬(í™˜ì²­)ë¥¼ ë“£ëŠ”ë‹¤", d:"ë§ìƒ", crit:true},
                {n:17, t:"ëˆ„êµ°ê°€ ë‚´ ìƒê°ì„ ì¡°ì¢…í•˜ê³  ìˆëŠ” ê²ƒ ê°™ë‹¤", d:"ë§ìƒ", crit:true},
                {n:18, t:"ì•ˆ ì¢‹ì€ ì¼ì´ ì¼ì–´ë‚  ê²ƒë§Œ ê°™ì•„ ë‘ë µë‹¤", d:"ìš°ìš¸Â·ë¶ˆì•ˆ"},
                {n:19, t:"ìš°ë¦¬ ë™ë„¤ì—ì„œëŠ” ë²”ì£„ê°€ ìì£¼ ë°œìƒí•œë‹¤", d:"ì§€ì—­ì‚¬íšŒ"},
                {n:20, t:"ì¬ë¯¸ìˆê±°ë‚˜ í¥ë¯¸ë¥¼ ëŠë‚„ ë§Œí•œ ì¼ì´ ì—†ë‹¤", d:"ìš°ìš¸Â·ë¶ˆì•ˆ"},
                {n:21, t:"ë¶€ëª¨ë‹˜ì€ ì‚¬ì†Œí•œ ì˜ëª»ì—ë„ ì‹¬í•˜ê²Œ ë•Œë¦°ë‹¤", d:"ê°€ì •í™˜ê²½", crit:true},
                {n:22, t:"ëˆ„êµ°ê°€ ë‚˜ë¥¼ í•´ì¹˜ë ¤ í•˜ëŠ” ê²ƒ ê°™ë‹¤", d:"ë§ìƒ", crit:true},
                {n:23, t:"ë³¸ë°›ê³  ì‹¶ì€ ì¹œêµ¬ê°€ ìˆë‹¤", d:"ë˜ë˜í™˜ê²½", rev:true},
                {n:24, t:"ì£¼ìœ„ì—ì„œ ë‚´ê°€ ê°€ë§Œíˆ ìˆì§€ ëª»í•œë‹¤ê³  ë§í•œë‹¤", d:"ê³¼ì‰í–‰ë™"},
                {n:25, t:"ë‚¨ë“¤ì€ ë‚´ê°€ ìƒê°ë³´ë‹¤ í–‰ë™ì´ ì•ì„ ë‹¤ê³  í•œë‹¤", d:"ê³¼ì‰í–‰ë™"},
                {n:26, t:"ì ë“¤ê¸° ì–´ë µê±°ë‚˜ ìë‹¤ê°€ ìì£¼ ê¹¬ë‹¤", d:"ìš°ìš¸Â·ë¶ˆì•ˆ"},
                {n:27, t:"ë¶€ëª¨ë‹˜ì€ ìì£¼ ì‹¬í•˜ê²Œ ë‹¤íˆ¬ì‹ ë‹¤", d:"ê°€ì •í™˜ê²½", crit:true},
                {n:28, t:"ì£¼ë³€ì— ë§ˆìŒ ë†“ê³  ì˜ì§€í•  ì–´ë¥¸ì´ ìˆë‹¤", d:"ë³´í˜¸ìš”ì¸", rev:true},
                {n:29, t:"ì‹ìš•ì´ ê¸‰ê²©íˆ ê°ì†Œí•˜ê±°ë‚˜ ì¦ê°€í–ˆë‹¤", d:"ìš°ìš¸Â·ë¶ˆì•ˆ"},
                {n:30, t:"ì¹œêµ¬/ì„ í›„ë°°ë¡œë¶€í„° ë”°ëŒë¦¼ í”¼í•´ë¥¼ ë°›ì€ ì  ìˆë‹¤", d:"ë˜ë˜í™˜ê²½", crit:true},
                {n:31, t:"ê°€ì¡±ì€ ë‚´ê°€ í•„ìš”ë¡œ í•  ë•Œ ë„ì›€/ê²©ë ¤ë¥¼ ì¤€ë‹¤", d:"ë³´í˜¸ìš”ì¸", rev:true},
                {n:32, t:"ìœ—ì‚¬ëŒì´ ë­ë¼ í•˜ë©´ ë§ë‹¤íˆ¼ì„ ë²Œì¸ë‹¤", d:"ë°˜í•­Â·í’ˆí–‰"},
                {n:33, t:"ì´ìœ  ì—†ì´ ëˆˆë¬¼ì´ ë‚œë‹¤", d:"ìš°ìš¸Â·ë¶ˆì•ˆ"},
                {n:34, t:"ë‹¤ë¥¸ ì‚¬ëŒì´ ë‚˜ë¥¼ ë‚˜ì˜ê²Œ í‰ê°€í• ê¹Œ ë‘ë µë‹¤", d:"ìš°ìš¸Â·ë¶ˆì•ˆ"},
                {n:35, t:"ë™ì˜ ì—†ì´ íƒ€ì¸ì—ê²Œ ì„±ì  í–‰ìœ„ë¥¼ í•œ ì  ìˆë‹¤", d:"ë°˜í•­Â·í’ˆí–‰", crit:true},
                {n:36, t:"ì»¤ì„œ ì–´ë–¤ ì‚¬ëŒì´ ë ì§€ ë¶„ëª…í•œ ìƒê°ì´ ìˆë‹¤", d:"ë³´í˜¸ìš”ì¸", rev:true},
                {n:37, t:"ë‹¤ë¥¸ ì‚¬ëŒì„ ìœ„í˜‘í•˜ëŠ” ë§ì„ ìì£¼ í•œë‹¤", d:"ë°˜í•­Â·í’ˆí–‰"},
                {n:38, t:"ì§€ë‚œ 1ê°œì›” ê°„ ë‚˜ëŠ” ëŠ˜ ê¸´ì¥ì´ ëœë‹¤", d:"ìš°ìš¸Â·ë¶ˆì•ˆ"},
                {n:39, t:"ë¬¼ê±´ì´ë‚˜ ì†Œì§€í’ˆ ë“±ì„ ì˜ ìƒì–´ë²„ë¦°ë‹¤", d:"ê³¼ì‰í–‰ë™"},
                {n:40, t:"í•˜ê³  ì‹¶ì€ ì¼ì€ ì°¸ì§€ ëª»í•˜ê³  í•˜ê³ ì•¼ ë§Œë‹¤", d:"ê³¼ì‰í–‰ë™"},
                {n:41, t:"í‰ì†Œ ì‰½ê²Œ í•˜ë˜ ì¼ì´ ì–´ë µê²Œ ëŠê»´ì§„ë‹¤", d:"ìš°ìš¸Â·ë¶ˆì•ˆ"},
                {n:42, t:"ê°€ì •ì´ ê²½ì œì ìœ¼ë¡œ ì–´ë µë‹¤", d:"ê°€ì •í™˜ê²½"},
                {n:43, t:"ì§€ë‚œ 1ê°œì›” ê°„ ë‚˜ëŠ” ê±±ì •ì´ ë§ë‹¤", d:"ìš°ìš¸Â·ë¶ˆì•ˆ"},
                {n:44, t:"ìŒì£¼/í¡ì—° ë¬¸ì œë¡œ íƒ€ì¸ê³¼ ê°ˆë“±ì„ ê²ªê³  ìˆë‹¤", d:"ì¤‘ë…", crit:true},
                {n:45, t:"ìŠ¤ë§ˆíŠ¸í° ê³¼ë‹¤ì‚¬ìš©ìœ¼ë¡œ ê°ˆë“±ì„ ê²ªê³  ìˆë‹¤", d:"ì¤‘ë…", crit:true},
                {n:46, t:"ì˜¨ë¼ì¸ ê²Œì„/ë„ë°• ë¬¸ì œë¡œ ê°ˆë“±ì„ ê²ªê³  ìˆë‹¤", d:"ì¤‘ë…", crit:true},
                {n:47, t:"ì‡¼í•‘ ë¬¸ì œë¡œ íƒ€ì¸ê³¼ ê°ˆë“±ì„ ê²ªê³  ìˆë‹¤", d:"ì¤‘ë…", crit:true},
                {n:48, t:"ì§€ë‚œ 3ê°œì›”ê°„ ìì‚´ì„ ìƒê°í•´ ë³¸ ì  ìˆë‹¤", d:"ìì‚´", crit:true},
                {n:49, t:"ì§€ë‚œ 3ê°œì›”ê°„ êµ¬ì²´ì ìœ¼ë¡œ ìì‚´ì„ ê³„íší•´ ë³¸ ì  ìˆë‹¤", d:"ìì‚´", crit:true},
                {n:50, t:"ì§€ë‚œ 3ê°œì›”ê°„ ìì‚´ì„ ì‹œë„í•´ ë³¸ ì  ìˆë‹¤", d:"ìì‚´", crit:true},
                {n:51, t:"ìì‚´ ì˜ë„ ì—†ì´ ëª¸ì— ìƒì²˜ë¥¼ ë‚¸ ì  ìˆë‹¤", d:"ìí•´", crit:true},
                {n:52, t:"ì´ ê²€ì‚¬ì— ì†”ì§í•˜ê²Œ ë‹µí–ˆìŠµë‹ˆê¹Œ?", d:"í™•ì¸"},
                {n:53, t:"ìƒë‹´ì´ ê¶Œìœ ëœë‹¤ë©´ ë°›ì„ ì˜í–¥ì´ ìˆìŠµë‹ˆê¹Œ?", d:"í™•ì¸"}
            ]
        },
        CHILD: {
            jarip: [
                {n:1, t:"ë‚˜ëŠ” ì¢‹ì€ ì ì´ ë§ì€ ì‚¬ëŒì´ë‹¤", d:"ìì¡´ê°"},
                {n:2, t:"ë‚˜ëŠ” ê³µë¶€ë¥¼ ì˜í•˜ëŠ” ì‚¬ëŒì´ë‹¤", d:"ìì¡´ê°"},
                {n:3, t:"ë‚˜ëŠ” ì–´ë–¤ ì¼ì´ë“  ê¾¸ì¤€í•˜ê²Œ í•œë‹¤", d:"ì„±ì‹¤ì„±"},
                {n:4, t:"ì¹œêµ¬ì™€ ê°ˆë“±ì´ ìˆì„ ë•Œ í•´ê²° ë°©ë²•ì„ ì•ˆë‹¤", d:"ì‚¬íšŒì ìœ ëŠ¥ê°"},
                {n:5, t:"ë‚˜ëŠ” ì¹œêµ¬ë“¤ê³¼ ì˜ ì–´ìš¸ë¦´ ìˆ˜ ìˆë‹¤", d:"ì‚¬íšŒì ìœ ëŠ¥ê°"},
                {n:6, t:"ë¶€ëª¨ë‹˜ì€ ë‚˜ë¥¼ ìë‘ìŠ¤ëŸ¬ì›Œí•œë‹¤", d:"ìì¡´ê°"},
                {n:7, t:"ë‚˜ëŠ” ì •í•´ì§„ ê·œì¹™ì„ ì˜ ì§€í‚¨ë‹¤", d:"ì„±ì‹¤ì„±"},
                {n:8, t:"ê³µë¶€í•˜ë‹¤ ëª¨ë¥´ëŠ” ë¬¸ì œê°€ ìˆìœ¼ë©´ ì–´ë–»ê²Œ í• ì§€ ì•ˆë‹¤", d:"í•™ì—…íš¨ëŠ¥ê°"},
                {n:9, t:"ì¢‹ì€ ê²°ê³¼ë¥¼ ê°€ì ¸ì˜¨ ë‚˜ë§Œì˜ ê³µë¶€ ë°©ë²•ì´ ìˆë‹¤", d:"í•™ì—…íš¨ëŠ¥ê°"},
                {n:10, t:"ì¹œêµ¬ë“¤ì—ê²Œ ë‚´ ì˜ê²¬ì„ ì˜ ì´ì•¼ê¸°í•  ìˆ˜ ìˆë‹¤", d:"ì‚¬íšŒì ìœ ëŠ¥ê°"},
                {n:11, t:"ì¼ì´ë‚˜ ê³µë¶€í•  ë•Œ ê³„íšì„ ì„¸ìš°ê³  ì§€í‚¤ë ¤ í•œë‹¤", d:"ì„±ì‹¤ì„±"},
                {n:12, t:"ë‚˜ëŠ” ì§€ê¸ˆì˜ ë‚´ ëª¨ìŠµì„ ì¢‹ì•„í•œë‹¤", d:"ìì¡´ê°"},
                {n:13, t:"ì¹œêµ¬ë“¤ì€ ë‚˜ì™€ í•¨ê»˜ ìˆëŠ” ê²ƒì„ ì¢‹ì•„í•œë‹¤", d:"ìì¡´ê°"},
                {n:14, t:"ë³µì¡í•˜ê³  ì–´ë ¤ìš´ ë¬¸ì œë¼ë„ ë„ì „í•´ì„œ í•´ê²°í•œë‹¤", d:"í•™ì—…íš¨ëŠ¥ê°"}
            ],
            simni: [
                {n:1, t:"ìë„ ìë„ í”¼ê³¤í•˜ë‹¤", d:"ìš°ìš¸Â·ë¶ˆì•ˆ"},
                {n:2, t:"ì—¬ëŸ¬ ê°€ì§€ ì¼ì— ê±±ì •ì´ ë§ë‹¤", d:"ìš°ìš¸Â·ë¶ˆì•ˆ"},
                {n:3, t:"ë¶€ëª¨ë‹˜ì€ ë‚´ê°€ ì•„íŒŒë„ ë³‘ì›ì— ë°ë ¤ê°€ì§€ ì•ŠëŠ”ë‹¤", d:"ë¶€ëª¨ìë…€", crit:true},
                {n:4, t:"ë‚´ê²ŒëŠ” ì†ë§ˆìŒì„ í„°ë†“ì„ ì¹œêµ¬ê°€ ìˆë‹¤", d:"ë˜ë˜ê´€ê³„", rev:true},
                {n:5, t:"ë‚˜ë¥¼ ê´´ë¡­íˆëŠ” ì¹œêµ¬ê°€ ìˆë‹¤", d:"ë˜ë˜ê´€ê³„", crit:true},
                {n:6, t:"ì£¼ë³€ì— ë§ˆìŒ ë†“ê³  ì˜ì§€í•  ì–´ë¥¸ì´ ìˆë‹¤", d:"ë³´í˜¸ìš”ì¸", rev:true},
                {n:7, t:"ìš°ë¦¬ ê°€ì¡±ì€ ë‚´ê°€ í•„ìš”ë¡œ í•  ë•Œ ë„ì›€ì„ ì¤€ë‹¤", d:"ë³´í˜¸ìš”ì¸", rev:true},
                {n:8, t:"ë‚˜ëŠ” ìì£¼ ê±°ì§“ë§ì„ í•œë‹¤", d:"ë°˜í•­Â·í’ˆí–‰", crit:true},
                {n:9, t:"ì‹œì‘í•œ ì¼ì„ ëë‚´ì§€ ëª»í•  ë•Œê°€ ë§ë‹¤", d:"ê³¼ì‰í–‰ë™"},
                {n:10, t:"ì´ìœ  ì—†ì´ ë¨¸ë¦¬ë‚˜ ë°°ê°€ ì•„í”„ë‹¤", d:"ìš°ìš¸Â·ë¶ˆì•ˆ"},
                {n:11, t:"ì‘ì€ ì¼ì—ë„ ì§œì¦ì´ ë‚œë‹¤", d:"ìš°ìš¸Â·ë¶ˆì•ˆ"},
                {n:12, t:"ë¶€ëª¨ë‹˜ì´ë‚˜ ì„ ìƒë‹˜ê»˜ ë§ëŒ€ê¾¸í•˜ê±°ë‚˜ ëŒ€ë“ ë‹¤", d:"ë°˜í•­Â·í’ˆí–‰"},
                {n:13, t:"ì˜ìì— ì•‰ì•„ ìˆìœ¼ë©´ ì†ë°œì„ ê³„ì† ì›€ì§ì¸ë‹¤", d:"ê³¼ì‰í–‰ë™"},
                {n:14, t:"ì‰¬ìš´ ë¬¸ì œë„ ì˜ í’€ì§€ ëª»í•  ê²ƒ ê°™ë‹¤", d:"ìš°ìš¸Â·ë¶ˆì•ˆ"},
                {n:15, t:"ê°€ë§Œíˆ ì•‰ì•„ ìˆì§€ ëª»í•˜ê³  ëŒì•„ë‹¤ë‹Œë‹¤", d:"ê³¼ì‰í–‰ë™"},
                {n:16, t:"ì˜ ë‹¤ì¹œë‹¤", d:"ê³¼ì‰í–‰ë™"},
                {n:17, t:"ë¶€ëª¨ë‹˜ì€ ì¢…ì¢… ë‚˜ë¥¼ ë•Œë¦°ë‹¤", d:"ë¶€ëª¨ìë…€", crit:true},
                {n:18, t:"ì»¤ì„œ ì–´ë–¤ ì‚¬ëŒì´ ë ì§€ ë¶„ëª…í•œ ìƒê°ì´ ìˆë‹¤", d:"ë³´í˜¸ìš”ì¸", rev:true},
                {n:19, t:"ë‚´ ëª¸ì— ìŠ¤ìŠ¤ë¡œ ìƒì²˜ë¥¼ ë‚¸ ì  ìˆë‹¤", d:"ìí•´", crit:true},
                {n:20, t:"ë¬¼ê±´ì„ ì˜ ìƒì–´ë²„ë¦°ë‹¤", d:"ê³¼ì‰í–‰ë™"},
                {n:21, t:"ì¢‹ì§€ ì•Šì€ ì¼ì´ ì¼ì–´ë‚  ê²ƒ ê°™ì•„ ë‘ë µë‹¤", d:"ìš°ìš¸Â·ë¶ˆì•ˆ"},
                {n:22, t:"ë§ë³´ë‹¤ í–‰ë™ì´ ì•ì„ ë‹¤ëŠ” ì–˜ê¸°ë¥¼ ìì£¼ ë“£ëŠ”ë‹¤", d:"ê³¼ì‰í–‰ë™"},
                {n:23, t:"ë‚˜ë³´ë‹¤ ì•½í•œ ì¹œêµ¬/ë™ë¬¼ì„ ê´´ë¡­íŒ ì  ìˆë‹¤", d:"ë°˜í•­Â·í’ˆí–‰", crit:true},
                {n:24, t:"ì£½ê³  ì‹¶ì€ ë§ˆìŒì´ë‹¤", d:"ìì‚´", crit:true},
                {n:25, t:"ìŠ¤ë§ˆíŠ¸í° ë¬¸ì œë¡œ ê°ˆë“±ì„ ê²ªê³  ìˆë‹¤", d:"ì¤‘ë…", crit:true},
                {n:26, t:"ì˜¨ë¼ì¸ ê²Œì„ ë¬¸ì œë¡œ ê°ˆë“±ì„ ê²ªê³  ìˆë‹¤", d:"ì¤‘ë…", crit:true},
                {n:27, t:"ì†”ì§í•˜ê²Œ ë‹µí–ˆìŠµë‹ˆê¹Œ?", d:"í™•ì¸"},
                {n:28, t:"ìƒë‹´ì„ ë°›ì•„ ë³¼ ì˜í–¥ì´ ìˆìŠµë‹ˆê¹Œ?", d:"í™•ì¸"}
            ]
        }
    };

    let user = {};
    let answers = {};
    let currentPart = "jarip"; 

    // [3] ë¡œì§ í•¨ìˆ˜
    function startProcess() {
        const name = document.getElementById('userName').value;
        const birth = document.getElementById('userBirth').value;
        if(!name || !birth) return alert("ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");

        const year = new Date(birth).getFullYear();
        const age = new Date().getFullYear() - year;
        const type = (age >= 13) ? "YOUTH" : "CHILD";

        if(age < 9 || age > 24) alert("â€» ì£¼ì˜: ì´ ê²€ì‚¬ëŠ” 9~24ì„¸ ëŒ€ìƒì…ë‹ˆë‹¤. (í˜„ì¬ " + age + "ì„¸)");

        user = { name, birth, age, type, date: new Date().toLocaleDateString() };
        
        document.getElementById('step-login').classList.add('hidden');
        document.getElementById('step-survey').classList.remove('hidden');
    }

    function goScale() {
        user.dropReason = document.getElementById('dropReason').value;
        user.want1 = document.getElementById('want1').value;
        
        const diffs = [];
        document.querySelectorAll('.difficulty:checked').forEach(el => diffs.push(el.value));
        user.difficulties = diffs.join(", ");

        document.getElementById('step-survey').classList.add('hidden');
        document.getElementById('step-scale').classList.remove('hidden');
        renderQuestions("jarip");
    }

    function renderQuestions(part) {
        currentPart = part;
        const list = DB_QUESTIONS[user.type][part];
        const area = document.getElementById('questions-area');
        const title = document.getElementById('scale-title');
        
        title.innerText = (part === "jarip") ? "â… . ìë¦½ì—­ëŸ‰ ì²™ë„" : "â…¡. ì‹¬ë¦¬ì •ì„œÂ·í™˜ê²½ ì²™ë„";
        area.innerHTML = "";
        window.scrollTo(0,0);

        list.forEach((q, idx) => {
            const div = document.createElement('div');
            div.className = "q-card";
            div.innerHTML = `
                <div class="q-text">${idx+1}. ${q.t}</div>
                <div class="options">
                    <label><input type="radio" name="${part}_${q.n}" value="1" onchange="saveAns('${part}', ${q.n}, 1, ${q.rev}, ${q.crit}, '${q.d}', '${q.t}')">ì „í˜€<br>ì•„ë‹˜</label>
                    <label><input type="radio" name="${part}_${q.n}" value="2" onchange="saveAns('${part}', ${q.n}, 2, ${q.rev}, ${q.crit}, '${q.d}', '${q.t}')">ì•„ë‹ˆë‹¤</label>
                    <label><input type="radio" name="${part}_${q.n}" value="3" onchange="saveAns('${part}', ${q.n}, 3, ${q.rev}, ${q.crit}, '${q.d}', '${q.t}')">ë³´í†µ</label>
                    <label><input type="radio" name="${part}_${q.n}" value="4" onchange="saveAns('${part}', ${q.n}, 4, ${q.rev}, ${q.crit}, '${q.d}', '${q.t}')">ê·¸ë ‡ë‹¤</label>
                    <label><input type="radio" name="${part}_${q.n}" value="5" onchange="saveAns('${part}', ${q.n}, 5, ${q.rev}, ${q.crit}, '${q.d}', '${q.t}')">ë§¤ìš°<br>ê·¸ë ‡ë‹¤</label>
                </div>
            `;
            area.appendChild(div);
        });
    }

    function saveAns(part, no, val, rev, crit, domain, text) {
        answers[`${part}_${no}`] = { val, rev, crit, domain, text };
    }

    function submitNext() {
        if(currentPart === "jarip") {
            renderQuestions("simni");
        } else {
            saveToFirebase();
        }
    }

    function saveToFirebase() {
        const payload = {
            info: user,
            ans: answers,
            timestamp: firebase.firestore.FieldValue.serverTimestamp()
        };

        db.collection("intake_data").add(payload)
        .then(() => {
            document.getElementById('step-scale').classList.add('hidden');
            document.getElementById('step-end').classList.remove('hidden');
        })
        .catch((error) => {
            console.error(error);
            alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error.message);
        });
    }

    // [4] ê´€ë¦¬ì ê¸°ëŠ¥
    function showAdmin() {
        document.getElementById('youth-view').classList.add('hidden');
        document.getElementById('admin-view').classList.remove('hidden');
    }

    function loginAdmin() {
        if(document.getElementById('adminPw').value === "1388") {
            document.getElementById('admin-login').classList.add('hidden');
            document.getElementById('admin-dash').classList.remove('hidden');
            loadData();
        } else {
            alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.");
        }
    }

    function loadData() {
        const list = document.getElementById('user-list');
        list.innerHTML = "<p>ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>";
        
        db.collection("intake_data").orderBy("timestamp", "desc").limit(20).get()
        .then((querySnapshot) => {
            list.innerHTML = "";
            querySnapshot.forEach((doc) => {
                const d = doc.data();
                const li = document.createElement('li');
                li.innerHTML = `
                    <div class="card" style="display:flex; justify-content:space-between; align-items:center; padding:15px;">
                        <div>
                            <strong>${d.info.name}</strong> (${d.info.age}ì„¸)<br>
                            <small>${d.info.date}</small>
                        </div>
                        <button class="btn" style="width:auto; margin:0; padding:10px 20px;" onclick='showReport(${JSON.stringify(d)})'>ê²°ê³¼ë³´ê¸°</button>
                    </div>
                `;
                list.appendChild(li);
            });
        });
    }

    function showReport(data) {
        document.getElementById('admin-dash').classList.add('hidden');
        document.getElementById('report-area').classList.remove('hidden');

        document.getElementById('r-name').innerText = data.info.name;
        document.getElementById('r-birth').innerText = data.info.birth;
        document.getElementById('r-date').innerText = data.info.date;
        document.getElementById('r-reason').innerText = data.info.dropReason;
        document.getElementById('r-diff').innerText = data.info.difficulties;
        document.getElementById('r-want').innerText = data.info.want1;

        let jScores = {}, sScores = {};
        let redFlags = [];
        let rawHtml = "";

        Object.keys(data.ans).sort().forEach(key => {
            const item = data.ans[key];
            const isJarip = key.startsWith("jarip");
            let score = item.val;
            
            if(item.domain === "í™•ì¸") return; 

            if(item.rev) score = 6 - item.val;

            if(isJarip) {
                if(!jScores[item.domain]) jScores[item.domain] = 0;
                jScores[item.domain] += score;
            } else {
                if(!sScores[item.domain]) sScores[item.domain] = 0;
                sScores[item.domain] += score;
                
                if(item.crit && item.val >= 3) {
                    redFlags.push(`[${item.domain}] ${item.text} (ì‘ë‹µ: ${item.val}ì )`);
                }
            }
            rawHtml += `<span style="display:inline-block; width:48%;">${item.text.substring(0,15)}... : <b>${item.val}</b></span>`;
        });

        // ë Œë”ë§ ë¡œì§ (ì»·ì˜¤í”„ ì ìš©)
        const J_CUT = (data.info.type === "YOUTH") ? { 'ìì¡´ê°':19, 'ì„±ì‹¤ì„±':15, 'í•™ì—…íš¨ëŠ¥ê°':13, 'ì‚¬íšŒì ìœ ëŠ¥ê°':18, 'ì§„ë¡œì •ë³´íƒìƒ‰':13 } : { 'ìì¡´ê°':14, 'ì„±ì‹¤ì„±':7, 'í•™ì—…íš¨ëŠ¥ê°':6, 'ì‚¬íšŒì ìœ ëŠ¥ê°':8 };
        let jHtml = "";
        for(let k in jScores) {
            let cut = J_CUT[k] || 10;
            let res = jScores[k] <= cut ? "<b style='color:red'>ìœ„í—˜(Low)</b>" : "ì–‘í˜¸";
            jHtml += `<tr><td>${k}</td><td>${jScores[k]}</td><td>${cut}ì  ì´í•˜</td><td>${res}</td></tr>`;
        }
        document.getElementById('r-jarip-body').innerHTML = jHtml || "<tr><td colspan='4'>ë°ì´í„° ì—†ìŒ</td></tr>";

        const S_CUT = (data.info.type === "YOUTH") ? { 'ìš°ìš¸Â·ë¶ˆì•ˆ':42, 'ê³¼ì‰í–‰ë™':29, 'ë°˜í•­Â·í’ˆí–‰':14, 'ì¤‘ë…':8, 'ìì‚´':9, 'ê°€ì •í™˜ê²½':13, 'ë˜ë˜í™˜ê²½':10 } : { 'ìš°ìš¸Â·ë¶ˆì•ˆ':27, 'ê³¼ì‰í–‰ë™':22, 'ë°˜í•­Â·í’ˆí–‰':9, 'ì¤‘ë…':6, 'ë¶€ëª¨ìë…€':7, 'ë˜ë˜ê´€ê³„':7 };
        let sHtml = "";
        for(let k in sScores) {
            let cut = S_CUT[k] || 99; // ì»·ì˜¤í”„ ì—†ëŠ” í•­ëª©ì€ ì œì™¸ë˜ë„ë¡
            if(cut === 99 && (k==='ë§ìƒ' || k==='ìí•´')) cut = 0; // ë§ìƒ/ìí•´ëŠ” 1ì ì´ë¼ë„ ìˆìœ¼ë©´ ìœ„í—˜ìœ¼ë¡œ ë³¼ ìˆ˜ë„ ìˆìŒ (ê°œë³„ ë¬¸í•­ ì¤‘ìš”)
            
            let res = sScores[k] >= cut ? "<b style='color:red'>ìœ„í—˜(High)</b>" : "ì–‘í˜¸";
            if(cut === 99) res = "-"; // ê¸°ì¤€ ì—†ëŠ” í•­ëª©
            sHtml += `<tr><td>${k}</td><td>${sScores[k]}</td><td>${cut===99?'-':cut+'ì  ì´ìƒ'}</td><td>${res}</td></tr>`;
        }
        document.getElementById('r-simni-body').innerHTML = sHtml || "<tr><td colspan='4'>ë°ì´í„° ì—†ìŒ</td></tr>";

        let gHtml = "<ul style='margin:0; padding-left:20px;'>";
        if(redFlags.length > 0) {
            redFlags.forEach(msg => gHtml += `<li class='danger-text'>${msg}</li>`);
            gHtml += "<br>ğŸ‘‰ <b>ì¡°ì¹˜ì‚¬í•­:</b> ìœ„ê¸° ë¬¸í•­ ë°œê²¬. ë§¤ë‰´ì–¼ íƒìƒ‰ ì§ˆë¬¸ ì‹¤ì‹œ ë° í•„ìš” ì‹œ ì „ë¬¸ê¸°ê´€ ì—°ê³„.";
        } else {
            gHtml += "<li>íŠ¹ì´ ìœ„ê¸° ì§•í›„(Red Flag) ì—†ìŒ.</li>";
        }
        gHtml += "</ul>";
        document.getElementById('r-guide').innerHTML = gHtml;
        document.getElementById('r-raw-data').innerHTML = rawHtml;
    }

    function closeReport() {
        document.getElementById('report-area').classList.add('hidden');
        document.getElementById('admin-dash').classList.remove('hidden');
    }
</script>
</body>
</html>

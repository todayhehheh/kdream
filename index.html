<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë…¸ì›êµ¬ ê¿ˆë“œë¦¼ ì´ˆê¸°ìƒë‹´</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script src="scales.js"></script>
    
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --primary: #00BFA5; --bg: #F3F4F6; --card: #FFFFFF; --text: #222; --border: #DDD; }
        
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; padding-bottom: 90px; }
        
        /* ìƒë‹¨ë°” */
        .header { position: fixed; top: 0; width: 100%; height: 50px; background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: center; z-index: 1000; font-weight: 800; color: var(--primary); }
        .progress { position: fixed; top: 50px; left: 0; height: 4px; background: var(--primary); width: 0%; transition: width 0.3s; z-index: 1000; }

        .container { max-width: 720px; margin: 80px auto 0; padding: 20px; }
        
        /* í˜ì´ì§€ ë‹¨ìœ„ ì»¨í…Œì´ë„ˆ */
        .page-section { display: none; animation: fadeIn 0.3s; }
        .page-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: white; border-radius: 16px; padding: 25px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.02); }
        
        h2 { font-size: 1.3rem; margin-top: 0; margin-bottom: 20px; color: #111; border-bottom: 2px solid var(--primary); padding-bottom: 10px; display: inline-block; }
        h3 { font-size: 1.1rem; margin: 30px 0 10px 0; background: #f0f0f0; padding: 10px; border-radius: 8px; }

        /* ì…ë ¥ í¼ */
        .form-group { margin-bottom: 25px; }
        label { display: block; font-weight: 700; margin-bottom: 8px; font-size: 1rem; }
        
        input, select { width: 100%; padding: 14px; border: 1px solid #ddd; border-radius: 10px; font-size: 1.05rem; box-sizing: border-box; background: #fff; }
        input:focus, select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(0, 191, 165, 0.1); }
        
        /* ë²„íŠ¼ ê·¸ë£¹ (ë¼ë””ì˜¤/ì²´í¬ë°•ìŠ¤) */
        .btn-group { display: flex; flex-wrap: wrap; gap: 8px; }
        .btn-opt { 
            flex: 1; min-width: 100px; padding: 14px; border: 1px solid #ddd; border-radius: 10px; 
            background: #fff; text-align: center; cursor: pointer; font-weight: 600; display: flex; align-items: center; justify-content: center;
        }
        .btn-opt.selected { background: #E0F2F1; border-color: var(--primary); color: #00897B; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: white; padding: 15px; border-top: 1px solid #eee; display: flex; gap: 10px; box-sizing: border-box; z-index: 1000; }
        .btn { flex: 1; padding: 16px; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: 800; cursor: pointer; }
        .btn-prev { background: #f0f0f0; color: #555; flex: 0.4; }
        .btn-next { background: var(--primary); color: white; flex: 1; }

        .hidden { display: none !important; }
        .split { display: flex; gap: 5px; align-items: center; }
        .split input { flex: 1; text-align: center; }

        /* ì¸ì‡„ ì„¤ì • */
        @media print {
            .no-print, .header, .progress, .bottom-nav { display: none !important; }
            #report-area { display: block !important; }
            body { background: white; padding: 0; }
            .card { box-shadow: none; border: none; padding: 0; margin: 0; }
            table { width: 100%; border-collapse: collapse; font-size: 10pt; margin-bottom: 10px; }
            th, td { border: 1px solid #000; padding: 5px; text-align: center; }
            th { background: #eee; width: 15%; }
            td.text-left { text-align: left; padding-left: 5px; }
            .page-break { page-break-before: always; }
        }
    </style>
</head>
<body>

<div class="header no-print">ë…¸ì›êµ¬ ê¿ˆë“œë¦¼ <span style="position:absolute; right:20px; font-size:0.8rem; color:#ccc; cursor:pointer;" onclick="showAdmin()">ğŸ”’</span></div>
<div class="progress" id="progress-bar"></div>

<div id="intro-page" class="container text-center" style="margin-top:100px;">
    <div class="card">
        <h1 style="color:var(--primary); margin-bottom:10px;">í¬ë§ ì„œë¹„ìŠ¤ ì¡°ì‚¬í‘œ</h1>
        <p style="color:#666; line-height:1.6; margin-bottom:40px;">
            ì•ˆë…•í•˜ì„¸ìš”.<br>ê¿ˆë“œë¦¼ ì„¼í„°ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.<br>
            <strong>í¸ì•ˆí•˜ê³  ì†”ì§í•˜ê²Œ</strong> ì‘ì„±í•´ ì£¼ì„¸ìš”.
        </p>
        <button class="btn btn-next" style="width:100%;" onclick="startSurvey()">ì‹œì‘í•˜ê¸°</button>
    </div>
</div>

<div id="survey-wrap" class="container hidden">

    <div id="page-1" class="page-section active">
        <div class="card">
            <h2>1. ê¸°ë³¸ ì¸ì ì‚¬í•­</h2>
            
            <div class="form-group">
                <label>ì„±ëª…</label>
                <input type="text" id="userName" placeholder="ì´ë¦„ ì…ë ¥">
            </div>

            <div class="form-group">
                <label>ì„±ë³„</label>
                <div class="btn-group">
                    <div class="btn-opt" onclick="selBtn(this, 'gender', 'ë‚¨')">ë‚¨ì</div>
                    <div class="btn-opt" onclick="selBtn(this, 'gender', 'ì—¬')">ì—¬ì</div>
                </div>
            </div>

            <div class="form-group">
                <label>ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ (13ìë¦¬)</label>
                <div class="split">
                    <input type="tel" id="rrn1" placeholder="ì• 6ìë¦¬" maxlength="6" oninput="autoCalcBirth(this)">
                    <span>-</span>
                    <input type="tel" id="rrn2" placeholder="ë’¤ 7ìë¦¬" maxlength="7">
                </div>
                <div style="margin-top:8px; font-size:0.9rem; color:#666;">
                    ìƒë…„ì›”ì¼ ìë™ê³„ì‚°: <span id="displayBirth" style="font-weight:bold; color:var(--primary);">ì…ë ¥ ëŒ€ê¸°ì¤‘</span>
                </div>
            </div>

            <div class="form-group">
                <label>ì£¼ì†Œ</label>
                <div class="split" style="margin-bottom:5px;">
                    <input type="text" id="postcode" placeholder="ìš°í¸ë²ˆí˜¸" readonly style="flex:0.4;">
                    <button class="btn-opt" style="flex:0.3; padding:10px; font-size:0.9rem;" onclick="execPostcode()">ê²€ìƒ‰</button>
                </div>
                <input type="text" id="address" placeholder="ì£¼ì†Œ" readonly style="margin-bottom:5px;">
                <input type="text" id="detailAddr" placeholder="ìƒì„¸ì£¼ì†Œ ì…ë ¥">
            </div>

            <div class="form-group">
                <label>ë³¸ì¸ ì—°ë½ì²˜</label>
                <div class="split">
                    <input type="tel" id="tel1" placeholder="010" maxlength="3">
                    <input type="tel" id="tel2" placeholder="0000" maxlength="4">
                    <input type="tel" id="tel3" placeholder="0000" maxlength="4">
                </div>
            </div>

            <div class="form-group">
                <label>ë³´í˜¸ì ì—°ë½ì²˜</label>
                <div class="split">
                    <input type="tel" id="ptel1" placeholder="010" maxlength="3">
                    <input type="tel" id="ptel2" placeholder="0000" maxlength="4">
                    <input type="tel" id="ptel3" placeholder="0000" maxlength="4">
                </div>
            </div>

            <div class="form-group">
                <label>í˜„ì¬ ìƒíƒœ</label>
                <div class="btn-group" style="flex-direction:column;">
                    <div class="btn-opt" onclick="selBtn(this, 'status', 'í•™êµë°–ì²­ì†Œë…„')">í•™êµ ë°– ì²­ì†Œë…„ (ìí‡´, ë¯¸ì§„í•™ ë“±)</div>
                    <div class="btn-opt" onclick="selBtn(this, 'status', 'ê³ ì¡¸ê²€ì •ê³ ì‹œí•©ê²©')">ê³ ì¡¸ ê²€ì •ê³ ì‹œ í•©ê²© ì²­ì†Œë…„</div>
                    <div class="btn-opt" onclick="selBtn(this, 'status', 'í•™ì—…ì¤‘ë‹¨ìˆ™ë ¤ì œ')">í•™ì—…ì¤‘ë‹¨ ìˆ™ë ¤ì œ (ìƒë‹´ ì¤‘)</div>
                </div>
            </div>
        </div>
    </div>

    <div id="page-2" class="page-section">
        <div class="card">
            <h2>2. í•™ì—… ì¤‘ë‹¨ ë° ë°°ê²½</h2>
            
            <div class="form-group">
                <label>ì–¸ì œê¹Œì§€ í•™êµì— ë‹¤ë…”ë‚˜ìš”?</label>
                <div class="btn-group">
                    <div class="btn-opt" onclick="selSchool(this, 'ì´ˆ')">ì´ˆë“±í•™êµ</div>
                    <div class="btn-opt" onclick="selSchool(this, 'ì¤‘')">ì¤‘í•™êµ</div>
                    <div class="btn-opt" onclick="selSchool(this, 'ê³ ')">ê³ ë“±í•™êµ</div>
                    <div class="btn-opt" onclick="selSchool(this, 'ë¯¸ì§„í•™')">ë¯¸ì§„í•™</div>
                </div>
            </div>

            <div id="school-detail" class="hidden" style="background:#f9f9f9; padding:15px; border-radius:10px; margin-bottom:20px;">
                <label>í•™ë…„</label>
                <div id="grade-opts" class="btn-group" style="margin-bottom:15px;"></div>
                <label>í•™ê¸°</label>
                <div class="btn-group">
                    <div class="btn-opt" onclick="selBtn(this, 'semester', '1í•™ê¸°')">1í•™ê¸°</div>
                    <div class="btn-opt" onclick="selBtn(this, 'semester', '2í•™ê¸°')">2í•™ê¸°</div>
                </div>
            </div>

            <div class="form-group">
                <label>í•™êµë¥¼ ê·¸ë§Œë‘” ë‚ ì§œ</label>
                <div class="split">
                    <input type="tel" id="dropY" placeholder="ë…„(4ìë¦¬)" maxlength="4">
                    <input type="tel" id="dropM" placeholder="ì›”" maxlength="2">
                    <input type="tel" id="dropD" placeholder="ì¼" maxlength="2">
                </div>
            </div>

            <div class="form-group">
                <label>ê·¸ë§Œë‘” ì´ìœ  (1ìˆœìœ„)</label>
                <select id="reason1" onchange="updateReasons()">
                    <option value="">ì„ íƒí•´ì£¼ì„¸ìš”</option>
                </select>
            </div>
            <div class="form-group">
                <label>ê·¸ë§Œë‘” ì´ìœ  (2ìˆœìœ„)</label>
                <select id="reason2" onchange="updateReasons()">
                    <option value="">ì„ íƒ (ì—†ìœ¼ë©´ ìƒëµ)</option>
                </select>
            </div>
            <div class="form-group">
                <label>ê·¸ë§Œë‘” ì´ìœ  (3ìˆœìœ„)</label>
                <select id="reason3">
                    <option value="">ì„ íƒ (ì—†ìœ¼ë©´ ìƒëµ)</option>
                </select>
            </div>
            <input type="text" id="reasonEtc" class="hidden" placeholder="ê¸°íƒ€ ì‚¬ìœ  ì…ë ¥" style="width:100%; margin-top:5px;">

            <div class="form-group">
                <label>ë¶€ëª¨ë‹˜(ë³´í˜¸ì) ì˜ê²¬</label>
                <div class="btn-group">
                    <div class="btn-opt" onclick="selBtn(this, 'agree', 'ì¼ì¹˜(ì°¬ì„±)')">ì¼ì¹˜(ì°¬ì„±)</div>
                    <div class="btn-opt" onclick="selBtn(this, 'agree', 'ì¼ì¹˜(ë°˜ëŒ€)')">ì¼ì¹˜(ë°˜ëŒ€)</div>
                    <div class="btn-opt" onclick="selBtn(this, 'agree', 'ë¶ˆì¼ì¹˜')">ë¶ˆì¼ì¹˜</div>
                    <div class="btn-opt" onclick="selBtn(this, 'agree', 'ë¬´ê´€ì‹¬')">ë¬´ê´€ì‹¬</div>
                    <div class="btn-opt" onclick="selBtn(this, 'agree', 'ê¸°íƒ€')">ê¸°íƒ€</div>
                </div>
            </div>
        </div>
    </div>

    <div id="page-3" class="page-section">
        <div class="card">
            <h2>3. ë°©ë¬¸ ê²½ë¡œ</h2>
            <div id="path-list" class="btn-group" style="flex-direction:column;"></div>
            
            <div id="org-list" class="hidden" style="margin-top:20px; border-top:1px dashed #ddd; padding-top:20px;">
                <label>ê¸°ê´€ ìƒì„¸ ì„ íƒ</label>
                <div class="btn-group" id="org-opts"></div>
            </div>
        </div>
    </div>

    <div id="page-4" class="page-section">
        <div class="card">
            <h2>4. ê°€ì¡± ë° ê²½ì œ</h2>
            
            <div class="form-group">
                <label>ê°€ì¡± êµ¬ì„±ì› (5ëª…ê¹Œì§€)</label>
                <div style="display:grid; grid-template-columns:0.6fr 0.8fr 0.5fr 1fr 0.5fr; gap:5px; text-align:center; font-size:0.8rem; font-weight:bold; color:#666;">
                    <span>ê´€ê³„</span><span>ì´ë¦„</span><span>ë‚˜ì´</span><span>ì—°ë½ì²˜</span><span>ë™ê±°</span>
                </div>
                <div id="fam-rows"></div>
            </div>

            <div class="form-group">
                <label>ê°€ì • í˜•íƒœ</label>
                <div class="btn-group" id="fam-type-area"></div>
            </div>

            <div class="form-group">
                <label>ê²½ì œ ìƒíƒœ</label>
                <div class="btn-group" id="econ-area"></div>
            </div>

            <div class="form-group">
                <label>ìš©ëˆ ë§Œì¡±ë„</label>
                <div class="btn-group">
                    <div class="btn-opt" onclick="selBtn(this, 'money', 'ì¶©ë¶„')">ì¶©ë¶„</div>
                    <div class="btn-opt" onclick="selBtn(this, 'money', 'ë³´í†µ')">ë³´í†µ</div>
                    <div class="btn-opt" onclick="selBtn(this, 'money', 'ë¶€ì¡±')">ë¶€ì¡±</div>
                </div>
            </div>
            
            <div class="form-group">
                <label>ë¶€ì¡± ì‹œ ì¶©ë‹¹ ë°©ë²•</label>
                <div class="btn-group">
                    <div class="btn-opt" onclick="selBtn(this, 'howMoney', 'ì•Œë°”')">ì•Œë°”</div>
                    <div class="btn-opt" onclick="selBtn(this, 'howMoney', 'ì§€ì›ê¸ˆ')">ì§€ì›ê¸ˆ</div>
                    <div class="btn-opt" onclick="selBtn(this, 'howMoney', 'ì•„ê»´ì”€')">ì•„ê»´ì”€</div>
                </div>
            </div>

            <div class="form-group">
                <label>ê°€ì • ë‚´ ê´€ì‹¬ë„</label>
                <div class="btn-group">
                    <div class="btn-opt" onclick="selBtn(this, 'interest', 'ë§¤ìš°ì¶©ë¶„')">ë§¤ìš° ì¶©ë¶„</div>
                    <div class="btn-opt" onclick="selBtn(this, 'interest', 'ë³´í†µ')">ë³´í†µ</div>
                    <div class="btn-opt" onclick="selBtn(this, 'interest', 'ë¶€ì¡±')">ë¶€ì¡±</div>
                </div>
            </div>

            <div class="form-group">
                <label>ê³ ë¯¼ ì˜ë…¼ ëŒ€ìƒ</label>
                <div class="btn-group">
                    <div class="btn-opt" onclick="selBtn(this, 'talk', 'ë¶€ëª¨')">ë¶€ëª¨ë‹˜</div>
                    <div class="btn-opt" onclick="selBtn(this, 'talk', 'í˜•ì œ')">í˜•ì œìë§¤</div>
                    <div class="btn-opt" onclick="selBtn(this, 'talk', 'ì¹œêµ¬')">ì¹œêµ¬</div>
                    <div class="btn-opt" onclick="selBtn(this, 'talk', 'ì„ ìƒë‹˜')">ì„ ìƒë‹˜</div>
                    <div class="btn-opt" onclick="selBtn(this, 'talk', 'ì—†ìŒ')">ì—†ìŒ</div>
                </div>
            </div>
        </div>
    </div>

    <div id="page-5" class="page-section">
        <div class="card">
            <h2>5. ì–´ë ¤ì›€ ë° ì„œë¹„ìŠ¤ ìš•êµ¬</h2>
            <div id="diff-area"></div>
            
            <h3 style="background:white; padding-left:0;">í•™êµ ì¤‘ë‹¨ í›„ ëª©í‘œ</h3>
            <div class="btn-group">
                <div class="btn-opt" onclick="selBtn(this, 'goal', 'ê²€ì •ê³ ì‹œ')">ê²€ì •ê³ ì‹œ</div>
                <div class="btn-opt" onclick="selBtn(this, 'goal', 'ë³µí•™')">ë³µí•™</div>
                <div class="btn-opt" onclick="selBtn(this, 'goal', 'ì§„í•™')">ì§„í•™</div>
                <div class="btn-opt" onclick="selBtn(this, 'goal', 'ì·¨ì—…')">ì·¨ì—…</div>
                <div class="btn-opt" onclick="selBtn(this, 'goal', 'ìê²©ì¦')">ìê²©ì¦</div>
                <div class="btn-opt" onclick="selBtn(this, 'goal', 'ë¯¸ì •')">ë¯¸ì •</div>
            </div>

            <h3 style="background:white; padding-left:0;">í¬ë§ ì„œë¹„ìŠ¤ (ëª¨ë‘ ì„ íƒ)</h3>
            <div id="service-area"></div>
        </div>
    </div>

    <div id="page-6" class="page-section">
        <div class="card">
            <h2>6. ê³¼ê±° ìƒí™œ ë° ê±´ê°•</h2>
            <label>ê³¼ê±° í•™êµìƒí™œ</label>
            <div class="btn-group" style="margin-bottom:30px;">
                <div class="btn-opt" onclick="selBtn(this, 'pastSchool', 'ë§Œì¡±')">ë§Œì¡±</div>
                <div class="btn-opt" onclick="selBtn(this, 'pastSchool', 'ë³´í†µ')">ë³´í†µ</div>
                <div class="btn-opt" onclick="selBtn(this, 'pastSchool', 'ë¶ˆë§Œì¡±')">ë¶ˆë§Œì¡±</div>
            </div>

            <label>í˜„ì¬ ê±´ê°• ìƒíƒœ</label>
            <div class="btn-group">
                <div class="btn-opt" onclick="selBtn(this, 'health', 'ì¢‹ìŒ')">ì¢‹ìŒ</div>
                <div class="btn-opt" onclick="selBtn(this, 'health', 'ë³´í†µ')">ë³´í†µ</div>
                <div class="btn-opt" onclick="selBtn(this, 'health', 'ë‚˜ì¨')">ë‚˜ì¨(ì¹˜ë£Œì¤‘)</div>
            </div>
        </div>
    </div>

    <div id="page-7" class="page-section">
        <div class="card">
            <h2>7. ìë¦½ì—­ëŸ‰ ì²™ë„</h2>
            <div id="jarip-area"></div>
        </div>
    </div>

    <div id="page-8" class="page-section">
        <div class="card">
            <h2>8. ì‹¬ë¦¬ì •ì„œ ì²™ë„</h2>
            <div id="simni-area"></div>
        </div>
    </div>

    <div id="page-end" class="page-section text-center" style="margin-top:100px;">
        <h1 style="font-size:3rem;">ğŸ‰</h1>
        <h2>ì‘ì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h2>
        <p style="color:#666;">ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤. íƒœë¸”ë¦¿ì„ ë°˜ë‚©í•´ ì£¼ì„¸ìš”.</p>
        <button class="btn btn-next" onclick="location.reload()" style="margin-top:30px; width:auto; padding:15px 40px;">ì²˜ìŒìœ¼ë¡œ</button>
    </div>

</div>

<div id="bottom-bar" class="bottom-nav hidden no-print">
    <button class="btn btn-prev" onclick="movePage(-1)">ì´ì „</button>
    <button class="btn btn-next" onclick="movePage(1)" id="btn-next">ë‹¤ìŒ</button>
</div>

<div id="admin-view" class="container hidden no-print">
    </div>
<div id="report-area" class="hidden">
    </div>

<script>
    // [1] Firebase ì„¤ì • (ë³¸ì¸ í‚¤ë¡œ ë³€ê²½)
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "kdream-db462.firebaseapp.com",
        projectId: "kdream-db462",
        storageBucket: "kdream-db462.firebasestorage.app",
        messagingSenderId: "1020262030810",
        appId: "1:1020262030810:web:3482636bc020bb4310b4e3"
    };
    try { firebase.initializeApp(firebaseConfig); var db = firebase.firestore(); } catch(e){}

    // [2] ìƒíƒœ ê´€ë¦¬
    let currPage = 0;
    const totalPages = 8; 
    let userData = {};
    let answers = {};
    let userType = "YOUTH";

    window.onload = function() {
        renderOptions();
    };

    function renderOptions() {
        // ì¤‘ë‹¨ì‚¬ìœ 
        const r1 = document.getElementById('reason1');
        REASON_OPTIONS.forEach(r => r1.add(new Option(r, r)));
        
        // ë°©ë¬¸ê²½ë¡œ
        const pList = document.getElementById('path-list');
        VISIT_PATHS.forEach(p => {
            let click = p.includes('ê¸°ê´€') ? `document.getElementById('org-list').classList.remove('hidden')` : `document.getElementById('org-list').classList.add('hidden')`;
            pList.innerHTML += `<div class="btn-opt" onclick="selBtn(this, 'path', '${p}'); ${click}">${p}</div>`;
        });
        document.getElementById('org-opts').innerHTML = ORG_DETAILS.map(o => `<div class="btn-opt" onclick="selBtn(this, 'org', '${o}')">${o}</div>`).join('');

        // ê°€ì •í˜•íƒœ/ê²½ì œ
        document.getElementById('fam-type-area').innerHTML = FAMILY_TYPE_OPTIONS.map(o => `<div class="btn-opt" onclick="selBtn(this, 'famType', '${o}')">${o}</div>`).join('');
        document.getElementById('econ-area').innerHTML = ECON_STATUS_OPTIONS.map(o => `<div class="btn-opt" onclick="selBtn(this, 'econ', '${o}')">${o}</div>`).join('');

        // ê°€ì¡±ì…ë ¥ì¹¸
        let famHtml = "";
        for(let i=1; i<=5; i++) famHtml += `<div class="fam-grid"><input type="text" id="fr${i}"><input type="text" id="fn${i}"><input type="tel" id="fa${i}"><input type="tel" id="ft${i}"><select id="fl${i}"><option value="Y">O</option><option value="N">X</option></select></div>`;
        document.getElementById('fam-rows').innerHTML = famHtml;

        // ì–´ë ¤ì›€/ì„œë¹„ìŠ¤
        renderCheckGroup('diff-area', DIFFICULTY_GROUPS, 'diff');
        renderCheckGroup('service-area', SERVICE_GROUPS, 'serv');
    }

    function renderCheckGroup(id, data, name) {
        const div = document.getElementById(id);
        for(let key in data) {
            div.innerHTML += `<h3>${key}</h3><div class="btn-group">` + 
                data[key].map(i => `<div class="btn-opt" onclick="toggleCheck(this, '${name}', '${i}')">${i}</div>`).join('') + `</div>`;
        }
    }

    // ë¡œì§ í•¨ìˆ˜ë“¤
    function startSurvey() {
        document.getElementById('intro-page').classList.add('hidden');
        document.getElementById('survey-wrap').classList.remove('hidden');
        document.getElementById('bottom-bar').classList.remove('hidden');
        movePage(1);
    }

    function movePage(dir) {
        if(currPage > 0) document.getElementById(`page-${currPage}`).classList.remove('active');
        currPage += dir;
        
        if(currPage < 1) currPage = 1;
        if(currPage === 7) initScale('jarip');
        if(currPage === 8) initScale('simni');
        if(currPage > totalPages) { submitFinal(); return; }

        document.getElementById(`page-${currPage}`).classList.add('active');
        
        // ë²„íŠ¼/ì§„í–‰ë°”
        const nextBtn = document.getElementById('btn-next');
        nextBtn.innerText = (currPage === totalPages) ? "ì œì¶œí•˜ê¸°" : "ë‹¤ìŒ";
        document.getElementById('progress-bar').style.width = (currPage/totalPages*100) + "%";
        window.scrollTo(0,0);
    }

    function autoCalcBirth(el) {
        if(el.value.length === 6) {
            const y = parseInt(el.value.substr(0,2));
            const fullY = y < 30 ? 2000+y : 1900+y;
            const m = el.value.substr(2,2);
            const d = el.value.substr(4,2);
            document.getElementById('displayBirth').innerText = `${fullY}ë…„ ${m}ì›” ${d}ì¼`;
            
            // ì²™ë„ íƒ€ì… ê²°ì •
            const age = new Date().getFullYear() - fullY;
            userType = (age >= 13) ? "YOUTH" : "CHILD";
            
            document.getElementById('rrn2').focus();
        }
    }

    function selSchool(el, lvl) {
        selBtn(el, 'schLvl', lvl);
        const area = document.getElementById('school-detail');
        const gArea = document.getElementById('grade-opts');
        
        if(lvl === 'ë¯¸ì§„í•™') { area.classList.add('hidden'); return; }
        
        area.classList.remove('hidden');
        gArea.innerHTML = "";
        let max = (lvl === 'ì´ˆ') ? 6 : 3;
        for(let i=1; i<=max; i++) {
            gArea.innerHTML += `<div class="btn-opt" onclick="selBtn(this, 'grade', '${i}í•™ë…„')">${i}í•™ë…„</div>`;
        }
    }

    function updateReasons() {
        const r1 = document.getElementById('reason1').value;
        const r2 = document.getElementById('reason2');
        const r3 = document.getElementById('reason3');
        const etc = document.getElementById('reasonEtc');

        r2.innerHTML = '<option value="">ì„ íƒ</option>';
        r3.innerHTML = '<option value="">ì„ íƒ</option>';

        REASON_OPTIONS.forEach(r => {
            if(r !== r1) {
                r2.add(new Option(r, r));
                r3.add(new Option(r, r));
            }
        });

        if(r1.includes('ê¸°íƒ€')) etc.classList.remove('hidden');
        else etc.classList.add('hidden');
    }

    // ê³µí†µ ì„ íƒ í•¨ìˆ˜ (ë‹¨ì¼)
    function selBtn(el, key, val) {
        userData[key] = val;
        // ìŠ¤íƒ€ì¼ ì²˜ë¦¬
        const sibs = el.parentElement.children;
        for(let s of sibs) s.classList.remove('selected');
        el.classList.add('selected');
    }

    // ê³µí†µ ì„ íƒ í•¨ìˆ˜ (ë‹¤ì¤‘)
    function toggleCheck(el, name, val) {
        el.classList.toggle('selected');
        if(!userData[name]) userData[name] = [];
        
        if(el.classList.contains('selected')) userData[name].push(val);
        else userData[name] = userData[name].filter(v => v !== val);
    }

    // ì²™ë„ ë Œë”ë§
    function initScale(part) {
        const list = SCALE_DATA[userType][part];
        const div = document.getElementById(part + '-area');
        div.innerHTML = "";
        
        list.forEach((q, i) => {
            div.innerHTML += `
                <div style="background:#f9f9f9; padding:15px; border-radius:10px; margin-bottom:10px;">
                    <div style="font-weight:bold; margin-bottom:8px;">${i+1}. ${q.t}</div>
                    <div class="btn-group">
                        <div class="btn-opt" onclick="saveAns('${part}',${q.n},1,this,${q.rev},${q.crit},'${q.d}')">ì „í˜€ì•„ë‹˜</div>
                        <div class="btn-opt" onclick="saveAns('${part}',${q.n},2,this,${q.rev},${q.crit},'${q.d}')">ì•„ë‹ˆë‹¤</div>
                        <div class="btn-opt" onclick="saveAns('${part}',${q.n},3,this,${q.rev},${q.crit},'${q.d}')">ë³´í†µ</div>
                        <div class="btn-opt" onclick="saveAns('${part}',${q.n},4,this,${q.rev},${q.crit},'${q.d}')">ê·¸ë ‡ë‹¤</div>
                        <div class="btn-opt" onclick="saveAns('${part}',${q.n},5,this,${q.rev},${q.crit},'${q.d}')">ë§¤ìš°ê·¸ë ‡ë‹¤</div>
                    </div>
                </div>`;
        });
    }

    function saveAns(part, n, v, el, r, c, d) {
        answers[`${part}_${n}`] = {val:v, rev:r, crit:c, domain:d};
        const sibs = el.parentElement.children;
        for(let s of sibs) s.classList.remove('selected');
        el.classList.add('selected');
    }

    function execPostcode() {
        new daum.Postcode({
            oncomplete: function(data) {
                document.getElementById('postcode').value = data.zonecode;
                document.getElementById("address").value = data.roadAddress;
                document.getElementById("detailAddr").focus();
            }
        }).open();
    }

    function submitFinal() {
        // ë°ì´í„° ìˆ˜ì§‘ (ì…ë ¥ì°½ ê°’ë“¤)
        userData.name = document.getElementById('userName').value;
        userData.rrn = document.getElementById('rrn1').value + "-" + document.getElementById('rrn2').value;
        userData.addr = document.getElementById('address').value + " " + document.getElementById('detailAddr').value;
        userData.tel = `${document.getElementById('tel1').value}-${document.getElementById('tel2').value}-${document.getElementById('tel3').value}`;
        userData.ptel = `${document.getElementById('ptel1').value}-${document.getElementById('ptel2').value}-${document.getElementById('ptel3').value}`;
        
        userData.dropDate = `${document.getElementById('dropY').value}.${document.getElementById('dropM').value}.${document.getElementById('dropD').value}`;
        userData.reasons = [document.getElementById('reason1').value, document.getElementById('reason2').value, document.getElementById('reason3').value].filter(Boolean).join(", ");
        
        // ê°€ì¡±
        let fam = [];
        for(let i=1; i<=5; i++) {
            let n = document.getElementById(`fn${i}`).value;
            if(n) fam.push(`${document.getElementById(`fr${i}`).value}/${n}`);
        }
        userData.family = fam.join(", ");

        const payload = { info: userData, ans: answers, ts: firebase.firestore.FieldValue.serverTimestamp() };
        
        if(db) {
            db.collection("intake_ok").add(payload).then(() => {
                document.getElementById('survey-wrap').classList.add('hidden');
                document.getElementById('bottom-bar').classList.add('hidden');
                document.getElementById('page-end').classList.remove('hidden');
            });
        }
    }
    
    // ê´€ë¦¬ì ê´€ë ¨ í•¨ìˆ˜ (showAdmin, loginAdmin, loadList, viewRpt)ëŠ” ì´ì „ ì½”ë“œ ê·¸ëŒ€ë¡œ ì‚¬ìš©
    function showAdmin() {
        document.getElementById('intro-page').classList.add('hidden');
        document.getElementById('admin-view').classList.remove('hidden');
    }
    // ... (ì´ì „ ì½”ë“œì˜ admin ë¡œì§ ë³µì‚¬)
</script>
</body>
</html>

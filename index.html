<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ë…¸ì›êµ¬ ê¿ˆë“œë¦¼ í¬ë§ì„œë¹„ìŠ¤ ì¡°ì‚¬í‘œ</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script src="scales.js"></script>
    
    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        :root { --primary: #00BFA5; --bg: #F0F2F5; --card: #FFFFFF; --text: #333; --border: #E0E0E0; }
        
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; padding-bottom: 100px; -webkit-tap-highlight-color: transparent; }
        
        /* ìˆ«ì ì…ë ¥ ìŠ¤í”¼ë„ˆ ì œê±° */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        
        /* í—¤ë” */
        .header { position: fixed; top: 0; width: 100%; height: 60px; background: white; z-index: 999; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 1.2rem; color: var(--primary); }
        .admin-btn { position: absolute; right: 20px; font-size: 0.8rem; color: #aaa; cursor: pointer; }

        .container { max-width: 680px; margin: 80px auto 0; padding: 20px; }
        
        /* ì§ˆë¬¸ ë°•ìŠ¤ (ì• ë‹ˆë©”ì´ì…˜) */
        .q-box { 
            background: var(--card); border-radius: 16px; padding: 30px; margin-bottom: 20px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.03); 
            opacity: 0; transform: translateY(20px); transition: all 0.5s ease-out; display: none;
        }
        .q-box.show { display: block; opacity: 1; transform: translateY(0); }

        h2 { font-size: 1.4rem; margin-top: 0; margin-bottom: 10px; color: #222; font-weight: 800; border-bottom: 2px solid var(--primary); padding-bottom:10px; display:inline-block;}
        label { display: block; font-weight: 700; margin-bottom: 10px; font-size: 1.1rem; color: #444; }
        .sub-text { font-size: 0.9rem; color: #888; font-weight: normal; margin-left: 5px; }

        /* ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ë§ */
        input[type="text"], input[type="tel"], input[type="number"], select {
            width: 100%; padding: 16px; border: 1px solid #ddd; border-radius: 12px; font-size: 1.1rem; 
            box-sizing: border-box; background: #fff; text-align: center; transition: 0.2s; -webkit-appearance: none;
        }
        input:focus, select:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(0, 191, 165, 0.1); }

        /* ë¶„í•  ì…ë ¥ (ìƒë…„ì›”ì¼, ì£¼ë¯¼ë²ˆí˜¸ ë“±) - í¬ê¸° ë™ì¼í•˜ê²Œ ê°•ì œ */
        .split-box { display: flex; gap: 8px; align-items: center; }
        .split-box input { flex: 1; min-width: 0; } /* min-width:0 ì¶”ê°€ë¡œ flex ì°Œê·¸ëŸ¬ì§ ë°©ì§€ */
        
        /* ë²„íŠ¼í˜• ì„ íƒì§€ */
        .btn-group { display: flex; flex-wrap: wrap; gap: 8px; }
        .btn-opt { 
            flex: 1; min-width: 120px; padding: 16px; border: 1px solid #ddd; border-radius: 12px; background: #fff;
            text-align: center; font-weight: 600; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center;
        }
        .btn-opt:hover { background: #f9f9f9; }
        .btn-opt.selected { background: #E0F2F1; border-color: var(--primary); color: #00897B; font-weight: 800; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        /* í•˜ë‹¨ ì§„í–‰ë°” */
        .progress-fixed { position: fixed; bottom: 0; left: 0; width: 100%; height: 6px; background: #eee; z-index: 1000; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }

        .hidden { display: none !important; }
        .full-btn { width: 100%; background: var(--primary); color: white; border: none; padding: 18px; border-radius: 12px; font-size: 1.2rem; font-weight: bold; cursor: pointer; margin-top: 20px; }

        /* ê°€ì¡±ê´€ê³„ í…Œì´ë¸” */
        .fam-grid { display: grid; grid-template-columns: 0.6fr 0.8fr 0.5fr 1fr 0.5fr; gap: 5px; margin-bottom: 5px; }
        .fam-grid input, .fam-grid select { padding: 10px; font-size: 0.9rem; }

        /* ì¸ì‡„ ì„¤ì • */
        @media print {
            .no-print, .header, .progress-fixed, .full-btn { display: none !important; }
            #report-area { display: block !important; }
            body { background: white; padding: 0; font-size: 10pt; }
            .card { box-shadow: none; padding: 0; }
            table { width: 100%; border-collapse: collapse; margin-bottom: 10px; font-size: 10pt; }
            th, td { border: 1px solid #000; padding: 5px; text-align: center; }
            th { background: #f0f0f0; width: 15%; }
            td.text-left { text-align: left; padding-left: 5px; }
            .section-head { font-size: 12pt; font-weight: bold; border-bottom: 2px solid #000; margin: 15px 0 5px 0; }
            .page-break { page-break-before: always; }
        }
    </style>
</head>
<body>

<div class="header no-print">
    ë…¸ì›êµ¬ ê¿ˆë“œë¦¼
    <span class="admin-btn" onclick="showAdmin()">ğŸ”’</span>
</div>

<div id="intro-screen" class="container text-center" style="margin-top:120px;">
    <div class="q-box show">
        <h1 style="color:var(--primary); font-size:2rem; margin-bottom:10px;">í¬ë§ ì„œë¹„ìŠ¤ ì¡°ì‚¬í‘œ</h1>
        <p style="color:#666; margin:40px 0; line-height:1.8;">
            ì•ˆë…•í•˜ì„¸ìš”!<br>ê¿ˆë“œë¦¼ ì„¼í„°ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.<br>
            <strong>í¸ì•ˆí•˜ê³  ì†”ì§í•˜ê²Œ</strong> ë‹µë³€í•´ ì£¼ì„¸ìš”.
        </p>
        <button class="full-btn" onclick="startSurvey()">ì‹œì‘í•˜ê¸°</button>
    </div>
</div>

<div id="survey-screen" class="container hidden">
    
    <div id="q-basic" class="q-box show">
        <h2>ê¸°ë³¸ ì¸ì ì‚¬í•­</h2>
        <div class="form-group" style="margin-top:20px;">
            <label>ì„±ëª…</label>
            <input type="text" id="userName" placeholder="ì´ë¦„ ì…ë ¥" onchange="next('q-gender')">
        </div>
    </div>

    <div id="q-gender" class="q-box">
        <label>ì„±ë³„</label>
        <div class="btn-group">
            <div class="btn-opt" onclick="selectOpt(this, 'gender', 'ë‚¨'); next('q-birth');">ë‚¨ì</div>
            <div class="btn-opt" onclick="selectOpt(this, 'gender', 'ì—¬'); next('q-birth');">ì—¬ì</div>
        </div>
    </div>

    <div id="q-birth" class="q-box">
        <label>ìƒë…„ì›”ì¼</label>
        <div class="split-box">
            <input type="tel" id="birthY" placeholder="ë…„(4ìë¦¬)" maxlength="4" oninput="checkLen(this,4,'birthM')">
            <input type="tel" id="birthM" placeholder="ì›”" maxlength="2" oninput="checkLen(this,2,'birthD')">
            <input type="tel" id="birthD" placeholder="ì¼" maxlength="2" oninput="checkLen(this,2,'q-rrn')">
        </div>
    </div>

    <div id="q-rrn" class="q-box">
        <label>ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ <span class="sub-text">(13ìë¦¬)</span></label>
        <div class="split-box">
            <input type="tel" id="rrn1" placeholder="ì• 6ìë¦¬" maxlength="6" oninput="checkLen(this,6,'rrn2')">
            <span>-</span>
            <input type="tel" id="rrn2" placeholder="ë’¤ 7ìë¦¬" maxlength="7" oninput="checkLen(this,7,'q-addr')">
        </div>
    </div>

    <div id="q-addr" class="q-box">
        <label>ì£¼ì†Œ</label>
        <div class="split-box" style="margin-bottom:10px;">
            <input type="text" id="postcode" placeholder="ìš°í¸ë²ˆí˜¸" readonly>
            <button class="btn-opt" style="flex:0.5; min-width:auto; padding:10px;" onclick="execPostcode()">ê²€ìƒ‰</button>
        </div>
        <input type="text" id="address" placeholder="ê¸°ë³¸ ì£¼ì†Œ" readonly style="margin-bottom:10px;">
        <input type="text" id="detailAddr" placeholder="ìƒì„¸ ì£¼ì†Œ ì…ë ¥" onchange="next('q-contact')">
    </div>

    <div id="q-contact" class="q-box">
        <label>ë³¸ì¸ ì—°ë½ì²˜</label>
        <div class="split-box">
            <input type="tel" id="tel1" placeholder="010" maxlength="3" oninput="checkLen(this,3,'tel2')">
            <input type="tel" id="tel2" placeholder="0000" maxlength="4" oninput="checkLen(this,4,'tel3')">
            <input type="tel" id="tel3" placeholder="0000" maxlength="4" oninput="checkLen(this,4,'ptel1')">
        </div>
        <label style="margin-top:20px;">ë³´í˜¸ì ì—°ë½ì²˜</label>
        <div class="split-box">
            <input type="tel" id="ptel1" placeholder="010" maxlength="3" oninput="checkLen(this,3,'ptel2')">
            <input type="tel" id="ptel2" placeholder="0000" maxlength="4" oninput="checkLen(this,4,'ptel3')">
            <input type="tel" id="ptel3" placeholder="0000" maxlength="4" oninput="checkLen(this,4,'q-status')">
        </div>
    </div>

    <div id="q-status" class="q-box">
        <label>í˜„ì¬ ìƒíƒœ</label>
        <div class="btn-group" style="flex-direction:column;">
            <div class="btn-opt" onclick="selectOpt(this, 'status', 'í•™êµë°–ì²­ì†Œë…„'); next('q-school');">í•™êµ ë°– ì²­ì†Œë…„ (ìí‡´, ë¯¸ì§„í•™ ë“±)</div>
            <div class="btn-opt" onclick="selectOpt(this, 'status', 'ê³ ì¡¸ê²€ì •ê³ ì‹œí•©ê²©'); next('q-school');">ê³ ì¡¸ ê²€ì •ê³ ì‹œ í•©ê²© ì²­ì†Œë…„</div>
            <div class="btn-opt" onclick="selectOpt(this, 'status', 'í•™ì—…ì¤‘ë‹¨ìˆ™ë ¤ì œ'); next('q-school');">í•™ì—…ì¤‘ë‹¨ ìˆ™ë ¤ì œ (ìƒë‹´ ì¤‘)</div>
        </div>
    </div>

    <div id="q-school" class="q-box">
        <label>ì–¸ì œê¹Œì§€ í•™êµì— ë‹¤ë…”ë‚˜ìš”?</label>
        <div class="btn-group">
            <div class="btn-opt" onclick="selectOpt(this, 'schLvl', 'ì´ˆë“±í•™êµ'); showGrades(6);">ì´ˆë“±í•™êµ</div>
            <div class="btn-opt" onclick="selectOpt(this, 'schLvl', 'ì¤‘í•™êµ'); showGrades(3);">ì¤‘í•™êµ</div>
            <div class="btn-opt" onclick="selectOpt(this, 'schLvl', 'ê³ ë“±í•™êµ'); showGrades(3);">ê³ ë“±í•™êµ</div>
            <div class="btn-opt" onclick="selectOpt(this, 'schLvl', 'ë¯¸ì§„í•™'); next('q-dropdate');">ë¯¸ì§„í•™</div>
        </div>
        
        <div id="grade-wrapper" class="hidden" style="margin-top:20px; border-top:1px dashed #ddd; padding-top:20px;">
            <label>í•™ë…„</label>
            <div id="grade-area" class="btn-group" style="margin-bottom:15px;"></div>
            <label>í•™ê¸°</label>
            <div class="btn-group">
                <div class="btn-opt" onclick="selectOpt(this, 'semester', '1í•™ê¸°'); next('q-dropdate');">1í•™ê¸°</div>
                <div class="btn-opt" onclick="selectOpt(this, 'semester', '2í•™ê¸°'); next('q-dropdate');">2í•™ê¸°</div>
            </div>
        </div>
    </div>

    <div id="q-dropdate" class="q-box">
        <label>í•™êµë¥¼ ê·¸ë§Œë‘” ë‚ ì§œ</label>
        <div class="split-box">
            <input type="tel" id="dropY" placeholder="20XX" maxlength="4" oninput="checkLen(this,4,'dropM')"><span>ë…„</span>
            <input type="tel" id="dropM" placeholder="ì›”" maxlength="2" oninput="checkLen(this,2,'dropD')"><span>ì›”</span>
            <input type="tel" id="dropD" placeholder="ì¼" maxlength="2" oninput="checkLen(this,2,'q-reason1')"><span>ì¼</span>
        </div>
    </div>

    <div id="q-reason1" class="q-box">
        <label>ê·¸ë§Œë‘” ì´ìœ  (1ìˆœìœ„)</label>
        <p class="desc">ê°€ì¥ í° ì´ìœ  í•˜ë‚˜ë¥¼ ê³¨ë¼ì£¼ì„¸ìš”.</p>
        <div class="btn-group" id="reason1-list"></div>
    </div>

    <div id="q-reason2" class="q-box">
        <label>2ìˆœìœ„ (ì„ íƒ)</label>
        <div class="btn-group" id="reason2-list"></div>
    </div>

    <div id="q-reason3" class="q-box">
        <label>3ìˆœìœ„ (ì„ íƒ)</label>
        <div class="btn-group" id="reason3-list"></div>
    </div>

    <div id="q-parent-agree" class="q-box">
        <label>ê·¸ë§Œë‘˜ ë‹¹ì‹œ ë¶€ëª¨ë‹˜(ë³´í˜¸ì) ì˜ê²¬</label>
        <div class="btn-group">
            <div class="btn-opt" onclick="selectOpt(this, 'agree', 'ì¼ì¹˜(ì°¬ì„±)'); next('q-path');">ì¼ì¹˜(ì°¬ì„±)</div>
            <div class="btn-opt" onclick="selectOpt(this, 'agree', 'ì¼ì¹˜(ë°˜ëŒ€)'); next('q-path');">ì¼ì¹˜(ë°˜ëŒ€)</div>
            <div class="btn-opt" onclick="selectOpt(this, 'agree', 'ë¶ˆì¼ì¹˜'); next('q-path');">ë¶ˆì¼ì¹˜</div>
            <div class="btn-opt" onclick="selectOpt(this, 'agree', 'ë¬´ê´€ì‹¬'); next('q-path');">ë¬´ê´€ì‹¬</div>
            <div class="btn-opt" onclick="selectOpt(this, 'agree', 'ê¸°íƒ€'); next('q-path');">ê¸°íƒ€</div>
        </div>
    </div>

    <div id="q-path" class="q-box">
        <label>ê¿ˆë“œë¦¼ ì„¼í„° ë°©ë¬¸ ê²½ë¡œ</label>
        <div class="btn-group" id="path-list"></div>
        <div id="org-list" class="hidden btn-group" style="margin-top:15px; background:#f9f9f9; padding:10px; border-radius:10px;"></div>
    </div>

    <div id="q-family" class="q-box">
        <label>ê°€ì¡± êµ¬ì„±ì› (ìµœëŒ€ 5ëª…)</label>
        <div class="fam-grid" style="font-weight:bold; color:#666; text-align:center;">
            <span>ê´€ê³„</span><span>ì´ë¦„</span><span>ë‚˜ì´</span><span>ì—°ë½ì²˜</span><span>ë™ê±°</span>
        </div>
        <div id="fam-inputs"></div>
        
        <div style="margin-top:30px;">
            <label>í˜„ì¬ ê°€ì • í˜•íƒœ</label>
            <div class="btn-group">
                <div class="btn-opt" onclick="selectOpt(this, 'famType', 'ì¹œë¶€ëª¨'); next('q-econ');">ì¹œë¶€ëª¨</div>
                <div class="btn-opt" onclick="selectOpt(this, 'famType', 'í¸ë¶€'); next('q-econ');">í¸ë¶€</div>
                <div class="btn-opt" onclick="selectOpt(this, 'famType', 'í¸ëª¨'); next('q-econ');">í¸ëª¨</div>
                <div class="btn-opt" onclick="selectOpt(this, 'famType', 'ì¡°ì†'); next('q-econ');">ì¡°ì†</div>
                <div class="btn-opt" onclick="selectOpt(this, 'famType', 'ê¸°íƒ€'); next('q-econ');">ê¸°íƒ€</div>
            </div>
        </div>
    </div>

    <div id="q-econ" class="q-box">
        <label>ê°€ì •ì˜ ê²½ì œìƒíƒœ</label>
        <div class="btn-group">
            <div class="btn-opt" onclick="selectOpt(this, 'econ', 'ì¼ë°˜ìˆ˜ê¸‰'); next('q-money');">ì¼ë°˜ìˆ˜ê¸‰</div>
            <div class="btn-opt" onclick="selectOpt(this, 'econ', 'ì¡°ê±´ë¶€ìˆ˜ê¸‰'); next('q-money');">ì¡°ê±´ë¶€ìˆ˜ê¸‰</div>
            <div class="btn-opt" onclick="selectOpt(this, 'econ', 'ì°¨ìƒìœ„'); next('q-money');">ì°¨ìƒìœ„</div>
            <div class="btn-opt" onclick="selectOpt(this, 'econ', 'í•´ë‹¹ì—†ìŒ'); next('q-money');">í•´ë‹¹ì—†ìŒ</div>
        </div>
    </div>

    <div id="q-money" class="q-box">
        <label>ë¬¼ì§ˆì  ì§€ì›(ìš©ëˆ ë“±)ì€ ì¶©ë¶„í•œê°€ìš”?</label>
        <div class="btn-group">
            <div class="btn-opt" onclick="selectOpt(this, 'support', 'ì¶©ë¶„'); document.getElementById('q-money-lack').classList.add('hidden'); next('q-pocket');">ì¶©ë¶„</div>
            <div class="btn-opt" onclick="selectOpt(this, 'support', 'ë³´í†µ'); document.getElementById('q-money-lack').classList.add('hidden'); next('q-pocket');">ë³´í†µ</div>
            <div class="btn-opt" onclick="selectOpt(this, 'support', 'ë¶€ì¡±'); document.getElementById('q-money-lack').classList.remove('hidden');">ë¶€ì¡±</div>
        </div>
        
        <div id="q-money-lack" class="hidden" style="margin-top:20px;">
            <label>ë¶€ì¡±í•œ ë¹„ìš©ì€ ì–´ë–»ê²Œ ì¶©ë‹¹í•˜ë‚˜ìš”?</label>
            <div class="btn-group">
                <div class="btn-opt" onclick="selectOpt(this, 'howMoney', 'ì•Œë°”'); next('q-pocket');">ì¼(ì•Œë°”)</div>
                <div class="btn-opt" onclick="selectOpt(this, 'howMoney', 'ì§€ì›ê¸ˆ'); next('q-pocket');">êµ­ê°€ ì§€ì›ê¸ˆ</div>
                <div class="btn-opt" onclick="selectOpt(this, 'howMoney', 'ì•„ê»´ì”€'); next('q-pocket');">ì•„ê»´ì”€</div>
            </div>
        </div>
    </div>

    <div id="q-pocket" class="q-box">
        <label>í•œ ë‹¬ ìš©ëˆì€ ì–¼ë§ˆë‚˜ ì“°ë‚˜ìš”?</label>
        <div class="btn-group">
            <div class="btn-opt" onclick="selectOpt(this, 'pocket', 'ì—†ìŒ'); next('q-interest');">ì—†ìŒ</div>
            <div class="btn-opt" onclick="selectOpt(this, 'pocket', '10ë¯¸ë§Œ'); next('q-interest');">10ë§Œì› ë¯¸ë§Œ</div>
            <div class="btn-opt" onclick="selectOpt(this, 'pocket', '10-20'); next('q-interest');">10~20ë§Œì›</div>
            <div class="btn-opt" onclick="selectOpt(this, 'pocket', '30ì´ìƒ'); next('q-interest');">30ë§Œì› ì´ìƒ</div>
        </div>
    </div>

    <div id="q-interest" class="q-box">
        <label>ê°€ì • ë‚´ ê´€ì‹¬ê³¼ ì¡´ì¤‘ ì •ë„</label>
        <div class="btn-group">
            <div class="btn-opt" onclick="selectOpt(this, 'respect', 'ë§¤ìš°ì¶©ë¶„'); next('q-talk');">ë§¤ìš° ì¶©ë¶„</div>
            <div class="btn-opt" onclick="selectOpt(this, 'respect', 'ë³´í†µ'); next('q-talk');">ë³´í†µ</div>
            <div class="btn-opt" onclick="selectOpt(this, 'respect', 'ë¶€ì¡±'); next('q-talk');">ë¶€ì¡±</div>
        </div>
    </div>

    <div id="q-talk" class="q-box">
        <label>ê³ ë¯¼ì´ ìˆì„ ë•Œ ëˆ„êµ¬ì™€ ì–˜ê¸°í•˜ë‚˜ìš”?</label>
        <div class="btn-group">
            <div class="btn-opt" onclick="selectOpt(this, 'talk', 'ë¶€ëª¨'); next('q-diff');">ë¶€ëª¨ë‹˜</div>
            <div class="btn-opt" onclick="selectOpt(this, 'talk', 'í˜•ì œ'); next('q-diff');">í˜•ì œìë§¤</div>
            <div class="btn-opt" onclick="selectOpt(this, 'talk', 'ì¹œêµ¬'); next('q-diff');">ì¹œêµ¬</div>
            <div class="btn-opt" onclick="selectOpt(this, 'talk', 'ì„ ìƒë‹˜'); next('q-diff');">ì„ ìƒë‹˜</div>
            <div class="btn-opt" onclick="selectOpt(this, 'talk', 'ì—†ìŒ'); next('q-diff');">ì—†ìŒ</div>
        </div>
    </div>

    <div id="q-diff" class="q-box">
        <label>í˜„ì¬ ê²ªê³  ìˆëŠ” ì–´ë ¤ì›€ (ëª¨ë‘ ì„ íƒ)</label>
        <div id="diff-area"></div>
        <button class="full-btn" onclick="next('q-goal')">ì„ íƒ ì™„ë£Œ</button>
    </div>

    <div id="q-goal" class="q-box">
        <label>í•™êµ ì¤‘ë‹¨ í›„ ëª©í‘œ</label>
        <div class="btn-group">
            <div class="btn-opt" onclick="selectOpt(this, 'goal', 'ê²€ì •ê³ ì‹œ'); next('q-service');">ê²€ì •ê³ ì‹œ</div>
            <div class="btn-opt" onclick="selectOpt(this, 'goal', 'ë³µí•™'); next('q-service');">ë³µí•™</div>
            <div class="btn-opt" onclick="selectOpt(this, 'goal', 'ì§„í•™'); next('q-service');">ìƒê¸‰í•™êµ ì§„í•™</div>
            <div class="btn-opt" onclick="selectOpt(this, 'goal', 'ì·¨ì—…'); next('q-service');">ì·¨ì—…</div>
            <div class="btn-opt" onclick="selectOpt(this, 'goal', 'ìê²©ì¦'); next('q-service');">ìê²©ì¦</div>
            <div class="btn-opt" onclick="selectOpt(this, 'goal', 'ë¯¸ì •'); next('q-service');">ì•„ì§ ëª¨ë¦„</div>
        </div>
    </div>

    <div id="q-service" class="q-box">
        <label>í¬ë§ ì„œë¹„ìŠ¤ (ëª¨ë‘ ì„ íƒ)</label>
        <div id="service-area"></div>
        <button class="full-btn" onclick="next('q-history')">ì„ íƒ ì™„ë£Œ</button>
    </div>

    <div id="q-history" class="q-box">
        <label>ê³¼ê±° í•™êµìƒí™œ ë§Œì¡±ë„</label>
        <div class="btn-group">
            <div class="btn-opt" onclick="selectOpt(this, 'past', 'ë§Œì¡±'); document.getElementById('q-health').classList.remove('hidden');">ë§Œì¡±</div>
            <div class="btn-opt" onclick="selectOpt(this, 'past', 'ë³´í†µ'); document.getElementById('q-health').classList.remove('hidden');">ë³´í†µ</div>
            <div class="btn-opt" onclick="selectOpt(this, 'past', 'ë¶ˆë§Œì¡±'); document.getElementById('q-health').classList.remove('hidden');">ë¶ˆë§Œì¡±</div>
        </div>
        
        <div id="q-health" class="hidden" style="margin-top:30px;">
            <label>í˜„ì¬ ê±´ê°• ìƒíƒœ</label>
            <div class="btn-group">
                <div class="btn-opt" onclick="selectOpt(this, 'health', 'ì¢‹ìŒ'); startScale();">ê±´ê°•í•¨</div>
                <div class="btn-opt" onclick="selectOpt(this, 'health', 'ë³´í†µ'); startScale();">ë³´í†µ</div>
                <div class="btn-opt" onclick="selectOpt(this, 'health', 'ë‚˜ì¨'); startScale();">ë‚˜ì¨(ì¹˜ë£Œì¤‘)</div>
            </div>
        </div>
    </div>

    <div id="q-scale" class="q-box">
        <h2 id="scale-title">ì²™ë„ ê²€ì‚¬</h2>
        <div id="scale-area"></div>
        <button id="scale-next-btn" class="full-btn" onclick="nextScale()">ë‹¤ìŒ</button>
    </div>

    <div id="end-screen" class="container hidden text-center">
        <h1 style="font-size:3rem;">ğŸ‰</h1>
        <h2>ìˆ˜ê³ í•˜ì…¨ìŠµë‹ˆë‹¤!</h2>
        <p style="color:#666;">ì‘ì„±ì´ ëª¨ë‘ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.<br>íƒœë¸”ë¦¿ì„ ìƒë‹´ ì„ ìƒë‹˜ê»˜ ë“œë ¤ì£¼ì„¸ìš”.</p>
        <button class="full-btn" onclick="location.reload()" style="background:#333;">ì²˜ìŒìœ¼ë¡œ</button>
    </div>

</div>

<div class="progress-fixed no-print"><div class="progress-fill" id="progress"></div></div>

<div id="admin-view" class="container hidden no-print">
    </div>

<script>
    // [1] Firebase ì„¤ì • (ë³¸ì¸ í‚¤ë¡œ ë³€ê²½)
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "kdream-db462.firebaseapp.com",
        projectId: "kdream-db462",
        storageBucket: "kdream-db462.firebasestorage.app",
        messagingSenderId: "1020262030810",
        appId: "1:1020262030810:web:3482636bc020bb4310b4e3"
    };
    try { firebase.initializeApp(firebaseConfig); var db = firebase.firestore(); } catch(e){}

    // [2] ìƒíƒœ ê´€ë¦¬
    let userData = {};
    let answers = {};
    let scaleStep = 0; // 0: Jarip, 1: Simni
    let userType = "YOUTH";

    window.onload = function() {
        initReasons();
        initPath();
        initDiff();
        initService();
        initFam();
    };

    // UI ì´ˆê¸°í™”
    function initReasons() {
        const createBtns = (arr, id) => {
            const div = document.getElementById(id);
            arr.forEach(r => {
                div.innerHTML += `<div class="btn-opt" onclick="selectReason(this, '${id}', '${r}')">${r}</div>`;
            });
        };
        createBtns(REASON_OPTIONS, 'reason1-list');
    }

    function initPath() {
        const d = document.getElementById('path-list');
        PATH_OPTS.forEach(p => {
            let click = p.type === 'ê¸°ê´€' ? `document.getElementById('org-list').classList.remove('hidden')` : `next('q-family')`;
            d.innerHTML += `<div class="btn-opt" onclick="selectOpt(this, 'path', '${p.label}'); ${click}">${p.label}</div>`;
        });
        
        const orgD = document.getElementById('org-list');
        ORG_DETAILS.forEach(o => {
            orgD.innerHTML += `<div class="btn-opt" onclick="selectOpt(this, 'orgDetail', '${o}'); next('q-family')">${o}</div>`;
        });
    }

    function initDiff() {
        const d = document.getElementById('diff-area');
        for(let g in DIFFICULTY_GROUPS) {
            d.innerHTML += `<h3>${g}</h3><div class="btn-group">` + 
                DIFFICULTY_GROUPS[g].map(i => `<label><input type="checkbox" name="diff" value="${i}">${i}</label>`).join('') + `</div>`;
        }
    }

    function initService() {
        const d = document.getElementById('service-area');
        for(let g in SERVICE_GROUPS) {
            d.innerHTML += `<h3>${g}</h3><div class="btn-group">` + 
                SERVICE_GROUPS[g].map(i => `<label><input type="checkbox" name="serv" value="${i}">${i}</label>`).join('') + `</div>`;
        }
    }

    function initFam() {
        const d = document.getElementById('fam-inputs');
        for(let i=1; i<=5; i++) {
            d.innerHTML += `<div class="fam-grid"><input type="text" id="fr${i}"><input type="text" id="fn${i}"><input type="number" id="fa${i}"><input type="tel" id="ft${i}"><select id="fl${i}"><option value="Y">O</option><option value="N">X</option></select></div>`;
        }
    }

    // ë¡œì§
    function startSurvey() {
        document.getElementById('intro-screen').classList.add('hidden');
        document.getElementById('survey-screen').classList.remove('hidden');
        document.getElementById('q-basic').classList.add('show');
    }

    function next(nextId) {
        if(nextId === 'q-reason1') { // ë‚ ì§œ ë‹¤ ì…ë ¥ ì‹œ
            if(!document.getElementById('dropD').value) return; 
        }
        
        const el = document.getElementById(nextId);
        if(el) {
            el.classList.add('show');
            setTimeout(() => el.scrollIntoView({ behavior: 'smooth', block: 'center' }), 100);
        }
        updateProgress();
    }

    function checkLen(el, max, nextId) {
        if(el.value.length >= max) {
            el.value = el.value.slice(0, max);
            if(nextId) {
                const n = document.getElementById(nextId);
                if(n) {
                    if(n.tagName === 'DIV') next(nextId); // ë°•ìŠ¤ë©´ ë³´ì—¬ì£¼ê¸°
                    else n.focus(); // ì…ë ¥ì°½ì´ë©´ í¬ì»¤ìŠ¤ ì´ë™
                }
            }
        }
    }

    function selectOpt(el, key, val) {
        userData[key] = val;
        const siblings = el.parentElement.children;
        for(let s of siblings) s.classList.remove('selected');
        el.classList.add('selected');
    }

    function selectReason(el, id, val) {
        selectOpt(el, id, val);
        
        if(id === 'reason1-list') {
            const d2 = document.getElementById('reason2-list');
            d2.innerHTML = `<div class="btn-opt" onclick="next('q-reason3');">ì„ íƒ ì•ˆ í•¨</div>`;
            REASON_OPTIONS.filter(r => r !== val).forEach(r => {
                d2.innerHTML += `<div class="btn-opt" onclick="selectReason(this, 'reason2-list', '${r}'); next('q-reason3')">${r}</div>`;
            });
            next('q-reason2');
        }
    }

    function showGrades(max) {
        const area = document.getElementById('grade-wrapper');
        const btns = document.getElementById('grade-btns');
        btns.innerHTML = "";
        
        if(max === 0) { area.classList.add('hidden'); next('q-dropdate'); return; }
        
        area.classList.remove('hidden');
        for(let i=1; i<=max; i++) {
            btns.innerHTML += `<div class="btn-opt" onclick="selectOpt(this,'grade','${i}í•™ë…„')">${i}í•™ë…„</div>`;
        }
    }

    function execPostcode() {
        new daum.Postcode({
            oncomplete: function(data) {
                document.getElementById('postcode').value = data.zonecode;
                document.getElementById("address").value = data.roadAddress;
                document.getElementById("detailAddr").focus();
            }
        }).open();
    }

    function startScale() {
        // ë°ì´í„° ìˆ˜ì§‘ (ìƒëµ: userDataì— ì €ì¥ëœ ê°’ í™œìš©)
        const y2 = document.getElementById('rrn1').value.substr(0,2);
        const y = parseInt(y2) < 30 ? 2000+parseInt(y2) : 1900+parseInt(y2);
        userType = (new Date().getFullYear() - y >= 13) ? "YOUTH" : "CHILD";
        
        document.getElementById('q-history').classList.remove('show');
        document.getElementById('q-scale').classList.add('show');
        renderScale('jarip');
    }

    function renderScale(part) {
        const list = SCALE_DATA[userType][part];
        const div = document.getElementById('scale-area');
        const title = document.getElementById('scale-title');
        
        title.innerText = part === 'jarip' ? "ìë¦½ì—­ëŸ‰ ì²™ë„" : "ì‹¬ë¦¬ì •ì„œ ì²™ë„";
        div.innerHTML = "";
        
        list.forEach((q, i) => {
            div.innerHTML += `
                <div style="background:#f9f9f9; padding:15px; border-radius:10px; margin-bottom:10px;">
                    <div style="font-weight:bold; margin-bottom:8px;">${i+1}. ${q.t}</div>
                    <div class="btn-group">
                        <label><input type="radio" name="${part}_${q.n}" value="1">ì „í˜€ì•„ë‹˜</label>
                        <label><input type="radio" name="${part}_${q.n}" value="2">ì•„ë‹ˆë‹¤</label>
                        <label><input type="radio" name="${part}_${q.n}" value="3">ë³´í†µ</label>
                        <label><input type="radio" name="${part}_${q.n}" value="4">ê·¸ë ‡ë‹¤</label>
                        <label><input type="radio" name="${part}_${q.n}" value="5">ë§¤ìš°ê·¸ë ‡ë‹¤</label>
                    </div>
                </div>`;
        });
    }

    function nextScale() {
        if(scaleStep === 0) {
            scaleStep++;
            renderScale('simni');
            window.scrollTo(0,0);
        } else {
            document.getElementById('survey-screen').classList.add('hidden');
            document.getElementById('end-screen').classList.remove('hidden');
            if(db) { 
                /* Firestore ì €ì¥ ì½”ë“œ (userData + answers) */ 
                db.collection("intake_complete").add({
                    info: userData, ans: answers, ts: firebase.firestore.FieldValue.serverTimestamp()
                });
            }
        }
    }

    function updateProgress() {
        const total = 20; 
        const current = document.querySelectorAll('.q-box.show').length;
        document.getElementById('progress-fill').style.width = (current/total*100) + "%";
    }
</script>
</body>
</html>
